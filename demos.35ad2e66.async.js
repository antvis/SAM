"use strict";(self.webpackChunksam_js=self.webpackChunksam_js||[]).push([[433],{44082:function(ot,V,c){c.r(V),c.d(V,{default:function(){return Ne}});var ce=c(15009),D=c.n(ce),he=c(99289),B=c.n(he),de=c(5574),d=c.n(de),R=c(18736),w=c(67294),fe=c(781),A=c(7539),Y=c(95168),ge=c(91622),Te=c(75081),J=c(73771),it=null,pe=function(r){var e=d()(r,4),n=e[0],t=e[1],a=e[2],o=e[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[n,t],[n,o],[a,o],[a,t],[n,t]]]}}]}},ye=function(r){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[r]}}]}},xe=function(){return{type:"FeatureCollection",features:[]}},Se=c(54539),Le=function(r){var e=r.clicks,n=r.tensor,t=r.modelScale,a=n,o,i,s,T;if(e){var u=e.length;o=new Float32Array(2*(u+1)),i=new Float32Array(u+1);for(var g=0;g<u;g++)o[2*g]=e[g].x*t.samScale,o[2*g+1]=e[g].y*t.samScale,i[g]=e[g].clickType;o[2*u]=0,o[2*u+1]=0,i[u]=-1,s=new R.Tensor("float32",o,[1,u+1,2]),T=new R.Tensor("float32",i,[1,u+1])}var P=new R.Tensor("float32",[t.height,t.width]);if(!(s===void 0||T===void 0)){var z=new R.Tensor("float32",new Float32Array(256*256),[1,1,256,256]),y=new R.Tensor("float32",[0]);return{image_embeddings:a,point_coords:s,point_labels:T,orig_im_size:P,mask_input:z,has_mask_input:y}}},Me=c(12444),we=c.n(Me),Pe=c(72004),Ie=c.n(Pe),ze=c(9783),j=c.n(ze),ke=function(){function l(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:256,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"tms";we()(this,l),j()(this,"tileSize",void 0),j()(this,"type",void 0),j()(this,"initialResolution",void 0),j()(this,"originShift",void 0),this.tileSize=r,this.type=e,this.initialResolution=2*Math.PI*6378137/this.tileSize,this.originShift=2*Math.PI*6378137/2}return Ie()(l,[{key:"lngLatToMeters",value:function(e,n){var t=e*this.originShift/180,a=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return a=a*this.originShift/180,[t,a]}},{key:"metersToLatLon",value:function(e,n){var t=e/this.originShift*180,a=n/this.originShift*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),[t,a]}},{key:"pixelsToMeters",value:function(e,n,t){var a=this.resolution(t),o=e*a-this.originShift,i=(this.type==="tms"?n:Math.pow(2,t)*256-n)*a-this.originShift;return[o,i]}},{key:"metersToPixels",value:function(e,n,t){var a=this.resolution(t),o=(e+this.originShift)/a,i=(n+this.originShift)/a;return i=this.type==="tms"?i:Math.pow(2,t)*256-i,[o,i]}},{key:"metersToTile",value:function(e,n,t){var a=this.metersToPixels(e,n,t),o=d()(a,2),i=o[0],s=o[1];return this.pixelsToTile(i,s)}},{key:"tileToMeters",value:function(e,n,t){return this.pixelsToMeters(e*this.tileSize,n*this.tileSize,t)}},{key:"pixelsToTile",value:function(e,n){var t=Math.floor(Math.ceil(e/this.tileSize)-1),a=Math.floor(Math.ceil(n/this.tileSize)-1);return[t,a]}},{key:"pixelsToRaster",value:function(e,n,t){var a=this.tileSize<<t;return[e,a-n]}},{key:"tileBounds",value:function(e,n,t){var a=this.pixelsToMeters(e*this.tileSize,n*this.tileSize,t),o=d()(a,2),i=o[0],s=o[1],T=this.pixelsToMeters((e+1)*this.tileSize,(n+1)*this.tileSize,t),u=d()(T,2),g=u[0],P=u[1];return[i,s,g,P]}},{key:"tileLatLonBounds",value:function(e,n,t){var a=this.tileBounds(e,n,t),o=this.metersToLatLon(a[0],a[1]),i=d()(o,2),s=i[0],T=i[1],u=this.metersToLatLon(a[2],a[3]),g=d()(u,2),P=g[0],z=g[1];return[s,T,P,z]}},{key:"resolution",value:function(e){return this.initialResolution/Math.pow(2,e)}},{key:"lngLatToPixels",value:function(e,n,t){var a=this.lngLatToMeters(e,n),o=d()(a,2),i=o[0],s=o[1];return this.metersToPixels(i,s,t)}},{key:"pixelsTolngLat",value:function(e,n,t){var a=this.pixelsToMeters(e,n,t);return this.metersToLatLon(a[0],a[1])}},{key:"lngLatToTile",value:function(e,n,t){var a=this.lngLatToPixels(e,n,t),o=d()(a,2),i=o[0],s=o[1];return this.pixelsToTile(i,s)}},{key:"googleTile",value:function(e,n,t){return[e,Math.pow(2,t)-1-n]}},{key:"boundsToTileExtent",value:function(e,n,t,a,o){var i=this.lngLatToTile(e,a,o),s=d()(i,2),T=s[0],u=s[1],g=this.lngLatToTile(t,n,o),P=d()(g,2),z=P[0],y=P[1];return[[T,u],[z,y]]}},{key:"metersboundsToTileExtent",value:function(e,n,t,a,o){var i=this.metersToTile(e,a,o),s=d()(i,2),T=s[0],u=s[1],g=this.metersToTile(t,n,o),P=d()(g,2),z=P[0],y=P[1];return[[T,u],[z,y]]}}]),l}(),Ce=c(69826),De=c(16479),Ee=c.n(De);function st(l,r,e){for(var n=255,t=0,a=0,o=255,i=new Uint8ClampedArray(4*r*e).fill(0),s=0;s<l.length;s++)l[s]>0&&(i[4*s+0]=n,i[4*s+1]=t,i[4*s+2]=a,i[4*s+3]=o);return new ImageData(i,e,r)}function $e(l,r,e){for(var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:15,t=e,a=0,o=r,i=0,s=0;s<l.length;s++)if(l[s]>0){var T=s%e,u=Math.floor(s/e);t=Math.min(t,T),a=Math.max(a,T),o=Math.min(o,u),i=Math.max(i,u)}return[t-n,a+n,o-n,i+n]}function be(l,r,e,n,t,a,o){for(var i=[],s=0,T=r;T<n;T++)for(var u=l;u<e;u++){var g=T*o+u;i[s++]=t[g]>0?1:-1}return i}function Ze(l){var r=document.createElement("canvas"),e=r.getContext("2d");return r.width=l.width,r.height=l.height,e==null||e.putImageData(l,0,0),r}function lt(l){var r=Ze(l),e=new Image;return e.src=r.toDataURL(),e}function Re(l,r,e,n,t){var a=document.createElement("canvas"),o=a.getContext("2d");a.width=r*10,a.height=e*10,o.beginPath(),o.strokeStyle="#00f",o.lineWidth=4;var i=Ee()(l.map(function(s){return{x:s[0]+n,y:s[1]+t}}),5,!0);return i}var ut=function(r){return new Promise(function(e,n){var t=new FileReader;t.readAsDataURL(r),t.onload=function(){return e(t.result)},t.onerror=function(a){return n(a)}})};function Fe(l,r,e){var n=$e(l,r,e),t=d()(n,4),a=t[0],o=t[1],i=t[2],s=t[3],T=be(a,i,o,s,l,r,e),u=o-a,g=s-i,P=Ce.Z().size([u,g]).smooth(!1).thresholds(2),z=P(T);return Re(z[1].coordinates[0][0],u,g,a,i)}var mt=function(r){var e=1024,n=r.naturalWidth,t=r.naturalHeight,a=e/Math.max(t,n);return{height:t,width:n,samScale:a}},Be=function(r,e){var n=1024,t=n/Math.max(e,r);return{height:e,width:r,samScale:t}},K="",b=c(85893),Ae=c(18736),Q="model/sam_onnx_example.onnx",G=new ke(256,"google"),Ne=function(){var l=(0,w.useState)(null),r=d()(l,2),e=r[0],n=r[1],t=(0,w.useState)(null),a=d()(t,2),o=a[0],i=a[1],s=(0,w.useState)(null),T=d()(s,2),u=T[0],g=T[1],P=(0,w.useState)(),z=d()(P,2),y=z[0],je=z[1],Ge=(0,w.useState)(),q=d()(Ge,2),H=q[0],Oe=q[1],Ye=(0,w.useState)(null),_=d()(Ye,2),E=_[0],He=_[1],Ue=(0,w.useState)(null),ee=d()(Ue,2),U=ee[0],Xe=ee[1],We=(0,w.useState)(null),te=d()(We,2),O=te[0],Ve=te[1],Je=(0,w.useState)(),ae=d()(Je,2),N=ae[0],Ke=ae[1],Qe=(0,w.useState)(!1),ne=d()(Qe,2),qe=ne[0],re=ne[1],_e=17,oe=[{name:"A \u7A7A\u95F4",coord:[120.10533489408249,30.261061158180482],zoom:18},{name:"\u6CB9\u7F50",coord:[-96.74674229210954,35.935326263559816],zoom:15.5},{name:"\u519C\u7530",coord:[5.000138834496795,52.83911856295691],zoom:13.5},{name:"\u519C\u75302",coord:[-111.91603037093357,32.91837220530866],zoom:13},{name:"\u704C\u6E89\u519C\u7530",coord:[38.274419546979345,30.107721922396593],zoom:12.5},{name:"\u5EFA\u7B51",coord:[-75.68709358840009,45.40821167856009],zoom:18},{name:"\u5EFA\u7B512",coord:[-117.9375255130447,33.809435077864805],zoom:18.2},{name:"\u673A\u573A",coord:[-117.377,34.596],zoom:15.5},{name:"\u8349\u573A",coord:[28.725760156128445,22.24767189005027],zoom:12},{name:"\u8349\u573A2",coord:[115.8162326,36.2454426],zoom:18}],et=function(){var h=B()(D()().mark(function L(f){var p,x,v,M,S=arguments;return D()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return p=S.length>1&&S[1]!==void 0?S[1]:"float32",x=new fe.Z,m.next=4,x.parse(f);case 4:return v=m.sent,M=new Ae.Tensor(p,v.data,v.shape),m.abrupt("return",M);case 7:case"end":return m.stop()}},L)}));return function(f){return h.apply(this,arguments)}}(),ie=function(){var h=B()(D()().mark(function L(){var f,p,x,v,M,S,k,m,$,Z,F;return D()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:re(!0),f=H==null?void 0:H.tileset.currentTiles,p=1/0,x=1/0,v=-1/0,M=-1/0,f==null||f.forEach(function(I){p=Math.min(p,I.x),x=Math.min(x,I.y),v=Math.max(v,I.x),M=Math.max(M,I.y)}),S=document.createElement("canvas"),S.width=(v-p+1)*256,S.height=(M-x+1)*256,k=S.getContext("2d"),He([p,x,v+1,M+1].map(function(I){return I*256})),f==null||f.forEach(function(I){I&&(k==null||k.drawImage(I.data,(I.x-p)*256,(I.y-x)*256,256,256))}),m=Be(S.width,S.height),$=m.height,Z=m.width,F=m.samScale,n({height:$,width:Z,samScale:F}),S.toBlob(function(){var I=B()(D()().mark(function le(rt){var ue,W,me,ve;return D()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(K!==""){C.next=3;break}return Y.ZP.error("\u8BF7\u5148\u914D\u7F6Eembedding\u8BA1\u7B97\u670D\u52A1\u5730\u5740"),C.abrupt("return");case 3:return ue=K,W=new FormData,W.append("file",rt),C.next=8,fetch(ue,{body:W,method:"POST"});case 8:return C.next=10,C.sent.arrayBuffer();case 10:return me=C.sent,C.next=13,et(me,"float32");case 13:ve=C.sent,g(ve),re(!1),Y.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210");case 17:case"end":return C.stop()}},le)}));return function(le){return I.apply(this,arguments)}}());case 16:case"end":return X.stop()}},L)}));return function(){return h.apply(this,arguments)}}(),tt=function(L){var f=oe.find(function(p){return p.name===L.target.value});f&&(y==null||y.setCenter(f.coord)),y==null||y.setZoom(f.zoom||17)},at=function(){var h=B()(D()().mark(function L(){var f,p;return D()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,Q!==void 0){v.next=3;break}return v.abrupt("return");case 3:return f=Q,v.next=6,R.InferenceSession.create(f);case 6:p=v.sent,i(p),v.next=13;break;case 10:v.prev=10,v.t0=v.catch(0),console.log(v.t0);case 13:case"end":return v.stop()}},L,null,[[0,10]])}));return function(){return h.apply(this,arguments)}}(),nt=function(){var h=B()(D()().mark(function L(){var f,p,x,v,M,S;return D()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(m.prev=0,!(o===null||U===null||u===null||e===null)){m.next=6;break}return console.log("model not loaded"),m.abrupt("return");case 6:if(f=Le({clicks:U,tensor:u,modelScale:e}),f!==void 0){m.next=9;break}return m.abrupt("return");case 9:return m.next=11,o.run(f);case 11:p=m.sent,x=p[o.outputNames[0]],v=Fe(x.data,x.dims[2],x.dims[3]),M=v.map(function($){var Z=[$.x+E[0],$.y+E[1]],F=G.pixelsTolngLat(Z[0],Z[1],Math.ceil(y==null?void 0:y.getZoom()));return F}),S=ye(M),N==null||N.setData(S);case 17:m.next=22;break;case 19:m.prev=19,m.t0=m.catch(0),console.log(m.t0);case 22:case"end":return m.stop()}},L,null,[[0,19]])}));return function(){return h.apply(this,arguments)}}();return(0,w.useEffect)(function(){at()},[]),(0,w.useEffect)(function(){if(u!==null&&e!==null&&E!==null){var h=[O[0]-E[0],O[1]-E[1]];Xe([{x:h[0],y:h[1],clickType:1}])}else O!==null&&(ie(),Y.ZP.warning("\u8BF7\u5148\u751F\u6210embedding"))},[O]),(0,w.useEffect)(function(){nt(),console.log("run onnx")},[U]),(0,w.useEffect)(function(){if(E&&N){var h=d()(E,4),L=h[0],f=h[1],p=h[2],x=h[3],v=G.pixelsTolngLat(L,f,Math.ceil(y==null?void 0:y.getZoom())),M=d()(v,2),S=M[0],k=M[1],m=G.pixelsTolngLat(p,x,Math.ceil(y==null?void 0:y.getZoom())),$=d()(m,2),Z=$[0],F=$[1],se=pe([S,F,Z,k]);N.setData(se)}},[E]),(0,w.useEffect)(function(){var h=new A.xsS({id:"map",map:new Se.Z({center:[120.10533489408249,30.261061158180482],zoom:_e,minZoom:3,style:"blank"})}),L="https://www.google.com/maps/vt?lyrs=s@820&gl=cn&x={x}&y={y}&z={z}",f="https://t{0-7}.tianditu.gov.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk=b72aa81ac2b3cae941d1eb213499e15e",p=new A.Hw6(L,{parser:{type:"rasterTile",tileSize:256}}),x=new A.YYg({zIndex:1}).source(p),v=new A.YYg({zIndex:2}).source(f,{parser:{type:"rasterTile",tileSize:256,zoomOffset:0}}),M=new A.dWg({zIndex:10}).source(xe).shape("line").size(2).color("#f00").style({opacity:1});h.on("loaded",function(){je(h),Oe(p),h.addLayer(x),h.addLayer(v),h.addLayer(M),Ke(M),h.on("click",function(S){var k=S.lngLat;console.log(k);var m=G.lngLatToPixels(k.lng,k.lat,Math.ceil(h.getZoom()));Ve(m)})})},[]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ge.ZP,{onClick:ie,children:" \u751F\u6210 embedding "}),(0,b.jsxs)(Te.Z,{spinning:qe,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:[(0,b.jsxs)(J.ZP.Group,{style:{margin:"15px"},onChange:tt,defaultValue:"A \u7A7A\u95F4",buttonStyle:"solid",children:[" ",oe.map(function(h){return(0,b.jsx)(J.ZP.Button,{value:h.name,children:h.name},h.name)})]}),(0,b.jsx)("div",{id:"map",style:{height:"70vh",position:"relative"}})]})]})}}}]);
