"use strict";(self.webpackChunk_antv_sam=self.webpackChunk_antv_sam||[]).push([[433],{18312:function(je,Q,e){e.d(Q,{Hj:function(){return q},Kl:function(){return W},XM:function(){return D},XT:function(){return ge},_$:function(){return N},bw:function(){return fe}});var K="https://www.google.com/maps/vt?lyrs=s@820&gl=cn&x={x}&y={y}&z={z}",q=K,Te="https://t{0-7}.tianditu.gov.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk=b72aa81ac2b3cae941d1eb213499e15e",D="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",ge="https://npm.elemecdn.com/onnxruntime-web/dist/",W=[{name:"A \u7A7A\u95F4",coord:[120.10533489408249,30.261061158180482],zoom:18},{name:"\u6CB9\u7F50",coord:[-96.74674229210954,35.935326263559816],zoom:15.5},{name:"\u519C\u7530",coord:[5.000138834496795,52.83911856295691],zoom:13.5},{name:"\u519C\u75302",coord:[-111.91603037093357,32.91837220530866],zoom:13},{name:"\u704C\u6E89\u519C\u7530",coord:[38.274419546979345,30.107721922396593],zoom:12.5},{name:"\u5EFA\u7B51",coord:[-75.68709358840009,45.40821167856009],zoom:18},{name:"\u5EFA\u7B512",coord:[-117.9375255130447,33.809435077864805],zoom:18.2},{name:"\u673A\u573A",coord:[-117.377,34.596],zoom:15.5},{name:"\u8349\u573A",coord:[28.725760156128445,22.24767189005027],zoom:12}],fe=[{label:"\u70B9\u9009",value:"click"}],N=[{label:"\u70B9\u9009",value:"click"},{label:"\u6846\u9009",value:"selectend"}]},67383:function(je,Q,e){e.d(Q,{y:function(){return K}});var K="https://sam.lvisei.icu/api"},90142:function(je,Q,e){e.d(Q,{$F:function(){return he},O6:function(){return S},SO:function(){return me},XG:function(){return ce},YH:function(){return V},rC:function(){return re},vd:function(){return ue}});var K=e(5574),q=e.n(K),Te=e(15009),D=e.n(Te),ge=e(99289),W=e.n(ge),fe=e(73945),N=e.n(fe),Y=e(28182),ee=e.n(Y),te=null,G=function(T){var I=_slicedToArray(T,4),p=I[0],X=I[1],$=I[2],E=I[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[p,X],[p,E],[$,E],[$,X],[p,X]]]}}]}},Se=function(T){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[T]}}]}},re=function(){return{type:"FeatureCollection",features:[]}};function ce(Z){var T=Z.content,I=T;typeof T!="string"&&(I=JSON.stringify(T,null,2));var p=N().format(I,{parser:"json",plugins:[ee()]});return p}var S=function(T){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"data-".concat(new Date().toLocaleString()),p=new Blob([ce({content:JSON.stringify(T)})],{type:"application/json"}),X=document.createElement("a");X.download="".concat(I,".json"),X.href=URL.createObjectURL(p),X.click()};function he(Z){var T=parseInt(Z.slice(1,3),16),I=parseInt(Z.slice(3,5),16),p=parseInt(Z.slice(5,7),16);return[T,I,p,255]}function me(Z,T){for(var I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[255,0,0,255],p=q()(I,4),X=p[0],$=p[1],E=p[2],P=p[3],g=0;g<T.length;g++)T[g]<=0&&(Z.data[4*g+0]=X,Z.data[4*g+1]=$,Z.data[4*g+2]=E,Z.data[4*g+3]=P);var b=document.createElement("canvas");b.width=Z.width,b.height=Z.height;var Ae=b.getContext("2d");return Ae.putImageData(Z,0,0),b.toDataURL("image/png")}var V=function(T){var I=document.createElement("a"),p=new Image;p.src=T,I.download="img.png",I.target="_blank",I.href=p.src,I.click()},ue=function(T,I){var p=T.nativeEvent.target.getBoundingClientRect(),X=window.pageYOffset||document.documentElement.scrollTop,$=window.pageXOffset||document.documentElement.scrollLeft,E=Math.round(T.pageX-p.left-$),P=Math.round(T.pageY-p.top-X),g=I?I.width/T.nativeEvent.target.offsetWidth:1,b=I?I.height/T.nativeEvent.target.offsetHeight:1;return E*=g,P*=b,{x:E,y:P}}},97827:function(je,Q,e){e.r(Q),e.d(Q,{default:function(){return Pe}});var K=e(19632),q=e.n(K),Te=e(15009),D=e.n(Te),ge=e(99289),W=e.n(ge),fe=e(5574),N=e.n(fe),Y=e(4288),ee=e(78356),te=e(33573),G=e(18722),Se=e(66242),re=e(84385),ce=e(75081),S=e(67294),he=e(88484),me=e(44268),V=e(98126),ue=e(67383),Z=e(90142),T=e(18312),I=[{name:"A \u7A7A\u95F4",extent:[120.09979248046875,30.256694798480346,120.11352539062499,30.26381184075493],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*rOXuSb_Tv6MAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u6CB9\u7F50",extent:[-96.7620849609375,35.92464453144096,-96.734619140625,35.94243575255426],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4c-2T41ESekAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u519C\u7530",extent:[4.943847656250016,52.81604319154931,5.053710937499996,52.86912972768522],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*bKPgT4XGbFIAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u5706\u5F62\u519C\u7530",extent:[28.60839843749999,22.146707780012644,28.828125000000014,22.350075806124867],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4KUZSanj_NsAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u673A\u573A",extent:[-117.388916015625,34.58799745550485,-117.366943359375,34.6060845921693],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Y7OHSYNL1VkAAAAAAAAAAAAADmJ7AQ/original"}],p=e(3679),X=e(78234),$=e(63428),E=e(2302),P=e(85893),g=function(O){var j=O.value,f=O.width,R=O.height;return $.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(c){return[{range:c.getFullModelRange(),text:(0,Z.XG)({content:c.getValue()})}]}}),(0,X.Z)(function(){$.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,P.jsx)(E.ZP,{width:f-20,height:R-60,language:"json",value:(0,Z.XG)({content:j}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},b=e(61781),Ae=e(69323),Ce=function(O){var j=O.satelliteData,f=O.setSatelliteData,R=function(o){f(function(d){return q()(d.filter(function(y){return y.imageUrl!==o.image}))}),ee.ZP.success("\u5220\u9664\u6210\u529F")},h=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(o){return(0,P.jsx)(b.Z,{placement:"topLeft",title:o,children:o})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(o){return(0,P.jsx)(b.Z,{color:"#fff",placement:"topLeft",title:(0,P.jsx)("img",{src:o,style:{width:200,height:200}}),children:(0,P.jsx)("img",{src:o,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(o,d){return(0,P.jsx)(Se.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return R(d)},children:"\u5220\u9664"})}}],c=j.map(function(x,o){var d,y=(d=x.features[0])===null||d===void 0?void 0:d.geometry;return{key:o,geometry:JSON.stringify(y),image:x.imageUrl}});return(0,P.jsx)(Ae.Z,{size:"small",columns:h,dataSource:q()(c).reverse(),scroll:{y:400},pagination:!1})},ve=function(O){var j=(0,S.useRef)(),f=(0,V.Z)(j),R=O.satelliteData,h=O.setSatelliteData,c=O.height,x=(0,S.useState)("text"),o=N()(x,2),d=o[0],y=o[1],A=(0,S.useMemo)(function(){var B=R.map(function(ae){return ae.features});return{type:"FeatureCollection",features:B.flat()}},[R]),U=[{key:"text",tab:"\u7F16\u8F91\u5668\u5C55\u793A"},{key:"table",tab:"\u8868\u683C\u5C55\u793A"}],L={text:(0,P.jsx)(g,{width:f==null?void 0:f.width,height:c,value:JSON.stringify(A!=null?A:(0,Z.rC)(),null,2)}),table:(0,P.jsx)(Ce,{satelliteData:R,setSatelliteData:h})};return(0,P.jsx)(p.Z,{ref:j,hoverable:!0,style:{width:"32%"},tabList:U,activeTabKey:d,onTabChange:y,children:L[d]})},Pe=function(){var se,O,j=(0,S.useRef)(),f=(0,V.Z)(j),R=Y.Z.useForm(),h=N()(R,1),c=h[0],x=(0,S.useState)(!1),o=N()(x,2),d=o[0],y=o[1],A=(0,S.useState)(null),U=N()(A,2),L=U[0],B=U[1],ae=(0,S.useState)(null),le=N()(ae,2),pe=le[0],ye=le[1],de=(0,S.useState)(I[0].url),w=N()(de,2),F=w[0],u=w[1],a=(0,S.useState)(I[0].extent),t=N()(a,2),n=t[0],r=t[1],s=(0,S.useState)([]),i=N()(s,2),l=i[0],m=i[1],v=(0,S.useState)(I[0].name),M=N()(v,2),C=M[0],H=M[1],_=function(){var z=W()(D()().mark(function k(J){var xe,Ie,Ee;return D()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return y(!0),ne.prev=1,xe=ue.y,Ie=new FormData,Ie.append("image_path",J),ne.next=7,fetch(xe,{body:Ie,method:"post"});case 7:return ne.next=9,ne.sent.arrayBuffer();case 9:Ee=ne.sent,L.setEmbedding(Ee),y(!1),ee.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),ne.next=19;break;case 15:ne.prev=15,ne.t0=ne.catch(1),y(!1),ee.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 19:case"end":return ne.stop()}},k,null,[[1,15]])}));return function(J){return z.apply(this,arguments)}}();(0,S.useEffect)(function(){var z=new me.XU({modelUrl:T.XM,wasmPaths:T.XT});z.initModel().then(function(){B(z)})},[]),(0,S.useEffect)(function(){if(L&&F&&n){var z=new Image;z.crossOrigin="anonymous",z.onload=function(){var k=(0,me.Ul)(z,"image/jpeg"),J=k.indexOf(","),xe=k==null?void 0:k.substring(J+1);_(xe),L.setGeoImage(z,{width:z.width,height:z.height,extent:n}),ye(z)},z.src=F}},[L,F]);var oe=function(k){var J=(0,Z.vd)(k,pe),xe=J.x,Ie=J.y,Ee=[{x:xe,y:Ie,clickType:1}];L.predict(Ee).then(function(){var be=W()(D()().mark(function ne(Me){var Re,ie,De,Ue;return D()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return Re=L.exportImageClip(Me),ie=L.exportMaskImage(Me),we.next=4,L.exportGeoPolygon(Me,1);case 4:De=we.sent,Ue={features:De.features,imageUrl:Re.src,maskImg:ie.src,key:String(new Date().getTime())},m(function(Oe){var ze=Oe.find(function($e){return $e.imageUrl===Ue.imageUrl});return ze?q()(Oe):[].concat(q()(Oe),[Ue])});case 7:case"end":return we.stop()}},ne)}));return function(ne){return be.apply(this,arguments)}}())},Le=function(k){return Array.isArray(k)?k:k==null?void 0:k.fileList},Fe=function(){var z=W()(D()().mark(function k(J){var xe,Ie,Ee,be,ne,Me;return D()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(ie.prev=0,!(J!=null&&J.upload)){ie.next=13;break}if(xe=J.upload,Ie=J.coordinate,Ee=xe[0],Ee.status!=="done"){ie.next=9;break}return ie.next=7,(0,me.y3)(Ee.originFileObj);case 7:be=ie.sent,u(be);case 9:ne=Ie.split(";").map(function(De){return De.split(",")}).flat(),r(ne),ie.next=16;break;case 13:Me=I.find(function(De){return De.name===J.choose}),u(Me==null?void 0:Me.url),r(Me==null?void 0:Me.extent);case 16:ie.next=21;break;case 18:ie.prev=18,ie.t0=ie.catch(0),ee.ZP.error("\u9519\u8BEF:".concat(ie.t0));case 21:case"end":return ie.stop()}},k,null,[[0,18]])}));return function(J){return z.apply(this,arguments)}}();(0,S.useEffect)(function(){if(c){var z,k,J=(z=I.find(function(Ie){return Ie.name===C}))===null||z===void 0?void 0:z.name,xe=JSON.stringify((k=I.find(function(Ie){return Ie.name===C}))===null||k===void 0?void 0:k.extent);c.setFieldsValue({choose:J,coordinate:xe})}},[c,C]);var Ze=function(k){k[0].name[0]==="choose"&&H(k[0].value),k[0].name[0]==="upload"&&c.setFieldsValue({coordinate:""})},Be=function(k,J){if(!J)return Promise.reject("\u8BF7\u8F93\u5165");var xe=J.split(";");return xe.length===0?Promise.reject("\u8BF7\u6B63\u786E\u8F93\u5165"):Promise.resolve(J)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(Y.Z,{form:c,onFinish:Fe,labelCol:{span:3},labelAlign:"left",className:"formLayout",onFieldsChange:Ze,children:[(0,P.jsx)(Y.Z.Item,{name:"choose",label:"\u793A\u4F8B",children:(0,P.jsx)(te.ZP.Group,{buttonStyle:"solid",onChange:function(){c.setFieldsValue({upload:void 0})},children:I.map(function(z){return(0,P.jsx)(te.ZP.Button,{value:z.name,children:z.name},z.name)})})}),(0,P.jsx)(Y.Z.Item,{label:"\u4E0A\u4F20\u56FE\u7247: (\u652F\u6301 3857 \u5750\u6807\u7CFB)",name:"upload",valuePropName:"fileList",getValueFromEvent:Le,children:(0,P.jsx)(G.Z,{multiple:!1,maxCount:1,accept:"image/*",children:(0,P.jsx)(Se.ZP,{type:"primary",icon:(0,P.jsx)(he.Z,{}),children:"\u70B9\u51FB\u4E0A\u4F20"})})}),(0,P.jsx)(Y.Z.Item,{name:"coordinate",label:"\u8F93\u5165\u5730\u7406\u5750\u6807",rules:[{required:!0,validator:Be}],children:(0,P.jsx)(re.Z,{placeholder:"[120.09979248046875,30.256694798480346;120.11352539062499,30.26381184075493]",style:{width:300}})}),(0,P.jsx)(Y.Z.Item,{children:(0,P.jsx)(Se.ZP,{type:"primary",htmlType:"submit",children:"\u63D0\u4EA4"})})]}),(0,P.jsx)(ce.Z,{spinning:d,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,P.jsxs)("div",{className:"normalMapContainer",style:{height:(se=f==null?void 0:f.height)!==null&&se!==void 0?se:500},children:[(0,P.jsxs)("div",{style:{width:"68%",position:"relative"},children:[(0,P.jsx)("img",{ref:j,src:F,onClick:oe,width:"100%",style:{position:"absolute",cursor:"pointer"}}),l.length?l.map(function(z,k){return(0,P.jsx)("img",{className:"normalMaskImg",src:z.maskImg},k)}):null]}),(0,P.jsx)(ve,{height:(O=f==null?void 0:f.height)!==null&&O!==void 0?O:400,satelliteData:l,setSatelliteData:m})]})})]})}},26843:function(je,Q,e){e.r(Q),e.d(Q,{default:function(){return I}});var K=e(19632),q=e.n(K),Te=e(15009),D=e.n(Te),ge=e(99289),W=e.n(ge),fe=e(5574),N=e.n(fe),Y=e(78356),ee=e(75081),te=e(3679),G=e(26713),Se=e(74809),re=e(66242),ce=e(18722),S=e(67294),he=e(44268),me=e(98126),V=e(67383),ue=e(90142),Z=e(18312),T=e(85893),I=function(){var p=(0,S.useRef)(),X=(0,S.useRef)(),$=(0,me.Z)(X),E=(0,S.useState)(!1),P=N()(E,2),g=P[0],b=P[1],Ae=(0,S.useState)(null),Ce=N()(Ae,2),ve=Ce[0],Pe=Ce[1],se=(0,S.useState)(null),O=N()(se,2),j=O[0],f=O[1],R=(0,S.useState)(""),h=N()(R,2),c=h[0],x=h[1],o=(0,S.useState)("#ad0404"),d=N()(o,2),y=d[0],A=d[1],U=(0,S.useState)([]),L=N()(U,2),B=L[0],ae=L[1];(0,S.useEffect)(function(){var w=new he.e7({modelUrl:Z.XM,WasmPaths:Z.XT});w.initModel().then(function(){return Pe(w)})},[]);var le=function(){var w=W()(D()().mark(function F(u,a){var t,n,r,s;return D()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return b(!0),t=new Image,t.src=a,t.onload=function(){ve.setImage(a),f(t)},l.prev=4,n=V.y,r=new FormData,r.append("image_path",u),l.next=10,fetch(n,{body:r,method:"post"});case 10:return l.next=12,l.sent.arrayBuffer();case 12:s=l.sent,ve.setEmbedding(s),b(!1),Y.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),l.next=22;break;case 18:l.prev=18,l.t0=l.catch(4),b(!1),Y.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 22:case"end":return l.stop()}},F,null,[[4,18]])}));return function(u,a){return w.apply(this,arguments)}}();(0,S.useEffect)(function(){if(V.y)try{var w=new Image;w.src="../../assets/2.png",w.onload=function(){var F=document.createElement("canvas");F.width=w.width,F.height=w.height;var u=F.getContext("2d");u.drawImage(w,0,0);var a=F.toDataURL("image/jpeg"),t=a.indexOf(","),n=a==null?void 0:a.substring(t+1);ve&&le(n,w.src)}}catch(F){b(!1),Y.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25")}},[ve]);var pe=function(){var w=W()(D()().mark(function F(u){var a,t,n,r;return D()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=u.file,a.status!=="done"){i.next=8;break}return i.next=4,(0,he.y3)(a.originFileObj);case 4:t=i.sent,n=t.indexOf(","),r=t==null?void 0:t.substring(n+1),le(r,t);case 8:case"end":return i.stop()}},F)}));return function(u){return w.apply(this,arguments)}}(),ye=function(F){var u=(0,ue.vd)(F,j),a=u.x,t=u.y,n={x:a,y:t,clickType:1};ae(function(r){return[].concat(q()(r),[n])})};(0,S.useEffect)(function(){var w=p.current;if(B.length!==0&&j){w.width=$==null?void 0:$.width,w.height=$==null?void 0:$.height;var F=w.getContext("2d"),u=($==null?void 0:$.width)/(j==null?void 0:j.width),a=($==null?void 0:$.height)/(j==null?void 0:j.height);B.forEach(function(t){var n=t.x,r=t.y;F.fillStyle="red",F.beginPath(),F.arc(n*u,r*a,6,0,2*Math.PI),F.fill()})}},[B,p.current,j]);var de=function(){ve.predict(B).then(function(F){var u=ve.exportImageClip(F);x(u.src),u.onload=function(){var a=(0,ue.SO)(ve.imageData,F.data,(0,ue.$F)(y));x(a)}}),ae([])};return(0,T.jsx)("div",{className:"content",children:(0,T.jsx)(ee.Z,{spinning:g,tip:"embedding...",children:(0,T.jsxs)("div",{className:"configArea",children:[(0,T.jsxs)(te.Z,{style:{width:"50%",maxWidth:"500px"},title:"\u5904\u7406\u524D",hoverable:!0,extra:(0,T.jsxs)(G.Z,{children:[(0,T.jsx)(Se.Z,{value:y,format:"hex",onChange:function(F,u){return A(u)}}),(0,T.jsx)(re.ZP,{type:"primary",style:{marginLeft:8},onClick:function(){return de()},children:"\u66F4\u6539\u80CC\u666F\u8272"})]}),children:[(0,T.jsx)("canvas",{id:"maskCircle",ref:p,style:{zIndex:10,position:"absolute",pointerEvents:"none"}}),j?(0,T.jsx)("img",{src:j.src,width:"100%",style:{position:"relative"},ref:X,onClick:ye}):(0,T.jsxs)(ce.Z,{showUploadList:!1,onChange:pe,maxCount:1,accept:"image/*",multiple:!1,style:{height:150},children:[(0,T.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,T.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u70B9\u51FB\u4E0A\u4F20"})]})]}),(0,T.jsx)(te.Z,{style:{width:"50%",maxWidth:"500px",marginLeft:"20px"},title:"\u5904\u7406\u540E",hoverable:!0,extra:(0,T.jsx)(re.ZP,{type:"primary",disabled:!c,onClick:function(){return(0,ue.YH)(c)},children:"\u4E0B\u8F7D"}),children:c?(0,T.jsx)("img",{src:c,width:"100%",ref:X,onClick:ye}):(0,T.jsxs)("div",{children:[(0,T.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,T.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u6682\u65E0\u56FE\u7247\u751F\u6210"})]})})]})})})}},82949:function(je,Q,e){e.r(Q),e.d(Q,{default:function(){return $}});var K=e(19632),q=e.n(K),Te=e(15009),D=e.n(Te),ge=e(99289),W=e.n(ge),fe=e(5574),N=e.n(fe),Y=e(82061),ee=e(96638),te=e(78356),G=e(75081),Se=e(26713),re=e(18722),ce=e(66242),S=e(33573),he=e(96074),me=e(32983),V=e(67294),ue=e(44268),Z=e(67383),T=e(90142),I=e(18312),p=e(85893),X={imageUrl:"",samModel:null,loading:!1,clipImg:[],originImg:null,originMaskImg:[],isSelecting:!1,startPoint:{x:0,y:0},endPoint:{x:0,y:0},clipType:"click",eventPoint:[]},$=function(){var E=(0,ee.Z)(X),P=N()(E,2),g=P[0],b=P[1];(0,V.useEffect)(function(){var h=new ue.e7({modelUrl:I.XM,WasmPaths:I.XT});h.initModel().then(function(){b({samModel:h})})},[]);var Ae=function(){var h=W()(D()().mark(function c(x,o){var d,y,A,U;return D()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.prev=0,d=Z.y,y=new FormData,y.append("image_path",x),B.next=6,fetch(d,{body:y,method:"post"});case 6:return B.next=8,B.sent.arrayBuffer();case 8:A=B.sent,g.samModel.setEmbedding(A),U=new Image,U.src=o,U.onload=function(){g.samModel.setImage(o),b({originImg:U})},b({imageUrl:o,loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),B.next=21;break;case 17:B.prev=17,B.t0=B.catch(0),b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 21:case"end":return B.stop()}},c,null,[[0,17]])}));return function(x,o){return h.apply(this,arguments)}}(),Ce=function(){var h=W()(D()().mark(function c(x){var o,d,y,A;return D()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(o=x.file,L.prev=1,b({clipImg:[],loading:!0}),o.status!=="done"){L.next=10;break}return L.next=6,(0,ue.y3)(o.originFileObj);case 6:d=L.sent,y=d.indexOf(","),A=d==null?void 0:d.substring(y+1),Ae(A,d);case 10:L.next=16;break;case 12:L.prev=12,L.t0=L.catch(1),b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 16:case"end":return L.stop()}},c,null,[[1,12]])}));return function(x){return h.apply(this,arguments)}}();function ve(h){var c=h.size/1024/1024<1.1;if(!c){te.ZP.error("\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC71.1MB!"),b({loading:!1});return}}(0,V.useEffect)(function(){if(Z.y)try{var h=new Image;h.src="../../assets/demo1.jpg",h.onload=function(){b({loading:!0});var c=document.createElement("canvas");c.width=h.width,c.height=h.height;var x=c.getContext("2d");x.drawImage(h,0,0);var o=c.toDataURL("image/jpeg"),d=o.indexOf(","),y=o==null?void 0:o.substring(d+1);g.samModel&&Ae(y,h.src)}}catch(c){b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25")}},[g.samModel]);var Pe=function(c){if(g.clipType==="click"){var x=c.nativeEvent.target.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,y=Math.round(c.pageX-x.left-d),A=Math.round(c.pageY-x.top-o),U=g.originImg?g.originImg.width/c.nativeEvent.target.offsetWidth:1;y*=U,A*=U,b({eventPoint:[y,A]})}},se=function(c){if(c.preventDefault(),g.clipType!=="click"){var x=c.nativeEvent.target.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,y=Math.round(c.pageX-x.left-d),A=Math.round(c.pageY-x.top-o);b({isSelecting:!0,startPoint:{x:y,y:A}})}},O=function(c){if(c.preventDefault(),g.clipType!=="click"){var x=c.nativeEvent.target.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,y=Math.round(c.pageX-x.left-d),A=Math.round(c.pageY-x.top-o);b({endPoint:{x:y,y:A}})}},j=function(c){if(g.clipType!=="click"){b({isSelecting:!1});var x=g.startPoint,o=g.endPoint,d={x:Math.min(x.x,o.x),y:Math.min(x.y,o.y),width:Math.abs(x.x-o.x),height:Math.abs(x.y-o.y)};b({endPoint:{x:0,y:0},startPoint:{x:0,y:0}});var y=g.originImg?g.originImg.width/c.nativeEvent.target.offsetWidth:1,A=g.originImg?g.originImg.height/c.nativeEvent.target.offsetHeight:1,U=[d.x*y,d.y*A],L=[d.x*y+d.width*y,d.y*A+d.height*A],B=[].concat(U,L);b({eventPoint:B})}},f=function(){g.clipType!=="click"&&b({endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},R=(0,V.useMemo)(function(){if(!g.isSelecting)return null;var h=g.startPoint,c=g.endPoint;return(0,p.jsx)("div",{style:{position:"absolute",left:h.x,top:h.y,width:c.x-h.x,height:c.y-h.y,backgroundColor:"rgba(255, 0, 255, 0.3)",border:"1px dashed red",pointerEvents:"none",zIndex:1}})},[g.isSelecting,g.startPoint,g.endPoint]);return(0,V.useEffect)(function(){if(g.samModel&&g.eventPoint.length!==0){var h=g.eventPoint,c;g.clipType==="click"&&(c=[{x:h[0],y:h[1],clickType:1}]),g.clipType==="selectend"&&(c=[{x:h[0],y:h[1],clickType:2},{x:h[2],y:h[3],clickType:3}]);var x=function(d){var y=g.samModel.exportImageClip(d),A=g.samModel.exportMaskImage(d),U=String(new Date().getTime());b(function(L){return{clipImg:[].concat(q()(L.clipImg),[{clipSrc:y.src,maskSrc:A.src,mark:U}])}})};setTimeout(function(){g.samModel.predict(c).then(x)})}},[g.eventPoint,g.samModel,g.clipType]),(0,p.jsxs)(G.Z,{spinning:g.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:[(0,p.jsxs)(Se.Z,{style:{marginBottom:16},children:[(0,p.jsxs)(re.Z,{className:"samPic__upload",multiple:!1,maxCount:1,showUploadList:!1,onChange:Ce,accept:"image/*",beforeUpload:ve,children:[(0,p.jsx)(ce.ZP,{type:"primary",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u4E0A\u4F20"}),(0,p.jsx)(ce.ZP,{type:"primary",children:"\u70B9\u51FB\u4E0A\u4F20\u3002"})]}),(0,p.jsx)(S.ZP.Group,{style:{margin:"10px 0"},onChange:function(c){b({clipType:c.target.value,endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},value:g.clipType,buttonStyle:"solid",children:I._$.map(function(h){return(0,p.jsx)(S.ZP.Button,{value:h.value,children:h.label},h.value)})}),(0,p.jsx)(ce.ZP,{block:!0,type:"primary",disabled:g.clipImg.length<=0,onClick:function(){return(0,T.O6)(g.clipImg,"clipImages")},style:{margin:"10px 0"},children:"\u4E0B\u8F7D\u6570\u636E"})]}),(0,p.jsxs)("div",{className:"samPic",children:[(0,p.jsx)("div",{className:"samPic__tool",children:g.clipImg.length>0?(0,p.jsx)("div",{className:"clipImgContent",children:g.clipImg.map(function(h,c){var x=h.clipSrc,o=h.mark;return(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsx)("img",{src:x,style:{width:100}}),(0,p.jsx)("div",{className:"tools",children:(0,p.jsx)(Y.Z,{style:{opacity:.8},onClick:function(){b(function(y){return{clipImg:y.clipImg.filter(function(A){return A.mark!==o})}})}})}),(0,p.jsx)(he.Z,{style:{margin:"8px 0"}})]},c)})}):(0,p.jsx)(me.Z,{description:"\u6682\u65E0\u56FE\u7247"})}),(0,p.jsx)("div",{className:"samPic__preview",children:g.imageUrl&&(0,p.jsxs)("div",{style:{position:"relative"},children:[g.clipImg.length?g.clipImg.map(function(h,c){return(0,p.jsx)("img",{className:"samPic__preview__maskImg",src:h.maskSrc},c)}):null,(0,p.jsx)("img",{className:"samPic__preview__img",onClick:Pe,onMouseDown:se,onMouseMove:O,onMouseUp:j,onMouseOut:f,src:g.imageUrl,style:{cursor:g.clipType==="click"?"pointer":"crosshair"}}),g.clipType!=="click"&&R]})}),(0,p.jsx)("div",{className:"samPic__tool",children:g.clipImg.length>0?(0,p.jsx)("div",{className:"clipImgContent",children:g.clipImg.map(function(h,c){var x=h.clipSrc,o=h.mark;return(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsx)("img",{src:x,style:{width:50}}),(0,p.jsx)("div",{className:"tools",children:(0,p.jsx)(Y.Z,{style:{opacity:.8},onClick:function(){b(function(y){return{clipImg:y.clipImg.filter(function(A){return A.mark!==o})}})}})}),(0,p.jsx)(he.Z,{style:{margin:"8px 0"}})]},c)})}):(0,p.jsx)(me.Z,{description:"\u6682\u65E0\u56FE\u7247"})})]})]})}},97314:function(je,Q,e){e.r(Q),e.d(Q,{default:function(){return Pe}});var K=e(15009),q=e.n(K),Te=e(19632),D=e.n(Te),ge=e(99289),W=e.n(ge),fe=e(5574),N=e.n(fe),Y=e(7539),ee=e(78356),te=e(66242),G=e(33573),Se=e(75081),re=e(67294),ce=e(44268),S=e(54539),he=e(96638),me=e(67383),V=e(18312),ue=e(37653),Z=e(43929),T=e(99247),I=e(90142),p=e(78234),X=e(63428),$=e(2302),E=e(85893),P=function(O){var j=O.value;return X.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(R){return[{range:R.getFullModelRange(),text:(0,I.XG)({content:R.getValue()})}]}}),(0,p.Z)(function(){X.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,E.jsx)($.ZP,{width:400,height:"calc(70vh - 56px)",language:"json",value:(0,I.XG)({content:j}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},g=e(61781),b=e(69323),Ae=function(O){var j=O.samInfo,f=O.setSamState,R=function(o){f(function(d){return{satelliteData:d.satelliteData.filter(function(y){return y.imageUrl!==o.image})}}),ee.ZP.success("\u5220\u9664\u6210\u529F")},h=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(o){return(0,E.jsx)(g.Z,{placement:"topLeft",title:o,children:o})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(o){return(0,E.jsx)(g.Z,{color:"#fff",placement:"topLeft",title:(0,E.jsx)("img",{src:o,style:{width:200,height:200}}),children:(0,E.jsx)("img",{src:o,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(o,d){return(0,E.jsx)(te.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return R(d)},children:"\u5220\u9664"})}}],c=j.satelliteData.map(function(x,o){var d,y=(d=x.features[0])===null||d===void 0?void 0:d.geometry;return{key:o,geometry:JSON.stringify(y),image:x.imageUrl}});return(0,E.jsx)(b.Z,{size:"small",columns:h,dataSource:D()(c).reverse()})},Ce=function(O){var j=O.samInfo,f=O.setSamState,R=(0,re.useMemo)(function(){var c=j.satelliteData.map(function(x){return x.features});return{type:"FeatureCollection",features:c.flat()}},[j.satelliteData]),h=[{key:"text",label:"\u7F16\u8F91\u5668\u5C55\u793A",children:(0,E.jsx)(P,{value:JSON.stringify(R!=null?R:(0,I.rC)(),null,2)})},{key:"table",label:"\u8868\u683C\u5C55\u793A",children:(0,E.jsx)(Ae,{samInfo:j,setSamState:f})}];return(0,E.jsxs)("div",{className:"rightContainer",style:{width:j.collapsed?400:0},children:[(0,E.jsx)("div",{className:"rightContainer__collapsed",onClick:function(){return f(function(x){return{collapsed:!x.collapsed}})},children:j.collapsed?(0,E.jsx)(ue.Z,{className:"rightContainer__collapsed__icon"}):(0,E.jsx)(Z.Z,{className:"rightContainer__collapsed__icon"})}),j.collapsed&&(0,E.jsx)(T.Z,{style:{width:j.collapsed?400:0},items:h,tabBarExtraContent:(0,E.jsx)(te.ZP,{size:"small",type:"primary",disabled:j.satelliteData.length<=0,onClick:function(){return(0,I.O6)(j.satelliteData)},children:"\u4E0B\u8F7D\u6570\u636E"})})]})},ve={samModel:null,currentScene:null,currentSource:null,mapClick:null,loading:!1,borderLayer:null,eventType:"click",collapsed:!0,satelliteData:[]},Pe=function(){var se=17,O=(0,he.Z)(ve),j=N()(O,2),f=j[0],R=j[1],h=function(d){var y,A,U=V.Kl.find(function(L){return L.name===d.target.value});U&&((y=f.currentScene)===null||y===void 0||y.setCenter(U.coord)),(A=f.currentScene)===null||A===void 0||A.setZoom(U.zoom||17)},c=function(d){var y=Array.isArray(d),A=y?d:[d.lngLat.lng,d.lngLat.lat];R({mapClick:A})},x=function(){var o=W()(q()().mark(function d(){var y,A,U,L,B,ae,le,pe,ye,de,w,F,u,a,t,n,r,s,i;return q()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return R({loading:!0}),L=(y=f.currentSource)===null||y===void 0||(A=y.tileset)===null||A===void 0?void 0:A.currentTiles,B=1/0,ae=1/0,le=-1/0,pe=-1/0,L==null||L.forEach(function(v){B=Math.min(B,v.x),ae=Math.min(ae,v.y),le=Math.max(le,v.x),pe=Math.max(pe,v.y)}),ye=Math.ceil((U=f.currentScene)===null||U===void 0?void 0:U.getZoom()),de=document.createElement("canvas"),de.width=(le-B+1)*256,de.height=(pe-ae+1)*256,w=de.getContext("2d"),F=f.samModel.mapHelper,u=[].concat(D()(F.tileToLngLat(B,pe+1,ye)),D()(F.tileToLngLat(le+1,ae,ye))),L==null||L.forEach(function(v){v&&(w==null||w.drawImage(v.data,(v.x-B)*256,(v.y-ae)*256,256,256))}),f.samModel.setGeoImage(de.toDataURL(),{extent:u,width:de.width,height:de.height}),a=de.toDataURL("image/jpeg"),t=a.indexOf(","),n=a==null?void 0:a.substring(t+1),r=me.y,s=new FormData,s.append("image_path",n),m.next=24,fetch(r,{body:s,method:"post"});case 24:return m.next=26,m.sent.arrayBuffer();case 26:i=m.sent,f.samModel.setEmbedding(i),R({loading:!1}),ee.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210");case 30:case"end":return m.stop()}},d)}));return function(){return o.apply(this,arguments)}}();return(0,re.useEffect)(function(){if(!(!f.mapClick||!f.samModel)){var o=[];try{var d=f.mapClick;if(f.eventType==="click"){var y=f.samModel.lngLat2ImagePixel(d);o.push({x:y[0],y:y[1],clickType:1})}else if(f.eventType==="selectend"){var A=f.samModel.lngLat2ImagePixel([d[0],d[3]]),U=f.samModel.lngLat2ImagePixel([d[2],d[1]]);o.push({x:A[0],y:A[1],clickType:2}),o.push({x:U[0],y:U[1],clickType:3})}else f.eventType==="all"&&console.log(f.samModel.image.width,f.samModel.image.height);if(o.length===0)return;f.samModel.predict(o).then(function(){var L=W()(q()().mark(function B(ae){var le,pe,ye;return q()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,f.samModel.exportGeoPolygon(ae,1);case 2:le=w.sent,pe=f.samModel.exportImageClip(ae),ye={features:le.features,imageUrl:pe.src},R(function(F){var u=F.satelliteData.find(function(a){return a.imageUrl===ye.imageUrl});return u?{satelliteData:D()(F.satelliteData)}:{satelliteData:[].concat(D()(F.satelliteData),[ye])}});case 6:case"end":return w.stop()}},B)}));return function(B){return L.apply(this,arguments)}}())}catch(L){ee.ZP.error("\u8BF7\u5148\u70B9\u51FB[\u751F\u6210 embedding] \u6309\u94AE")}}},[f.mapClick]),(0,re.useEffect)(function(){if(f.borderLayer){var o=f.satelliteData.map(function(y){return y.features}),d={type:"FeatureCollection",features:o.flat()};f.borderLayer.setData(d)}},[f.borderLayer,f.satelliteData]),(0,re.useEffect)(function(){var o=new Y.xsS({id:"map",map:new S.Z({center:[120.10533489408249,30.261061158180482],zoom:se,minZoom:3,style:"blank"})}),d=new Y.Hw6(V.Hj,{parser:{type:"rasterTile",tileSize:256}}),y=new Y.YYg({zIndex:-2}).source(d),A=new Y.dWg({zIndex:10}).source({type:"FeatureCollection",features:[]}).shape("line").size(2).color("#f00").style({opacity:1});o.on("loaded",function(){o.addLayer(y),o.addLayer(A),R({borderLayer:A,currentScene:o,currentSource:d}),o.on("click",c),o.on("selectend",c)})},[]),(0,re.useEffect)(function(){f.eventType==="selectend"&&f.currentScene?f.currentScene.enableBoxSelect(!1):f.currentScene&&f.currentScene.disableBoxSelect()},[f.eventType]),(0,re.useEffect)(function(){var o=new ce.XU({modelUrl:V.XM,wasmPaths:V.XT});o.initModel().then(function(){R({samModel:o})})},[]),(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(te.ZP,{onClick:x,children:" \u751F\u6210 embedding "}),(0,E.jsx)(G.ZP.Group,{style:{margin:"15px"},onChange:h,defaultValue:"A \u7A7A\u95F4",buttonStyle:"solid",children:V.Kl.map(function(o){return(0,E.jsx)(G.ZP.Button,{value:o.name,children:o.name},o.name)})}),(0,E.jsx)(Se.Z,{spinning:f.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,E.jsxs)("div",{className:"mapContainer",children:[(0,E.jsx)("div",{id:"map",className:"mapContainer__map",style:{width:"calc(100vw - ".concat(f.collapsed?400:0,"px)")},children:(0,E.jsx)(G.ZP.Group,{style:{position:"absolute",top:15,left:15,zIndex:100},onChange:function(d){R({eventType:d.target.value})},value:f.eventType,size:"small",buttonStyle:"solid",children:V.bw.map(function(o){return(0,E.jsx)(G.ZP.Button,{value:o.value,children:o.label},o.value)})})}),(0,E.jsx)(Ce,{samInfo:f,setSamState:R})]})})]})}},44268:function(je,Q,e){e.d(Q,{e7:function(){return f},XU:function(){return F},y3:function(){return E},Ul:function(){return Z}});var K=e(18736),q=function(a){var t=a.clicks,n=a.tensor,r=a.modelScale,s=n,i,l,m,v;if(t){var M=t.length;i=new Float32Array(2*(M+1)),l=new Float32Array(M+1);for(var C=0;C<M;C++)i[2*C]=t[C].x*r.samScale,i[2*C+1]=t[C].y*r.samScale,l[C]=t[C].clickType;i[2*M]=0,i[2*M+1]=0,l[M]=-1,m=new K.Tensor("float32",i,[1,M+1,2]),v=new K.Tensor("float32",l,[1,M+1])}var H=new K.Tensor("float32",[r.height,r.width]);if(!(m===void 0||v===void 0)){var _=new K.Tensor("float32",new Float32Array(256*256),[1,1,256,256]),oe=new K.Tensor("float32",[0]);return{image_embeddings:s,point_coords:m,point_labels:v,orig_im_size:H,mask_input:_,has_mask_input:oe}}},Te=e(15009),D=e.n(Te),ge=e(99289),W=e.n(ge),fe=e(12444),N=e.n(fe),Y=e(72004),ee=e.n(Y),te=e(9783),G=e.n(te),Se=e(781),re="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",ce=e(5574),S=e.n(ce),he=e(69826),me=e(16479),V=e.n(me);function ue(u){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=u.width,a.height=u.height,t==null||t.putImageData(u,0,0),a}function Z(u){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"image/png",t=document.createElement("canvas"),n=t.getContext("2d");return t.width=u.width,t.height=u.height,n.drawImage(u,0,0,u.width,u.height),t.toDataURL(a)}function T(u){var a=ue(u),t=new Image;return t.src=a.toDataURL(),t}function I(u,a,t,n){for(var r=new Uint8ClampedArray(u.data),s=new Uint8ClampedArray(4*t*n),i=0;i<a.length;i++)if(a[i]>0){var l=4*i;s[l+0]=r[l+0],s[l+1]=r[l+1],s[l+2]=Math.max(r[l+2],200),s[l+3]=r[l+3]}return T(new ImageData(s,t,n))}function p(u,a,t){for(var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:15,r=a,s=0,i=t,l=0,m=0;m<u.length;m++)if(u[m]>0){var v=m%a,M=Math.floor(m/a);r=Math.min(r,v),s=Math.max(s,v),i=Math.min(i,M),l=Math.max(l,M)}return[r-n,s+n,i-n,l+n]}function X(u,a,t,n,r,s){for(var i=[],l=0,m=a;m<n;m++)for(var v=u;v<t;v++){var M=m*s+v;i[l++]=r[M]>0?1:-1}return i}function $(u,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=u.map(function(i){return{x:i[0]+a,y:i[1]+t}});if(n===0)return r;var s=V()(r,n,!0);return s}var E=function(a){return new Promise(function(t,n){var r=new FileReader;r.readAsDataURL(a),r.onload=function(){return t(r.result)},r.onerror=function(s){return n(s)}})};function P(u,a,t){var n=p(u,a,t),r=S()(n,4),s=r[0],i=r[1],l=r[2],m=r[3],v=X(s,l,i,m,u,a),M=I(v,i-s,m-l);return T(M)}function g(u,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=p(u,a,t),s=S()(r,4),i=s[0],l=s[1],m=s[2],v=s[3],M=X(i,m,l,v,u,a),C=l-i,H=v-m,_=he.Z().size([C,H]).smooth(!1).thresholds(2),oe=_(M);return $(oe[1].coordinates[0][0],i,m,n)}function b(u,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=0;n<a.length;n++)(t?a[n]<=0:a[n]>0)&&(u.data[4*n+0]=0,u.data[4*n+1]=0,u.data[4*n+2]=0,u.data[4*n+3]=0);return T(u)}function Ae(u,a,t,n){for(var r=p(a,t,n),s=S()(r,4),i=s[0],l=s[1],m=s[2],v=s[3],M=new Uint8ClampedArray(4*(l-i)*(v-m)).fill(0),C=0,H=m;H<v;H++)for(var _=i;_<l;_++){var oe=H*t+_;a[oe]>0&&(M[C*4]=u.data[oe*4],M[C*4+1]=u.data[oe*4+1],M[C*4+2]=u.data[oe*4+2],M[C*4+3]=u.data[oe*4+3]),C++}var Le=new ImageData(M,l-i,v-m);return T(Le)}function Ce(u){var a=document.createElement("a");a.href=u.src,a.download="image",a.click()}function ve(u){var a=document.createElement("a");a.href=u.toDataURL("image/png"),a.download="image",a.click()}function Pe(u){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=u.width,a.height=u.height,t==null||t.drawImage(u,0,0),t==null?void 0:t.getImageData(0,0,u.width,u.height)}var se=function(a){var t=1024,n=a.naturalWidth,r=a.naturalHeight,s=t/Math.max(r,n);return{height:r,width:n,samScale:s}},O=function(a,t){var n=1024,r=n/Math.max(t,a);return{height:t,width:a,samScale:r}},j=e(18736),f=function(){function u(a){N()(this,u),G()(this,"modelUrl",re),G()(this,"model",void 0),G()(this,"image",void 0),G()(this,"imageData",void 0),G()(this,"modelScale",void 0),G()(this,"tensor",void 0),a!=null&&a.modelUrl&&(this.modelUrl=a.modelUrl),a!=null&&a.wasmPaths&&this.setWasmUrl(a.wasmPaths)}return ee()(u,[{key:"initModel",value:function(){var a=W()(D()().mark(function n(){var r;return D()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,K.InferenceSession.create(this.modelUrl);case 3:r=i.sent,this.model=r,i.next=10;break;case 7:throw i.prev=7,i.t0=i.catch(0),new Error("\u6A21\u578B\u52A0\u8F7D\u5931\u8D25");case 10:case"end":return i.stop()}},n,this,[[0,7]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"setImage",value:function(){var a=W()(D()().mark(function n(r){var s=this;return D()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:typeof r=="string"?(this.image=new Image,this.image.src=r,this.image.onload=function(){s.getImageScale(s.image),s.imageData=Pe(s.image)}):(this.image=r,this.getImageScale(this.image),this.imageData=Pe(this.image));case 1:case"end":return l.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"setEmbedding",value:function(){var a=W()(D()().mark(function n(r){var s,i,l,m,v=arguments;return D()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(s=v.length>1&&v[1]!==void 0?v[1]:"float32",i=new Se.Z,typeof r!="string"){C.next=6;break}C.t0=i.load(r),C.next=9;break;case 6:return C.next=8,i.parse(r);case 8:C.t0=C.sent;case 9:l=C.t0,m=new j.Tensor(s,l.data,l.shape),this.tensor=m;case 12:case"end":return C.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predict",value:function(){var a=W()(D()().mark(function n(r){var s,i,l;return D()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,!(this.model===null||r===null||this.tensor===null||this.modelScale===null)){v.next=6;break}return console.log("model not loaded"),v.abrupt("return");case 6:if(s=q({clicks:r,tensor:this.tensor,modelScale:this.modelScale}),s!==void 0){v.next=9;break}return v.abrupt("return");case 9:return v.next=11,this.model.run(s);case 11:return i=v.sent,l=i[this.model.outputNames[0]],v.abrupt("return",l);case 14:v.next=20;break;case 16:return v.prev=16,v.t0=v.catch(0),console.log(v.t0),v.abrupt("return");case 20:case"end":return v.stop()}},n,this,[[0,16]])}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predictByBox",value:function(){var a=W()(D()().mark(function n(r){return D()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",r);case 1:case"end":return i.stop()}},n)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"exportMaskImage",value:function(t){if(this.imageData!==void 0)return I(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportMaskClip",value:function(t){return P(t.data,t.dims[3],t.dims[2])}},{key:"exportImage",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.imageData!==void 0)return b(this.imageData,t.data,n)}},{key:"exportImageClip",value:function(t){if(this.imageData!==void 0)return Ae(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportVector",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return g(t.data,t.dims[3],t.dims[2],n)}},{key:"setWasmUrl",value:function(t){K.env.wasm.wasmPaths=t}},{key:"getImageScale",value:function(t){var n=t.width,r=t.height;this.modelScale=O(n,r)}}]),u}(),R=e(19632),h=e.n(R),c=e(25098),x=e.n(c),o=e(28785),d=e.n(o),y=e(48374),A=e.n(y),U=e(31996),L=e.n(U),B=e(26037),ae=e.n(B),le=function(){function u(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:256,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"tms";N()(this,u),G()(this,"tileSize",void 0),G()(this,"type",void 0),G()(this,"initialResolution",void 0),G()(this,"originShift",void 0),this.tileSize=a,this.type=t,this.initialResolution=2*Math.PI*6378137/this.tileSize,this.originShift=2*Math.PI*6378137/2}return ee()(u,[{key:"lngLatToMeters",value:function(t,n){var r=t*this.originShift/180,s=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return s=s*this.originShift/180,[r,s]}},{key:"metersToLngLat",value:function(t,n){var r=t/this.originShift*180,s=n/this.originShift*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),[r,s]}},{key:"pixelsToMeters",value:function(t,n,r){var s=this.resolution(r),i=t*s-this.originShift,l=(this.type==="tms"?n:Math.pow(2,r)*256-n)*s-this.originShift;return[i,l]}},{key:"metersToPixels",value:function(t,n,r){var s=this.resolution(r),i=(t+this.originShift)/s,l=(n+this.originShift)/s;return l=this.type==="tms"?l:Math.pow(2,r)*256-l,[i,l]}},{key:"metersToTile",value:function(t,n,r){var s=this.metersToPixels(t,n,r),i=S()(s,2),l=i[0],m=i[1];return this.pixelsToTile(l,m)}},{key:"tileToMeters",value:function(t,n,r){return this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r)}},{key:"tileToLngLat",value:function(t,n,r){var s=this.tileToMeters(t,n,r),i=S()(s,2),l=i[0],m=i[1];return this.metersToLngLat(l,m)}},{key:"pixelsToTile",value:function(t,n){var r=Math.floor(Math.ceil(t/this.tileSize)-1),s=Math.floor(Math.ceil(n/this.tileSize)-1);return[r,s]}},{key:"pixelsToRaster",value:function(t,n,r){var s=this.tileSize<<r;return[t,s-n]}},{key:"tileBounds",value:function(t,n,r){var s=this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r),i=S()(s,2),l=i[0],m=i[1],v=this.pixelsToMeters((t+1)*this.tileSize,(n+1)*this.tileSize,r),M=S()(v,2),C=M[0],H=M[1];return[l,m,C,H]}},{key:"tileLatLonBounds",value:function(t,n,r){var s=this.tileBounds(t,n,r),i=this.metersToLngLat(s[0],s[1]),l=S()(i,2),m=l[0],v=l[1],M=this.metersToLngLat(s[2],s[3]),C=S()(M,2),H=C[0],_=C[1];return[m,v,H,_]}},{key:"resolution",value:function(t){return this.initialResolution/Math.pow(2,t)}},{key:"lngLatToPixels",value:function(t,n,r){var s=this.lngLatToMeters(t,n),i=S()(s,2),l=i[0],m=i[1];return this.metersToPixels(l,m,r)}},{key:"pixelsTolngLat",value:function(t,n,r){var s=this.pixelsToMeters(t,n,r);return this.metersToLngLat(s[0],s[1])}},{key:"lngLatToTile",value:function(t,n,r){var s=this.lngLatToPixels(t,n,r),i=S()(s,2),l=i[0],m=i[1];return this.pixelsToTile(l,m)}},{key:"googleTile",value:function(t,n,r){return[t,Math.pow(2,r)-1-n]}},{key:"boundsToTileExtent",value:function(t,n,r,s,i){var l=this.lngLatToTile(t,s,i),m=S()(l,2),v=m[0],M=m[1],C=this.lngLatToTile(r,n,i),H=S()(C,2),_=H[0],oe=H[1];return[[v,M],[_,oe]]}},{key:"metersboundsToTileExtent",value:function(t,n,r,s,i){var l=this.metersToTile(t,s,i),m=S()(l,2),v=m[0],M=m[1],C=this.metersToTile(r,n,i),H=S()(C,2),_=H[0],oe=H[1];return[[v,M],[_,oe]]}}]),u}(),pe=null,ye=function(a){var t=_slicedToArray(a,4),n=t[0],r=t[1],s=t[2],i=t[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[n,r],[n,i],[s,i],[s,r],[n,r]]]}}]}},de=function(a){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[a]}}]}},w=function(){return{type:"FeatureCollection",features:[]}},F=function(u){L()(t,u);var a=ae()(t);function t(){var n;N()(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return n=a.call.apply(a,[this].concat(s)),G()(x()(n),"imageOption",void 0),G()(x()(n),"imageBounds",void 0),G()(x()(n),"metersPerpixelsX",0),G()(x()(n),"metersPerpixelsY",0),G()(x()(n),"mapHelper",new le(256,"google")),n}return ee()(t,[{key:"setGeoImage",value:function(){var n=W()(D()().mark(function s(i,l){var m,v,M;return D()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:d()(A()(t.prototype),"setImage",this).call(this,i),this.imageOption=l,m=l.extent,v=l.width,M=l.height,m&&(this.imageBounds=[].concat(h()(this.mapHelper.lngLatToMeters(m[0],m[1])),h()(this.mapHelper.lngLatToMeters(m[2],m[3]))),this.metersPerpixelsX=(this.imageBounds[2]-this.imageBounds[0])/v,this.metersPerpixelsY=(this.imageBounds[3]-this.imageBounds[1])/M);case 4:case"end":return H.stop()}},s,this)}));function r(s,i){return n.apply(this,arguments)}return r}()},{key:"exportGeoPolygon",value:function(){var n=W()(D()().mark(function s(i){var l=this,m,v,M,C,H,_=arguments;return D()().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:return m=_.length>1&&_[1]!==void 0?_[1]:5,Le.next=3,this.exportVector(i,m);case 3:return v=Le.sent,M=this.imageBounds,C=v.map(function(Fe){var Ze=[Fe.x*l.metersPerpixelsX+M[0],(l.imageOption.height-Fe.y)*l.metersPerpixelsY+M[1]],Be=l.mapHelper.metersToLngLat(Ze[0],Ze[1]);return Be}),H=de(C),Le.abrupt("return",H);case 8:case"end":return Le.stop()}},s,this)}));function r(s){return n.apply(this,arguments)}return r}()},{key:"lngLat2ImagePixel",value:function(r){if(this.imageBounds){var s=this.mapHelper.lngLatToMeters(r[0],r[1]),i=S()(s,2),l=i[0],m=i[1],v=(l-this.imageBounds[0])/this.metersPerpixelsX,M=(m-this.imageBounds[1])/this.metersPerpixelsY;return M=this.imageOption.height-M,[v,M]}}}]),t}(f)}}]);
