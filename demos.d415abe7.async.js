"use strict";(self.webpackChunk_antv_sam=self.webpackChunk_antv_sam||[]).push([[433],{18312:function(De,Q,e){e.d(Q,{Hj:function(){return q},Kl:function(){return W},XM:function(){return j},XT:function(){return me},_$:function(){return N},bw:function(){return ve}});var Y="https://www.google.com/maps/vt?lyrs=s@820&gl=cn&x={x}&y={y}&z={z}",q=Y,xe="https://t{0-7}.tianditu.gov.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk=b72aa81ac2b3cae941d1eb213499e15e",j="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",me="https://npm.elemecdn.com/onnxruntime-web/dist/",W=[{name:"A \u7A7A\u95F4",coord:[120.10533489408249,30.261061158180482],zoom:18},{name:"\u6CB9\u7F50",coord:[-96.74674229210954,35.935326263559816],zoom:15.5},{name:"\u519C\u7530",coord:[5.000138834496795,52.83911856295691],zoom:13.5},{name:"\u519C\u75302",coord:[-111.91603037093357,32.91837220530866],zoom:13},{name:"\u704C\u6E89\u519C\u7530",coord:[38.274419546979345,30.107721922396593],zoom:12.5},{name:"\u5EFA\u7B51",coord:[-75.68709358840009,45.40821167856009],zoom:18},{name:"\u5EFA\u7B512",coord:[-117.9375255130447,33.809435077864805],zoom:18.2},{name:"\u673A\u573A",coord:[-117.377,34.596],zoom:15.5},{name:"\u8349\u573A",coord:[28.725760156128445,22.24767189005027],zoom:12}],ve=[{label:"\u70B9\u9009",value:"click"}],N=[{label:"\u70B9\u9009",value:"click"},{label:"\u6846\u9009",value:"selectend"}]},67383:function(De,Q,e){e.d(Q,{y:function(){return Y}});var Y="https://sam.lvisei.icu/api"},90142:function(De,Q,e){e.d(Q,{$F:function(){return Se},O6:function(){return S},SO:function(){return fe},XG:function(){return ge},YH:function(){return V},rC:function(){return re},vd:function(){return ue}});var Y=e(5574),q=e.n(Y),xe=e(15009),j=e.n(xe),me=e(99289),W=e.n(me),ve=e(73945),N=e.n(ve),K=e(28182),ee=e.n(K),te=null,G=function(x){var A=_slicedToArray(x,4),T=A[0],X=A[1],$=A[2],E=A[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[T,X],[T,E],[$,E],[$,X],[T,X]]]}}]}},Te=function(x){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[x]}}]}},re=function(){return{type:"FeatureCollection",features:[]}};function ge(Z){var x=Z.content,A=x;typeof x!="string"&&(A=JSON.stringify(x,null,2));var T=N().format(A,{parser:"json",plugins:[ee()]});return T}var S=function(x){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"data-".concat(new Date().toLocaleString()),T=new Blob([ge({content:JSON.stringify(x)})],{type:"application/json"}),X=document.createElement("a");X.download="".concat(A,".json"),X.href=URL.createObjectURL(T),X.click()};function Se(Z){var x=parseInt(Z.slice(1,3),16),A=parseInt(Z.slice(3,5),16),T=parseInt(Z.slice(5,7),16);return[x,A,T,255]}function fe(Z,x){for(var A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[255,0,0,255],T=q()(A,4),X=T[0],$=T[1],E=T[2],M=T[3],g=0;g<x.length;g++)x[g]<=0&&(Z.data[4*g+0]=X,Z.data[4*g+1]=$,Z.data[4*g+2]=E,Z.data[4*g+3]=M);var b=document.createElement("canvas");b.width=Z.width,b.height=Z.height;var Ae=b.getContext("2d");return Ae.putImageData(Z,0,0),b.toDataURL("image/png")}var V=function(x){var A=document.createElement("a"),T=new Image;T.src=x,A.download="img.png",A.target="_blank",A.href=T.src,A.click()},ue=function(x,A){var T=x.nativeEvent.target.getBoundingClientRect(),X=window.pageYOffset||document.documentElement.scrollTop,$=window.pageXOffset||document.documentElement.scrollLeft,E=Math.round(x.pageX-T.left-$),M=Math.round(x.pageY-T.top-X),g=A?A.width/x.nativeEvent.target.offsetWidth:1,b=A?A.height/x.nativeEvent.target.offsetHeight:1;return E*=g,M*=b,{x:E,y:M}}},97827:function(De,Q,e){e.r(Q),e.d(Q,{default:function(){return Pe}});var Y=e(19632),q=e.n(Y),xe=e(15009),j=e.n(xe),me=e(99289),W=e.n(me),ve=e(5574),N=e.n(ve),K=e(4288),ee=e(78356),te=e(33573),G=e(18722),Te=e(66242),re=e(84385),ge=e(75081),S=e(67294),Se=e(88484),fe=e(44268),V=e(98126),ue=e(67383),Z=e(90142),x=e(18312),A=[{name:"A \u7A7A\u95F4",extent:[120.09979248046875,30.256694798480346,120.11352539062499,30.26381184075493],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*rOXuSb_Tv6MAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u6CB9\u7F50",extent:[-96.7620849609375,35.92464453144096,-96.734619140625,35.94243575255426],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4c-2T41ESekAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u519C\u7530",extent:[4.943847656250016,52.81604319154931,5.053710937499996,52.86912972768522],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*bKPgT4XGbFIAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u5706\u5F62\u519C\u7530",extent:[28.60839843749999,22.146707780012644,28.828125000000014,22.350075806124867],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4KUZSanj_NsAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u673A\u573A",extent:[-117.388916015625,34.58799745550485,-117.366943359375,34.6060845921693],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Y7OHSYNL1VkAAAAAAAAAAAAADmJ7AQ/original"}],T=e(3679),X=e(78234),$=e(63428),E=e(2302),M=e(85893),g=function(O){var D=O.value,f=O.width,R=O.height;return $.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(c){return[{range:c.getFullModelRange(),text:(0,Z.XG)({content:c.getValue()})}]}}),(0,X.Z)(function(){$.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,M.jsx)(E.ZP,{width:f-20,height:R-60,language:"json",value:(0,Z.XG)({content:D}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},b=e(61781),Ae=e(69323),Ce=function(O){var D=O.satelliteData,f=O.setSatelliteData,R=function(u){f(function(d){return q()(d.filter(function(p){return p.imageUrl!==u.image}))}),ee.ZP.success("\u5220\u9664\u6210\u529F")},h=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(u){return(0,M.jsx)(b.Z,{placement:"topLeft",title:u,children:u})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(u){return(0,M.jsx)(b.Z,{color:"#fff",placement:"topLeft",title:(0,M.jsx)("img",{src:u,style:{width:200,height:200}}),children:(0,M.jsx)("img",{src:u,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(u,d){return(0,M.jsx)(Te.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return R(d)},children:"\u5220\u9664"})}}],c=D.map(function(y,u){var d,p=(d=y.features[0])===null||d===void 0?void 0:d.geometry;return{key:u,geometry:JSON.stringify(p),image:y.imageUrl}});return(0,M.jsx)(Ae.Z,{size:"small",columns:h,dataSource:q()(c).reverse(),scroll:{y:400},pagination:!1})},ce=function(O){var D=(0,S.useRef)(),f=(0,V.Z)(D),R=O.satelliteData,h=O.setSatelliteData,c=O.height,y=(0,S.useState)("text"),u=N()(y,2),d=u[0],p=u[1],P=(0,S.useMemo)(function(){var B=R.map(function(ae){return ae.features});return{type:"FeatureCollection",features:B.flat()}},[R]),U=[{key:"text",tab:"\u7F16\u8F91\u5668\u5C55\u793A"},{key:"table",tab:"\u8868\u683C\u5C55\u793A"}],L={text:(0,M.jsx)(g,{width:f==null?void 0:f.width,height:c,value:JSON.stringify(P!=null?P:(0,Z.rC)(),null,2)}),table:(0,M.jsx)(Ce,{satelliteData:R,setSatelliteData:h})};return(0,M.jsx)(T.Z,{ref:D,hoverable:!0,style:{width:"32%"},tabList:U,activeTabKey:d,onTabChange:p,children:L[d]})},Pe=function(){var se,O,D=(0,S.useRef)(),f=(0,V.Z)(D),R=K.Z.useForm(),h=N()(R,1),c=h[0],y=(0,S.useState)(!1),u=N()(y,2),d=u[0],p=u[1],P=(0,S.useState)(null),U=N()(P,2),L=U[0],B=U[1],ae=(0,S.useState)(null),oe=N()(ae,2),he=oe[0],pe=oe[1],de=(0,S.useState)(A[0].url),w=N()(de,2),F=w[0],l=w[1],a=(0,S.useState)(A[0].extent),t=N()(a,2),n=t[0],r=t[1],s=(0,S.useState)([]),i=N()(s,2),o=i[0],m=i[1],v=(0,S.useState)(A[0].name),I=N()(v,2),C=I[0],H=I[1],_=function(){var z=W()(j()().mark(function k(J){var ye,Ie,Ee;return j()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return p(!0),ne.prev=1,ye=ue.y,Ie=new FormData,Ie.append("image_path",J),ne.next=7,fetch(ye,{body:Ie,method:"post"});case 7:return ne.next=9,ne.sent.arrayBuffer();case 9:Ee=ne.sent,L.setEmbedding(Ee),p(!1),ee.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),ne.next=19;break;case 15:ne.prev=15,ne.t0=ne.catch(1),p(!1),ee.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 19:case"end":return ne.stop()}},k,null,[[1,15]])}));return function(J){return z.apply(this,arguments)}}();(0,S.useEffect)(function(){var z=new fe.XU({modelUrl:x.XM,wasmPaths:x.XT});z.initModel().then(function(){B(z)})},[]),(0,S.useEffect)(function(){if(L&&F&&n){var z=new Image;z.crossOrigin="anonymous",z.onload=function(){var k=(0,fe.Ul)(z,"image/jpeg"),J=k.indexOf(","),ye=k==null?void 0:k.substring(J+1);_(ye),L.setGeoImage(z,{width:z.width,height:z.height,extent:n}),pe(z)},z.src=F}},[L,F]);var le=function(k){var J=(0,Z.vd)(k,he),ye=J.x,Ie=J.y,Ee=[{x:ye,y:Ie,clickType:1}];L.predict(Ee).then(function(){var be=W()(j()().mark(function ne(Me){var Re,ie,je,Ue;return j()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return Re=L.exportImageClip(Me),ie=L.exportMaskImage(Me),we.next=4,L.exportGeoPolygon(Me,1);case 4:je=we.sent,Ue={features:je.features,imageUrl:Re.src,maskImg:ie.src,key:String(new Date().getTime())},m(function(Oe){var ze=Oe.find(function($e){return $e.imageUrl===Ue.imageUrl});return ze?q()(Oe):[].concat(q()(Oe),[Ue])});case 7:case"end":return we.stop()}},ne)}));return function(ne){return be.apply(this,arguments)}}())},Le=function(k){return Array.isArray(k)?k:k==null?void 0:k.fileList},Fe=function(){var z=W()(j()().mark(function k(J){var ye,Ie,Ee,be,ne,Me;return j()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(ie.prev=0,!(J!=null&&J.upload)){ie.next=13;break}if(ye=J.upload,Ie=J.coordinate,Ee=ye[0],Ee.status!=="done"){ie.next=9;break}return ie.next=7,(0,fe.y3)(Ee.originFileObj);case 7:be=ie.sent,l(be);case 9:ne=Ie.split(";").map(function(je){return je.split(",")}).flat(),r(ne),ie.next=16;break;case 13:Me=A.find(function(je){return je.name===J.choose}),l(Me==null?void 0:Me.url),r(Me==null?void 0:Me.extent);case 16:ie.next=21;break;case 18:ie.prev=18,ie.t0=ie.catch(0),ee.ZP.error("\u9519\u8BEF:".concat(ie.t0));case 21:case"end":return ie.stop()}},k,null,[[0,18]])}));return function(J){return z.apply(this,arguments)}}();(0,S.useEffect)(function(){if(c){var z,k,J=(z=A.find(function(Ie){return Ie.name===C}))===null||z===void 0?void 0:z.name,ye=JSON.stringify((k=A.find(function(Ie){return Ie.name===C}))===null||k===void 0?void 0:k.extent);c.setFieldsValue({choose:J,coordinate:ye})}},[c,C]);var Ze=function(k){k[0].name[0]==="choose"&&H(k[0].value),k[0].name[0]==="upload"&&c.setFieldsValue({coordinate:""})},Be=function(k,J){if(!J)return Promise.reject("\u8BF7\u8F93\u5165");var ye=J.split(";");if(ye.length===0)return Promise.reject("\u8BF7\u6B63\u786E\u8F93\u5165")};return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(K.Z,{form:c,onFinish:Fe,labelCol:{span:3},labelAlign:"left",className:"formLayout",onFieldsChange:Ze,children:[(0,M.jsx)(K.Z.Item,{name:"choose",label:"\u793A\u4F8B",children:(0,M.jsx)(te.ZP.Group,{buttonStyle:"solid",onChange:function(){c.setFieldsValue({upload:void 0})},children:A.map(function(z){return(0,M.jsx)(te.ZP.Button,{value:z.name,children:z.name},z.name)})})}),(0,M.jsx)(K.Z.Item,{label:"\u4E0A\u4F20\u56FE\u7247: (\u652F\u6301 3857 \u5750\u6807\u7CFB)",name:"upload",valuePropName:"fileList",getValueFromEvent:Le,children:(0,M.jsx)(G.Z,{multiple:!1,maxCount:1,accept:"image/*",children:(0,M.jsx)(Te.ZP,{type:"primary",icon:(0,M.jsx)(Se.Z,{}),children:"\u70B9\u51FB\u4E0A\u4F20"})})}),(0,M.jsx)(K.Z.Item,{name:"coordinate",label:"\u8F93\u5165\u5730\u7406\u5750\u6807",rules:[{required:!0,validator:Be}],children:(0,M.jsx)(re.Z,{placeholder:"[120.09979248046875,30.256694798480346;120.11352539062499,30.26381184075493]",style:{width:300}})}),(0,M.jsx)(K.Z.Item,{children:(0,M.jsx)(Te.ZP,{type:"primary",htmlType:"submit",children:"\u63D0\u4EA4"})})]}),(0,M.jsx)(ge.Z,{spinning:d,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,M.jsxs)("div",{className:"normalMapContainer",style:{height:(se=f==null?void 0:f.height)!==null&&se!==void 0?se:500},children:[(0,M.jsxs)("div",{style:{width:"68%",position:"relative"},children:[(0,M.jsx)("img",{ref:D,src:F,onClick:le,width:"100%",style:{position:"absolute",cursor:"pointer"}}),o.length?o.map(function(z,k){return(0,M.jsx)("img",{className:"normalMaskImg",src:z.maskImg},k)}):null]}),(0,M.jsx)(ce,{height:(O=f==null?void 0:f.height)!==null&&O!==void 0?O:400,satelliteData:o,setSatelliteData:m})]})})]})}},26843:function(De,Q,e){e.r(Q),e.d(Q,{default:function(){return A}});var Y=e(19632),q=e.n(Y),xe=e(15009),j=e.n(xe),me=e(99289),W=e.n(me),ve=e(5574),N=e.n(ve),K=e(78356),ee=e(75081),te=e(3679),G=e(26713),Te=e(74809),re=e(66242),ge=e(18722),S=e(67294),Se=e(44268),fe=e(98126),V=e(67383),ue=e(90142),Z=e(18312),x=e(85893),A=function(){var T=(0,S.useRef)(),X=(0,S.useRef)(),$=(0,fe.Z)(X),E=(0,S.useState)(!1),M=N()(E,2),g=M[0],b=M[1],Ae=(0,S.useState)(null),Ce=N()(Ae,2),ce=Ce[0],Pe=Ce[1],se=(0,S.useState)(null),O=N()(se,2),D=O[0],f=O[1],R=(0,S.useState)(""),h=N()(R,2),c=h[0],y=h[1],u=(0,S.useState)("#ad0404"),d=N()(u,2),p=d[0],P=d[1],U=(0,S.useState)([]),L=N()(U,2),B=L[0],ae=L[1];(0,S.useEffect)(function(){var w=new Se.e7({modelUrl:Z.XM,WasmPaths:Z.XT});w.initModel().then(function(){return Pe(w)})},[]);var oe=function(){var w=W()(j()().mark(function F(l,a){var t,n,r,s;return j()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return b(!0),t=new Image,t.src=a,t.onload=function(){ce.setImage(a),f(t)},o.prev=4,n=V.y,r=new FormData,r.append("image_path",l),o.next=10,fetch(n,{body:r,method:"post"});case 10:return o.next=12,o.sent.arrayBuffer();case 12:s=o.sent,ce.setEmbedding(s),b(!1),K.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),o.next=22;break;case 18:o.prev=18,o.t0=o.catch(4),b(!1),K.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 22:case"end":return o.stop()}},F,null,[[4,18]])}));return function(l,a){return w.apply(this,arguments)}}();(0,S.useEffect)(function(){if(V.y)try{var w=new Image;w.src="../../assets/2.png",w.onload=function(){var F=document.createElement("canvas");F.width=w.width,F.height=w.height;var l=F.getContext("2d");l.drawImage(w,0,0);var a=F.toDataURL("image/jpeg"),t=a.indexOf(","),n=a==null?void 0:a.substring(t+1);ce&&oe(n,w.src)}}catch(F){b(!1),K.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25")}},[ce]);var he=function(){var w=W()(j()().mark(function F(l){var a,t,n,r;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=l.file,a.status!=="done"){i.next=8;break}return i.next=4,(0,Se.y3)(a.originFileObj);case 4:t=i.sent,n=t.indexOf(","),r=t==null?void 0:t.substring(n+1),oe(r,t);case 8:case"end":return i.stop()}},F)}));return function(l){return w.apply(this,arguments)}}(),pe=function(F){var l=(0,ue.vd)(F,D),a=l.x,t=l.y,n={x:a,y:t,clickType:1};ae(function(r){return[].concat(q()(r),[n])})};(0,S.useEffect)(function(){var w=T.current;if(B.length!==0&&D){w.width=$==null?void 0:$.width,w.height=$==null?void 0:$.height;var F=w.getContext("2d"),l=($==null?void 0:$.width)/(D==null?void 0:D.width),a=($==null?void 0:$.height)/(D==null?void 0:D.height);B.forEach(function(t){var n=t.x,r=t.y;F.fillStyle="red",F.beginPath(),F.arc(n*l,r*a,6,0,2*Math.PI),F.fill()})}},[B,T.current,D]);var de=function(){ce.predict(B).then(function(F){var l=ce.exportImageClip(F);y(l.src),l.onload=function(){var a=(0,ue.SO)(ce.imageData,F.data,(0,ue.$F)(p));y(a)}}),ae([])};return(0,x.jsx)("div",{className:"content",children:(0,x.jsx)(ee.Z,{spinning:g,tip:"embedding...",children:(0,x.jsxs)("div",{className:"configArea",children:[(0,x.jsxs)(te.Z,{style:{width:"50%",maxWidth:"500px"},title:"\u5904\u7406\u524D",hoverable:!0,extra:(0,x.jsxs)(G.Z,{children:[(0,x.jsx)(Te.Z,{value:p,format:"hex",onChange:function(F,l){return P(l)}}),(0,x.jsx)(re.ZP,{type:"primary",style:{marginLeft:8},onClick:function(){return de()},children:"\u66F4\u6539\u80CC\u666F\u8272"})]}),children:[(0,x.jsx)("canvas",{id:"maskCircle",ref:T,style:{zIndex:10,position:"absolute",pointerEvents:"none"}}),D?(0,x.jsx)("img",{src:D.src,width:"100%",style:{position:"relative"},ref:X,onClick:pe}):(0,x.jsxs)(ge.Z,{showUploadList:!1,onChange:he,maxCount:1,accept:"image/*",multiple:!1,style:{height:150},children:[(0,x.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,x.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u70B9\u51FB\u4E0A\u4F20"})]})]}),(0,x.jsx)(te.Z,{style:{width:"50%",maxWidth:"500px",marginLeft:"20px"},title:"\u5904\u7406\u540E",hoverable:!0,extra:(0,x.jsx)(re.ZP,{type:"primary",disabled:!c,onClick:function(){return(0,ue.YH)(c)},children:"\u4E0B\u8F7D"}),children:c?(0,x.jsx)("img",{src:c,width:"100%",ref:X,onClick:pe}):(0,x.jsxs)("div",{children:[(0,x.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,x.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u6682\u65E0\u56FE\u7247\u751F\u6210"})]})})]})})})}},82949:function(De,Q,e){e.r(Q),e.d(Q,{default:function(){return $}});var Y=e(19632),q=e.n(Y),xe=e(15009),j=e.n(xe),me=e(99289),W=e.n(me),ve=e(5574),N=e.n(ve),K=e(82061),ee=e(96638),te=e(78356),G=e(75081),Te=e(26713),re=e(18722),ge=e(66242),S=e(33573),Se=e(96074),fe=e(32983),V=e(67294),ue=e(44268),Z=e(67383),x=e(90142),A=e(18312),T=e(85893),X={imageUrl:"",samModel:null,loading:!1,clipImg:[],originImg:null,originMaskImg:[],isSelecting:!1,startPoint:{x:0,y:0},endPoint:{x:0,y:0},clipType:"click",eventPoint:[]},$=function(){var E=(0,ee.Z)(X),M=N()(E,2),g=M[0],b=M[1];(0,V.useEffect)(function(){var h=new ue.e7({modelUrl:A.XM,WasmPaths:A.XT});h.initModel().then(function(){b({samModel:h})})},[]);var Ae=function(){var h=W()(j()().mark(function c(y,u){var d,p,P,U;return j()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.prev=0,d=Z.y,p=new FormData,p.append("image_path",y),B.next=6,fetch(d,{body:p,method:"post"});case 6:return B.next=8,B.sent.arrayBuffer();case 8:P=B.sent,g.samModel.setEmbedding(P),U=new Image,U.src=u,U.onload=function(){g.samModel.setImage(u),b({originImg:U})},b({imageUrl:u,loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),B.next=21;break;case 17:B.prev=17,B.t0=B.catch(0),b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 21:case"end":return B.stop()}},c,null,[[0,17]])}));return function(y,u){return h.apply(this,arguments)}}(),Ce=function(){var h=W()(j()().mark(function c(y){var u,d,p,P;return j()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(u=y.file,L.prev=1,b({clipImg:[],loading:!0}),u.status!=="done"){L.next=10;break}return L.next=6,(0,ue.y3)(u.originFileObj);case 6:d=L.sent,p=d.indexOf(","),P=d==null?void 0:d.substring(p+1),Ae(P,d);case 10:L.next=16;break;case 12:L.prev=12,L.t0=L.catch(1),b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 16:case"end":return L.stop()}},c,null,[[1,12]])}));return function(y){return h.apply(this,arguments)}}();function ce(h){var c=h.size/1024/1024<1.1;if(!c){te.ZP.error("\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC71.1MB!"),b({loading:!1});return}}(0,V.useEffect)(function(){if(Z.y)try{var h=new Image;h.src="../../assets/demo1.jpg",h.onload=function(){b({loading:!0});var c=document.createElement("canvas");c.width=h.width,c.height=h.height;var y=c.getContext("2d");y.drawImage(h,0,0);var u=c.toDataURL("image/jpeg"),d=u.indexOf(","),p=u==null?void 0:u.substring(d+1);g.samModel&&Ae(p,h.src)}}catch(c){b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25")}},[g.samModel]);var Pe=function(c){if(g.clipType==="click"){var y=c.nativeEvent.target.getBoundingClientRect(),u=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,p=Math.round(c.pageX-y.left-d),P=Math.round(c.pageY-y.top-u),U=g.originImg?g.originImg.width/c.nativeEvent.target.offsetWidth:1;p*=U,P*=U,b({eventPoint:[p,P]})}},se=function(c){if(c.preventDefault(),g.clipType!=="click"){var y=c.nativeEvent.target.getBoundingClientRect(),u=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,p=Math.round(c.pageX-y.left-d),P=Math.round(c.pageY-y.top-u);b({isSelecting:!0,startPoint:{x:p,y:P}})}},O=function(c){if(c.preventDefault(),g.clipType!=="click"){var y=c.nativeEvent.target.getBoundingClientRect(),u=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,p=Math.round(c.pageX-y.left-d),P=Math.round(c.pageY-y.top-u);b({endPoint:{x:p,y:P}})}},D=function(c){if(g.clipType!=="click"){b({isSelecting:!1});var y=g.startPoint,u=g.endPoint,d={x:Math.min(y.x,u.x),y:Math.min(y.y,u.y),width:Math.abs(y.x-u.x),height:Math.abs(y.y-u.y)};b({endPoint:{x:0,y:0},startPoint:{x:0,y:0}});var p=g.originImg?g.originImg.width/c.nativeEvent.target.offsetWidth:1,P=g.originImg?g.originImg.height/c.nativeEvent.target.offsetHeight:1,U=[d.x*p,d.y*P],L=[d.x*p+d.width*p,d.y*P+d.height*P],B=[].concat(U,L);b({eventPoint:B})}},f=function(){g.clipType!=="click"&&b({endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},R=(0,V.useMemo)(function(){if(!g.isSelecting)return null;var h=g.startPoint,c=g.endPoint;return(0,T.jsx)("div",{style:{position:"absolute",left:h.x,top:h.y,width:c.x-h.x,height:c.y-h.y,backgroundColor:"rgba(255, 0, 255, 0.3)",border:"1px dashed red",pointerEvents:"none",zIndex:1}})},[g.isSelecting,g.startPoint,g.endPoint]);return(0,V.useEffect)(function(){if(g.samModel&&g.eventPoint.length!==0){var h=g.eventPoint,c;g.clipType==="click"&&(c=[{x:h[0],y:h[1],clickType:1}]),g.clipType==="selectend"&&(c=[{x:h[0],y:h[1],clickType:2},{x:h[2],y:h[3],clickType:3}]);var y=function(d){var p=g.samModel.exportImageClip(d),P=g.samModel.exportMaskImage(d),U=String(new Date().getTime());b(function(L){return{clipImg:[].concat(q()(L.clipImg),[{clipSrc:p.src,maskSrc:P.src,mark:U}])}})};setTimeout(function(){g.samModel.predict(c).then(y)})}},[g.eventPoint,g.samModel,g.clipType]),(0,T.jsxs)(G.Z,{spinning:g.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:[(0,T.jsxs)(Te.Z,{style:{marginBottom:16},children:[(0,T.jsx)(re.Z,{className:"samPic__upload",multiple:!1,maxCount:1,showUploadList:!1,onChange:Ce,accept:"image/*",beforeUpload:ce,children:(0,T.jsx)(ge.ZP,{type:"primary",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u4E0A\u4F20"})}),(0,T.jsx)(S.ZP.Group,{style:{margin:"10px 0"},onChange:function(c){b({clipType:c.target.value,endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},value:g.clipType,buttonStyle:"solid",children:A._$.map(function(h){return(0,T.jsx)(S.ZP.Button,{value:h.value,children:h.label},h.value)})}),(0,T.jsx)(ge.ZP,{block:!0,type:"primary",disabled:g.clipImg.length<=0,onClick:function(){return(0,x.O6)(g.clipImg,"clipImages")},style:{margin:"10px 0"},children:"\u4E0B\u8F7D\u6570\u636E"})]}),(0,T.jsxs)("div",{className:"samPic",children:[(0,T.jsx)("div",{className:"samPic__preview",children:g.imageUrl&&(0,T.jsxs)("div",{style:{position:"relative"},children:[g.clipImg.length?g.clipImg.map(function(h,c){return(0,T.jsx)("img",{className:"samPic__preview__maskImg",src:h.maskSrc},c)}):null,(0,T.jsx)("img",{className:"samPic__preview__img",onClick:Pe,onMouseDown:se,onMouseMove:O,onMouseUp:D,onMouseOut:f,src:g.imageUrl,style:{cursor:g.clipType==="click"?"pointer":"crosshair"}}),g.clipType!=="click"&&R]})}),(0,T.jsx)("div",{className:"samPic__tool",children:g.clipImg.length>0?(0,T.jsx)("div",{className:"clipImgContent",children:g.clipImg.map(function(h,c){var y=h.clipSrc,u=h.mark;return(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("img",{src:y,style:{width:50}}),(0,T.jsx)("div",{className:"tools",children:(0,T.jsx)(K.Z,{style:{opacity:.8},onClick:function(){b(function(p){return{clipImg:p.clipImg.filter(function(P){return P.mark!==u})}})}})}),(0,T.jsx)(Se.Z,{style:{margin:"8px 0"}})]},c)})}):(0,T.jsx)(fe.Z,{description:"\u6682\u65E0\u56FE\u7247"})})]})]})}},97314:function(De,Q,e){e.r(Q),e.d(Q,{default:function(){return Pe}});var Y=e(15009),q=e.n(Y),xe=e(19632),j=e.n(xe),me=e(99289),W=e.n(me),ve=e(5574),N=e.n(ve),K=e(7539),ee=e(78356),te=e(66242),G=e(33573),Te=e(75081),re=e(67294),ge=e(44268),S=e(54539),Se=e(96638),fe=e(67383),V=e(18312),ue=e(37653),Z=e(43929),x=e(99247),A=e(90142),T=e(78234),X=e(63428),$=e(2302),E=e(85893),M=function(O){var D=O.value;return X.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(R){return[{range:R.getFullModelRange(),text:(0,A.XG)({content:R.getValue()})}]}}),(0,T.Z)(function(){X.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,E.jsx)($.ZP,{width:400,height:"calc(70vh - 56px)",language:"json",value:(0,A.XG)({content:D}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},g=e(61781),b=e(69323),Ae=function(O){var D=O.samInfo,f=O.setSamState,R=function(u){f(function(d){return{satelliteData:d.satelliteData.filter(function(p){return p.imageUrl!==u.image})}}),ee.ZP.success("\u5220\u9664\u6210\u529F")},h=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(u){return(0,E.jsx)(g.Z,{placement:"topLeft",title:u,children:u})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(u){return(0,E.jsx)(g.Z,{color:"#fff",placement:"topLeft",title:(0,E.jsx)("img",{src:u,style:{width:200,height:200}}),children:(0,E.jsx)("img",{src:u,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(u,d){return(0,E.jsx)(te.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return R(d)},children:"\u5220\u9664"})}}],c=D.satelliteData.map(function(y,u){var d,p=(d=y.features[0])===null||d===void 0?void 0:d.geometry;return{key:u,geometry:JSON.stringify(p),image:y.imageUrl}});return(0,E.jsx)(b.Z,{size:"small",columns:h,dataSource:j()(c).reverse()})},Ce=function(O){var D=O.samInfo,f=O.setSamState,R=(0,re.useMemo)(function(){var c=D.satelliteData.map(function(y){return y.features});return{type:"FeatureCollection",features:c.flat()}},[D.satelliteData]),h=[{key:"text",label:"\u7F16\u8F91\u5668\u5C55\u793A",children:(0,E.jsx)(M,{value:JSON.stringify(R!=null?R:(0,A.rC)(),null,2)})},{key:"table",label:"\u8868\u683C\u5C55\u793A",children:(0,E.jsx)(Ae,{samInfo:D,setSamState:f})}];return(0,E.jsxs)("div",{className:"rightContainer",style:{width:D.collapsed?400:0},children:[(0,E.jsx)("div",{className:"rightContainer__collapsed",onClick:function(){return f(function(y){return{collapsed:!y.collapsed}})},children:D.collapsed?(0,E.jsx)(ue.Z,{className:"rightContainer__collapsed__icon"}):(0,E.jsx)(Z.Z,{className:"rightContainer__collapsed__icon"})}),D.collapsed&&(0,E.jsx)(x.Z,{style:{width:D.collapsed?400:0},items:h,tabBarExtraContent:(0,E.jsx)(te.ZP,{size:"small",type:"primary",disabled:D.satelliteData.length<=0,onClick:function(){return(0,A.O6)(D.satelliteData)},children:"\u4E0B\u8F7D\u6570\u636E"})})]})},ce={samModel:null,currentScene:null,currentSource:null,mapClick:null,loading:!1,borderLayer:null,eventType:"click",collapsed:!0,satelliteData:[]},Pe=function(){var se=17,O=(0,Se.Z)(ce),D=N()(O,2),f=D[0],R=D[1],h=function(d){var p,P,U=V.Kl.find(function(L){return L.name===d.target.value});U&&((p=f.currentScene)===null||p===void 0||p.setCenter(U.coord)),(P=f.currentScene)===null||P===void 0||P.setZoom(U.zoom||17)},c=function(d){console.log(d);var p=Array.isArray(d),P=p?d:[d.lngLat.lng,d.lngLat.lat];R({mapClick:P})},y=function(){var u=W()(q()().mark(function d(){var p,P,U,L,B,ae,oe,he,pe,de,w,F,l,a,t,n,r,s,i;return q()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return R({loading:!0}),L=(p=f.currentSource)===null||p===void 0||(P=p.tileset)===null||P===void 0?void 0:P.currentTiles,B=1/0,ae=1/0,oe=-1/0,he=-1/0,L==null||L.forEach(function(v){B=Math.min(B,v.x),ae=Math.min(ae,v.y),oe=Math.max(oe,v.x),he=Math.max(he,v.y)}),pe=Math.ceil((U=f.currentScene)===null||U===void 0?void 0:U.getZoom()),de=document.createElement("canvas"),de.width=(oe-B+1)*256,de.height=(he-ae+1)*256,w=de.getContext("2d"),F=f.samModel.mapHelper,l=[].concat(j()(F.tileToLngLat(B,he+1,pe)),j()(F.tileToLngLat(oe+1,ae,pe))),L==null||L.forEach(function(v){v&&(w==null||w.drawImage(v.data,(v.x-B)*256,(v.y-ae)*256,256,256))}),f.samModel.setGeoImage(de.toDataURL(),{extent:l,width:de.width,height:de.height}),a=de.toDataURL("image/jpeg"),t=a.indexOf(","),n=a==null?void 0:a.substring(t+1),r=fe.y,s=new FormData,s.append("image_path",n),m.next=24,fetch(r,{body:s,method:"post"});case 24:return m.next=26,m.sent.arrayBuffer();case 26:i=m.sent,f.samModel.setEmbedding(i),R({loading:!1}),ee.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210");case 30:case"end":return m.stop()}},d)}));return function(){return u.apply(this,arguments)}}();return(0,re.useEffect)(function(){if(!(!f.mapClick||!f.samModel)){var u=[];try{var d=f.mapClick;if(f.eventType==="click"){var p=f.samModel.lngLat2ImagePixel(d);u.push({x:p[0],y:p[1],clickType:1})}else if(f.eventType==="selectend"){var P=f.samModel.lngLat2ImagePixel([d[0],d[3]]),U=f.samModel.lngLat2ImagePixel([d[2],d[1]]);u.push({x:P[0],y:P[1],clickType:2}),u.push({x:U[0],y:U[1],clickType:3})}else f.eventType==="all"&&console.log(f.samModel.image.width,f.samModel.image.height);if(u.length===0)return;console.time("predict"),f.samModel.predict(u).then(function(){var L=W()(q()().mark(function B(ae){var oe,he,pe;return q()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return console.timeEnd("predict"),w.next=3,f.samModel.exportGeoPolygon(ae,1);case 3:oe=w.sent,he=f.samModel.exportImageClip(ae),pe={features:oe.features,imageUrl:he.src},R(function(F){var l=F.satelliteData.find(function(a){return a.imageUrl===pe.imageUrl});return l?{satelliteData:j()(F.satelliteData)}:{satelliteData:[].concat(j()(F.satelliteData),[pe])}});case 7:case"end":return w.stop()}},B)}));return function(B){return L.apply(this,arguments)}}())}catch(L){ee.ZP.error("\u8BF7\u5148\u70B9\u51FB[\u751F\u6210 embedding] \u6309\u94AE")}}},[f.mapClick]),(0,re.useEffect)(function(){if(f.borderLayer){var u=f.satelliteData.map(function(p){return p.features}),d={type:"FeatureCollection",features:u.flat()};f.borderLayer.setData(d)}},[f.borderLayer,f.satelliteData]),(0,re.useEffect)(function(){var u=new K.xsS({id:"map",map:new S.Z({center:[120.10533489408249,30.261061158180482],zoom:se,minZoom:3,style:"blank"})}),d=new K.Hw6(V.Hj,{parser:{type:"rasterTile",tileSize:256}}),p=new K.YYg({zIndex:-2}).source(d),P=new K.dWg({zIndex:10}).source({type:"FeatureCollection",features:[]}).shape("line").size(2).color("#f00").style({opacity:1});u.on("loaded",function(){u.addLayer(p),u.addLayer(P),R({borderLayer:P,currentScene:u,currentSource:d}),u.on("click",c),u.on("selectend",c)})},[]),(0,re.useEffect)(function(){f.eventType==="selectend"&&f.currentScene?f.currentScene.enableBoxSelect(!1):f.currentScene&&f.currentScene.disableBoxSelect()},[f.eventType]),(0,re.useEffect)(function(){var u=new ge.XU({modelUrl:V.XM,wasmPaths:V.XT});u.initModel().then(function(){R({samModel:u})})},[]),(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(te.ZP,{onClick:y,children:" \u751F\u6210 embedding "}),(0,E.jsx)(G.ZP.Group,{style:{margin:"15px"},onChange:h,defaultValue:"A \u7A7A\u95F4",buttonStyle:"solid",children:V.Kl.map(function(u){return(0,E.jsx)(G.ZP.Button,{value:u.name,children:u.name},u.name)})}),(0,E.jsx)(Te.Z,{spinning:f.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,E.jsxs)("div",{className:"mapContainer",children:[(0,E.jsx)("div",{id:"map",className:"mapContainer__map",style:{width:"calc(100vw - ".concat(f.collapsed?400:0,"px)")},children:(0,E.jsx)(G.ZP.Group,{style:{position:"absolute",top:15,left:15,zIndex:100},onChange:function(d){R({eventType:d.target.value})},value:f.eventType,size:"small",buttonStyle:"solid",children:V.bw.map(function(u){return(0,E.jsx)(G.ZP.Button,{value:u.value,children:u.label},u.value)})})}),(0,E.jsx)(Ce,{samInfo:f,setSamState:R})]})})]})}},44268:function(De,Q,e){e.d(Q,{e7:function(){return f},XU:function(){return F},y3:function(){return E},Ul:function(){return Z}});var Y=e(18736),q=function(a){var t=a.clicks,n=a.tensor,r=a.modelScale,s=n,i,o,m,v;if(t){var I=t.length;i=new Float32Array(2*(I+1)),o=new Float32Array(I+1);for(var C=0;C<I;C++)i[2*C]=t[C].x*r.samScale,i[2*C+1]=t[C].y*r.samScale,o[C]=t[C].clickType;i[2*I]=0,i[2*I+1]=0,o[I]=-1,m=new Y.Tensor("float32",i,[1,I+1,2]),v=new Y.Tensor("float32",o,[1,I+1])}var H=new Y.Tensor("float32",[r.height,r.width]);if(!(m===void 0||v===void 0)){var _=new Y.Tensor("float32",new Float32Array(256*256),[1,1,256,256]),le=new Y.Tensor("float32",[0]);return{image_embeddings:s,point_coords:m,point_labels:v,orig_im_size:H,mask_input:_,has_mask_input:le}}},xe=e(15009),j=e.n(xe),me=e(99289),W=e.n(me),ve=e(12444),N=e.n(ve),K=e(72004),ee=e.n(K),te=e(9783),G=e.n(te),Te=e(781),re="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",ge=e(5574),S=e.n(ge),Se=e(69826),fe=e(16479),V=e.n(fe);function ue(l){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=l.width,a.height=l.height,t==null||t.putImageData(l,0,0),a}function Z(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"image/png",t=document.createElement("canvas"),n=t.getContext("2d");return t.width=l.width,t.height=l.height,n.drawImage(l,0,0,l.width,l.height),t.toDataURL(a)}function x(l){var a=ue(l),t=new Image;return t.src=a.toDataURL(),t}function A(l,a,t,n){for(var r=new Uint8ClampedArray(l.data),s=new Uint8ClampedArray(4*t*n),i=0;i<a.length;i++)if(a[i]>0){var o=4*i;s[o+0]=r[o+0],s[o+1]=r[o+1],s[o+2]=Math.max(r[o+2],200),s[o+3]=r[o+3]}return x(new ImageData(s,t,n))}function T(l,a,t){for(var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:15,r=a,s=0,i=t,o=0,m=0;m<l.length;m++)if(l[m]>0){var v=m%a,I=Math.floor(m/a);r=Math.min(r,v),s=Math.max(s,v),i=Math.min(i,I),o=Math.max(o,I)}return[r-n,s+n,i-n,o+n]}function X(l,a,t,n,r,s){for(var i=[],o=0,m=a;m<n;m++)for(var v=l;v<t;v++){var I=m*s+v;i[o++]=r[I]>0?1:-1}return i}function $(l,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=l.map(function(i){return{x:i[0]+a,y:i[1]+t}});if(n===0)return r;var s=V()(r,n,!0);return s}var E=function(a){return new Promise(function(t,n){var r=new FileReader;r.readAsDataURL(a),r.onload=function(){return t(r.result)},r.onerror=function(s){return n(s)}})};function M(l,a,t){var n=T(l,a,t),r=S()(n,4),s=r[0],i=r[1],o=r[2],m=r[3],v=X(s,o,i,m,l,a),I=A(v,i-s,m-o);return x(I)}function g(l,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=T(l,a,t),s=S()(r,4),i=s[0],o=s[1],m=s[2],v=s[3],I=X(i,m,o,v,l,a),C=o-i,H=v-m,_=Se.Z().size([C,H]).smooth(!1).thresholds(2),le=_(I);return $(le[1].coordinates[0][0],i,m,n)}function b(l,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=0;n<a.length;n++)(t?a[n]<=0:a[n]>0)&&(l.data[4*n+0]=0,l.data[4*n+1]=0,l.data[4*n+2]=0,l.data[4*n+3]=0);return x(l)}function Ae(l,a,t,n){for(var r=T(a,t,n),s=S()(r,4),i=s[0],o=s[1],m=s[2],v=s[3],I=new Uint8ClampedArray(4*(o-i)*(v-m)).fill(0),C=0,H=m;H<v;H++)for(var _=i;_<o;_++){var le=H*t+_;a[le]>0&&(I[C*4]=l.data[le*4],I[C*4+1]=l.data[le*4+1],I[C*4+2]=l.data[le*4+2],I[C*4+3]=l.data[le*4+3]),C++}var Le=new ImageData(I,o-i,v-m);return x(Le)}function Ce(l){var a=document.createElement("a");a.href=l.src,a.download="image",a.click()}function ce(l){var a=document.createElement("a");a.href=l.toDataURL("image/png"),a.download="image",a.click()}function Pe(l){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=l.width,a.height=l.height,t==null||t.drawImage(l,0,0),t==null?void 0:t.getImageData(0,0,l.width,l.height)}var se=function(a){var t=1024,n=a.naturalWidth,r=a.naturalHeight,s=t/Math.max(r,n);return{height:r,width:n,samScale:s}},O=function(a,t){var n=1024,r=n/Math.max(t,a);return{height:t,width:a,samScale:r}},D=e(18736),f=function(){function l(a){N()(this,l),G()(this,"modelUrl",re),G()(this,"model",void 0),G()(this,"image",void 0),G()(this,"imageData",void 0),G()(this,"modelScale",void 0),G()(this,"tensor",void 0),a!=null&&a.modelUrl&&(this.modelUrl=a.modelUrl),a!=null&&a.wasmPaths&&this.setWasmUrl(a.wasmPaths)}return ee()(l,[{key:"initModel",value:function(){var a=W()(j()().mark(function n(){var r;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Y.InferenceSession.create(this.modelUrl);case 3:r=i.sent,this.model=r,i.next=10;break;case 7:throw i.prev=7,i.t0=i.catch(0),new Error("\u6A21\u578B\u52A0\u8F7D\u5931\u8D25");case 10:case"end":return i.stop()}},n,this,[[0,7]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"setImage",value:function(){var a=W()(j()().mark(function n(r){var s=this;return j()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:typeof r=="string"?(this.image=new Image,this.image.src=r,this.image.onload=function(){s.getImageScale(s.image),s.imageData=Pe(s.image)}):(this.image=r,this.getImageScale(this.image),this.imageData=Pe(this.image));case 1:case"end":return o.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"setEmbedding",value:function(){var a=W()(j()().mark(function n(r){var s,i,o,m,v=arguments;return j()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(s=v.length>1&&v[1]!==void 0?v[1]:"float32",i=new Te.Z,typeof r!="string"){C.next=6;break}C.t0=i.load(r),C.next=9;break;case 6:return C.next=8,i.parse(r);case 8:C.t0=C.sent;case 9:o=C.t0,m=new D.Tensor(s,o.data,o.shape),this.tensor=m;case 12:case"end":return C.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predict",value:function(){var a=W()(j()().mark(function n(r){var s,i,o;return j()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,!(this.model===null||r===null||this.tensor===null||this.modelScale===null)){v.next=6;break}return console.log("model not loaded"),v.abrupt("return");case 6:if(s=q({clicks:r,tensor:this.tensor,modelScale:this.modelScale}),s!==void 0){v.next=9;break}return v.abrupt("return");case 9:return v.next=11,this.model.run(s);case 11:return i=v.sent,o=i[this.model.outputNames[0]],v.abrupt("return",o);case 14:v.next=20;break;case 16:return v.prev=16,v.t0=v.catch(0),console.log(v.t0),v.abrupt("return");case 20:case"end":return v.stop()}},n,this,[[0,16]])}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predictByBox",value:function(){var a=W()(j()().mark(function n(r){return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",r);case 1:case"end":return i.stop()}},n)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"exportMaskImage",value:function(t){if(this.imageData!==void 0)return A(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportMaskClip",value:function(t){return M(t.data,t.dims[3],t.dims[2])}},{key:"exportImage",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.imageData!==void 0)return b(this.imageData,t.data,n)}},{key:"exportImageClip",value:function(t){if(this.imageData!==void 0)return Ae(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportVector",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return g(t.data,t.dims[3],t.dims[2],n)}},{key:"setWasmUrl",value:function(t){Y.env.wasm.wasmPaths=t}},{key:"getImageScale",value:function(t){var n=t.width,r=t.height;this.modelScale=O(n,r)}}]),l}(),R=e(19632),h=e.n(R),c=e(25098),y=e.n(c),u=e(28785),d=e.n(u),p=e(48374),P=e.n(p),U=e(31996),L=e.n(U),B=e(26037),ae=e.n(B),oe=function(){function l(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:256,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"tms";N()(this,l),G()(this,"tileSize",void 0),G()(this,"type",void 0),G()(this,"initialResolution",void 0),G()(this,"originShift",void 0),this.tileSize=a,this.type=t,this.initialResolution=2*Math.PI*6378137/this.tileSize,this.originShift=2*Math.PI*6378137/2}return ee()(l,[{key:"lngLatToMeters",value:function(t,n){var r=t*this.originShift/180,s=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return s=s*this.originShift/180,[r,s]}},{key:"metersToLngLat",value:function(t,n){var r=t/this.originShift*180,s=n/this.originShift*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),[r,s]}},{key:"pixelsToMeters",value:function(t,n,r){var s=this.resolution(r),i=t*s-this.originShift,o=(this.type==="tms"?n:Math.pow(2,r)*256-n)*s-this.originShift;return[i,o]}},{key:"metersToPixels",value:function(t,n,r){var s=this.resolution(r),i=(t+this.originShift)/s,o=(n+this.originShift)/s;return o=this.type==="tms"?o:Math.pow(2,r)*256-o,[i,o]}},{key:"metersToTile",value:function(t,n,r){var s=this.metersToPixels(t,n,r),i=S()(s,2),o=i[0],m=i[1];return this.pixelsToTile(o,m)}},{key:"tileToMeters",value:function(t,n,r){return this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r)}},{key:"tileToLngLat",value:function(t,n,r){var s=this.tileToMeters(t,n,r),i=S()(s,2),o=i[0],m=i[1];return this.metersToLngLat(o,m)}},{key:"pixelsToTile",value:function(t,n){var r=Math.floor(Math.ceil(t/this.tileSize)-1),s=Math.floor(Math.ceil(n/this.tileSize)-1);return[r,s]}},{key:"pixelsToRaster",value:function(t,n,r){var s=this.tileSize<<r;return[t,s-n]}},{key:"tileBounds",value:function(t,n,r){var s=this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r),i=S()(s,2),o=i[0],m=i[1],v=this.pixelsToMeters((t+1)*this.tileSize,(n+1)*this.tileSize,r),I=S()(v,2),C=I[0],H=I[1];return[o,m,C,H]}},{key:"tileLatLonBounds",value:function(t,n,r){var s=this.tileBounds(t,n,r),i=this.metersToLngLat(s[0],s[1]),o=S()(i,2),m=o[0],v=o[1],I=this.metersToLngLat(s[2],s[3]),C=S()(I,2),H=C[0],_=C[1];return[m,v,H,_]}},{key:"resolution",value:function(t){return this.initialResolution/Math.pow(2,t)}},{key:"lngLatToPixels",value:function(t,n,r){var s=this.lngLatToMeters(t,n),i=S()(s,2),o=i[0],m=i[1];return this.metersToPixels(o,m,r)}},{key:"pixelsTolngLat",value:function(t,n,r){var s=this.pixelsToMeters(t,n,r);return this.metersToLngLat(s[0],s[1])}},{key:"lngLatToTile",value:function(t,n,r){var s=this.lngLatToPixels(t,n,r),i=S()(s,2),o=i[0],m=i[1];return this.pixelsToTile(o,m)}},{key:"googleTile",value:function(t,n,r){return[t,Math.pow(2,r)-1-n]}},{key:"boundsToTileExtent",value:function(t,n,r,s,i){var o=this.lngLatToTile(t,s,i),m=S()(o,2),v=m[0],I=m[1],C=this.lngLatToTile(r,n,i),H=S()(C,2),_=H[0],le=H[1];return[[v,I],[_,le]]}},{key:"metersboundsToTileExtent",value:function(t,n,r,s,i){var o=this.metersToTile(t,s,i),m=S()(o,2),v=m[0],I=m[1],C=this.metersToTile(r,n,i),H=S()(C,2),_=H[0],le=H[1];return[[v,I],[_,le]]}}]),l}(),he=null,pe=function(a){var t=_slicedToArray(a,4),n=t[0],r=t[1],s=t[2],i=t[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[n,r],[n,i],[s,i],[s,r],[n,r]]]}}]}},de=function(a){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[a]}}]}},w=function(){return{type:"FeatureCollection",features:[]}},F=function(l){L()(t,l);var a=ae()(t);function t(){var n;N()(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return n=a.call.apply(a,[this].concat(s)),G()(y()(n),"imageOption",void 0),G()(y()(n),"imageBounds",void 0),G()(y()(n),"metersPerpixelsX",0),G()(y()(n),"metersPerpixelsY",0),G()(y()(n),"mapHelper",new oe(256,"google")),n}return ee()(t,[{key:"setGeoImage",value:function(){var n=W()(j()().mark(function s(i,o){var m,v,I;return j()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:d()(P()(t.prototype),"setImage",this).call(this,i),this.imageOption=o,m=o.extent,v=o.width,I=o.height,m&&(this.imageBounds=[].concat(h()(this.mapHelper.lngLatToMeters(m[0],m[1])),h()(this.mapHelper.lngLatToMeters(m[2],m[3]))),this.metersPerpixelsX=(this.imageBounds[2]-this.imageBounds[0])/v,this.metersPerpixelsY=(this.imageBounds[3]-this.imageBounds[1])/I);case 4:case"end":return H.stop()}},s,this)}));function r(s,i){return n.apply(this,arguments)}return r}()},{key:"exportGeoPolygon",value:function(){var n=W()(j()().mark(function s(i){var o=this,m,v,I,C,H,_=arguments;return j()().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:return m=_.length>1&&_[1]!==void 0?_[1]:5,Le.next=3,this.exportVector(i,m);case 3:return v=Le.sent,I=this.imageBounds,C=v.map(function(Fe){var Ze=[Fe.x*o.metersPerpixelsX+I[0],(o.imageOption.height-Fe.y)*o.metersPerpixelsY+I[1]],Be=o.mapHelper.metersToLngLat(Ze[0],Ze[1]);return Be}),H=de(C),Le.abrupt("return",H);case 8:case"end":return Le.stop()}},s,this)}));function r(s){return n.apply(this,arguments)}return r}()},{key:"lngLat2ImagePixel",value:function(r){if(this.imageBounds){var s=this.mapHelper.lngLatToMeters(r[0],r[1]),i=S()(s,2),o=i[0],m=i[1],v=(o-this.imageBounds[0])/this.metersPerpixelsX,I=(m-this.imageBounds[1])/this.metersPerpixelsY;return I=this.imageOption.height-I,[v,I]}}}]),t}(f)}}]);
