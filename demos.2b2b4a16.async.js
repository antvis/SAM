"use strict";(self.webpackChunk_antv_sam=self.webpackChunk_antv_sam||[]).push([[433],{18312:function(Ce,Y,e){e.d(Y,{Hj:function(){return V},Kl:function(){return K},XM:function(){return j},XT:function(){return fe},_$:function(){return k},bw:function(){return he}});var H="https://www.google.com/maps/vt?lyrs=s@820&gl=cn&x={x}&y={y}&z={z}",V=H,ue="https://t{0-7}.tianditu.gov.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk=b72aa81ac2b3cae941d1eb213499e15e",j="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",fe="https://npm.elemecdn.com/onnxruntime-web/dist/",K=[{name:"A \u7A7A\u95F4",coord:[120.10533489408249,30.261061158180482],zoom:18},{name:"\u6CB9\u7F50",coord:[-96.74674229210954,35.935326263559816],zoom:15.5},{name:"\u519C\u7530",coord:[5.000138834496795,52.83911856295691],zoom:13.5},{name:"\u519C\u75302",coord:[-111.91603037093357,32.91837220530866],zoom:13},{name:"\u704C\u6E89\u519C\u7530",coord:[38.274419546979345,30.107721922396593],zoom:12.5},{name:"\u5EFA\u7B51",coord:[-75.68709358840009,45.40821167856009],zoom:18},{name:"\u5EFA\u7B512",coord:[-117.9375255130447,33.809435077864805],zoom:18.2},{name:"\u673A\u573A",coord:[-117.377,34.596],zoom:15.5},{name:"\u8349\u573A",coord:[28.725760156128445,22.24767189005027],zoom:12}],he=[{label:"\u70B9\u9009",value:"click"}],k=[{label:"\u70B9\u9009",value:"click"},{label:"\u6846\u9009",value:"selectend"}]},67383:function(Ce,Y,e){e.d(Y,{y:function(){return H}});var H="https://sam.lvisei.icu/api"},90142:function(Ce,Y,e){e.d(Y,{$F:function(){return pe},O6:function(){return A},SO:function(){return ve},XG:function(){return me},YH:function(){return q},rC:function(){return re},vd:function(){return de}});var H=e(5574),V=e.n(H),ue=e(15009),j=e.n(ue),fe=e(99289),K=e.n(fe),he=e(73945),k=e.n(he),J=e(28182),ee=e.n(J),te=null,G=function(T){var I=_slicedToArray(T,4),p=I[0],X=I[1],$=I[2],C=I[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[p,X],[p,C],[$,C],[$,X],[p,X]]]}}]}},Ae=function(T){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[T]}}]}},re=function(){return{type:"FeatureCollection",features:[]}};function me(Z){var T=Z.content,I=T;typeof T!="string"&&(I=JSON.stringify(T,null,2));var p=k().format(I,{parser:"json",plugins:[ee()]});return p}var A=function(T){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"data-".concat(new Date().toLocaleString()),p=new Blob([me({content:JSON.stringify(T)})],{type:"application/json"}),X=document.createElement("a");X.download="".concat(I,".json"),X.href=URL.createObjectURL(p),X.click()};function pe(Z){var T=parseInt(Z.slice(1,3),16),I=parseInt(Z.slice(3,5),16),p=parseInt(Z.slice(5,7),16);return[T,I,p,255]}function ve(Z,T){for(var I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[255,0,0,255],p=V()(I,4),X=p[0],$=p[1],C=p[2],P=p[3],g=0;g<T.length;g++)T[g]<=0&&(Z.data[4*g+0]=X,Z.data[4*g+1]=$,Z.data[4*g+2]=C,Z.data[4*g+3]=P);var b=document.createElement("canvas");b.width=Z.width,b.height=Z.height;var Se=b.getContext("2d");return Se.putImageData(Z,0,0),b.toDataURL("image/png")}var q=function(T){var I=document.createElement("a"),p=new Image;p.src=T,I.download="img.png",I.target="_blank",I.href=p.src,I.click()},de=function(T,I){var p=T.nativeEvent.target.getBoundingClientRect(),X=window.pageYOffset||document.documentElement.scrollTop,$=window.pageXOffset||document.documentElement.scrollLeft,C=Math.round(T.pageX-p.left-$),P=Math.round(T.pageY-p.top-X),g=I?I.width/T.nativeEvent.target.offsetWidth:1,b=I?I.height/T.nativeEvent.target.offsetHeight:1;return C*=g,P*=b,{x:C,y:P}}},80948:function(Ce,Y,e){e.r(Y);var H=e(67294),V=e(44268),ue=e(85893);Y.default=function(){return(0,H.useEffect)(function(){var j=new V.XU({modelUrl:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*UtUITbWUN6AAAAAAAAAAAAAADmJ7AQ/fe_process.glb"});j.initModel().then(function(){alert("\u6A21\u578B\u521D\u59CB\u5316\u5B8C\u6210")})},[]),(0,ue.jsx)(ue.Fragment,{children:"\u521D\u59CB\u5316"})}},97827:function(Ce,Y,e){e.r(Y),e.d(Y,{default:function(){return Pe}});var H=e(19632),V=e.n(H),ue=e(15009),j=e.n(ue),fe=e(99289),K=e.n(fe),he=e(5574),k=e.n(he),J=e(4288),ee=e(78356),te=e(33573),G=e(18722),Ae=e(66242),re=e(84385),me=e(75081),A=e(67294),pe=e(88484),ve=e(44268),q=e(98126),de=e(67383),Z=e(90142),T=e(18312),I=[{name:"A \u7A7A\u95F4",extent:[120.09979248046875,30.256694798480346,120.11352539062499,30.26381184075493],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*rOXuSb_Tv6MAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u6CB9\u7F50",extent:[-96.7620849609375,35.92464453144096,-96.734619140625,35.94243575255426],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4c-2T41ESekAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u519C\u7530",extent:[4.943847656250016,52.81604319154931,5.053710937499996,52.86912972768522],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*bKPgT4XGbFIAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u5706\u5F62\u519C\u7530",extent:[28.60839843749999,22.146707780012644,28.828125000000014,22.350075806124867],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4KUZSanj_NsAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u673A\u573A",extent:[-117.388916015625,34.58799745550485,-117.366943359375,34.6060845921693],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Y7OHSYNL1VkAAAAAAAAAAAAADmJ7AQ/original"}],p=e(3679),X=e(78234),$=e(63428),C=e(2302),P=e(85893),g=function(R){var D=R.value,f=R.width,U=R.height;return $.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(c){return[{range:c.getFullModelRange(),text:(0,Z.XG)({content:c.getValue()})}]}}),(0,X.Z)(function(){$.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,P.jsx)(C.ZP,{width:f-20,height:U-60,language:"json",value:(0,Z.XG)({content:D}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},b=e(61781),Se=e(69323),Le=function(R){var D=R.satelliteData,f=R.setSatelliteData,U=function(o){f(function(d){return V()(d.filter(function(y){return y.imageUrl!==o.image}))}),ee.ZP.success("\u5220\u9664\u6210\u529F")},h=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(o){return(0,P.jsx)(b.Z,{placement:"topLeft",title:o,children:o})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(o){return(0,P.jsx)(b.Z,{color:"#fff",placement:"topLeft",title:(0,P.jsx)("img",{src:o,style:{width:200,height:200}}),children:(0,P.jsx)("img",{src:o,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(o,d){return(0,P.jsx)(Ae.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return U(d)},children:"\u5220\u9664"})}}],c=D.map(function(x,o){var d,y=(d=x.features[0])===null||d===void 0?void 0:d.geometry;return{key:o,geometry:JSON.stringify(y),image:x.imageUrl}});return(0,P.jsx)(Se.Z,{size:"small",columns:h,dataSource:V()(c).reverse(),scroll:{y:400},pagination:!1})},ge=function(R){var D=(0,A.useRef)(),f=(0,q.Z)(D),U=R.satelliteData,h=R.setSatelliteData,c=R.height,x=(0,A.useState)("text"),o=k()(x,2),d=o[0],y=o[1],S=(0,A.useMemo)(function(){var B=U.map(function(ae){return ae.features});return{type:"FeatureCollection",features:B.flat()}},[U]),O=[{key:"text",tab:"\u7F16\u8F91\u5668\u5C55\u793A"},{key:"table",tab:"\u8868\u683C\u5C55\u793A"}],E={text:(0,P.jsx)(g,{width:f==null?void 0:f.width,height:c,value:JSON.stringify(S!=null?S:(0,Z.rC)(),null,2)}),table:(0,P.jsx)(Le,{satelliteData:U,setSatelliteData:h})};return(0,P.jsx)(p.Z,{ref:D,hoverable:!0,style:{width:"32%"},tabList:O,activeTabKey:d,onTabChange:y,children:E[d]})},Pe=function(){var se,R,D=(0,A.useRef)(),f=(0,q.Z)(D),U=J.Z.useForm(),h=k()(U,1),c=h[0],x=(0,A.useState)(!1),o=k()(x,2),d=o[0],y=o[1],S=(0,A.useState)(null),O=k()(S,2),E=O[0],B=O[1],ae=(0,A.useState)(null),le=k()(ae,2),ye=le[0],xe=le[1],ce=(0,A.useState)(I[0].url),w=k()(ce,2),F=w[0],u=w[1],a=(0,A.useState)(I[0].extent),t=k()(a,2),n=t[0],r=t[1],s=(0,A.useState)([]),i=k()(s,2),l=i[0],m=i[1],v=(0,A.useState)(I[0].name),M=k()(v,2),L=M[0],W=M[1],_=function(){var z=K()(j()().mark(function N(Q){var Te,Ie,je;return j()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return y(!0),ne.prev=1,Te=de.y,Ie=new FormData,Ie.append("image_path",Q),ne.next=7,fetch(Te,{body:Ie,method:"post"});case 7:return ne.next=9,ne.sent.arrayBuffer();case 9:je=ne.sent,E.setEmbedding(je),y(!1),ee.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),ne.next=19;break;case 15:ne.prev=15,ne.t0=ne.catch(1),y(!1),ee.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 19:case"end":return ne.stop()}},N,null,[[1,15]])}));return function(Q){return z.apply(this,arguments)}}();(0,A.useEffect)(function(){var z=new ve.XU({modelUrl:T.XM});z.initModel().then(function(){B(z)})},[]),(0,A.useEffect)(function(){if(E&&F&&n){var z=new Image;z.crossOrigin="anonymous",z.onload=function(){var N=(0,ve.Ul)(z,"image/jpeg"),Q=N.indexOf(","),Te=N==null?void 0:N.substring(Q+1);_(Te),E.setGeoImage(z,{width:z.width,height:z.height,extent:n}),xe(z)},z.src=F}},[E,F]);var oe=function(N){var Q=(0,Z.vd)(N,ye),Te=Q.x,Ie=Q.y,je=[{x:Te,y:Ie,clickType:1}];E.predict(je).then(function(){var be=K()(j()().mark(function ne(Me){var Ue,ie,De,Oe;return j()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return Ue=E.exportImageClip(Me),ie=E.exportMaskImage(Me),we.next=4,E.exportGeoPolygon(Me,1);case 4:De=we.sent,Oe={features:De.features,imageUrl:Ue.src,maskImg:ie.src,key:String(new Date().getTime())},m(function(Re){var ze=Re.find(function($e){return $e.imageUrl===Oe.imageUrl});return ze?V()(Re):[].concat(V()(Re),[Oe])});case 7:case"end":return we.stop()}},ne)}));return function(ne){return be.apply(this,arguments)}}())},Ee=function(N){return Array.isArray(N)?N:N==null?void 0:N.fileList},Fe=function(){var z=K()(j()().mark(function N(Q){var Te,Ie,je,be,ne,Me;return j()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(ie.prev=0,!(Q!=null&&Q.upload)){ie.next=13;break}if(Te=Q.upload,Ie=Q.coordinate,je=Te[0],je.status!=="done"){ie.next=9;break}return ie.next=7,(0,ve.y3)(je.originFileObj);case 7:be=ie.sent,u(be);case 9:ne=Ie.split(";").map(function(De){return De.split(",")}).flat(),r(ne),ie.next=16;break;case 13:Me=I.find(function(De){return De.name===Q.choose}),u(Me==null?void 0:Me.url),r(Me==null?void 0:Me.extent);case 16:ie.next=21;break;case 18:ie.prev=18,ie.t0=ie.catch(0),ee.ZP.error("\u9519\u8BEF:".concat(ie.t0));case 21:case"end":return ie.stop()}},N,null,[[0,18]])}));return function(Q){return z.apply(this,arguments)}}();(0,A.useEffect)(function(){if(c){var z,N,Q=(z=I.find(function(Ie){return Ie.name===L}))===null||z===void 0?void 0:z.name,Te=JSON.stringify((N=I.find(function(Ie){return Ie.name===L}))===null||N===void 0?void 0:N.extent);c.setFieldsValue({choose:Q,coordinate:Te})}},[c,L]);var Be=function(N){N[0].name[0]==="choose"&&W(N[0].value),N[0].name[0]==="upload"&&c.setFieldsValue({coordinate:""})},Ze=function(N,Q){if(!Q)return Promise.reject("\u8BF7\u8F93\u5165");var Te=Q.split(";");return Te.length===0?Promise.reject("\u8BF7\u6B63\u786E\u8F93\u5165"):Promise.resolve(Q)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(J.Z,{form:c,onFinish:Fe,labelCol:{span:3},labelAlign:"left",className:"formLayout",onFieldsChange:Be,children:[(0,P.jsx)(J.Z.Item,{name:"choose",label:"\u793A\u4F8B",children:(0,P.jsx)(te.ZP.Group,{buttonStyle:"solid",onChange:function(){c.setFieldsValue({upload:void 0})},children:I.map(function(z){return(0,P.jsx)(te.ZP.Button,{value:z.name,children:z.name},z.name)})})}),(0,P.jsx)(J.Z.Item,{label:"\u4E0A\u4F20\u56FE\u7247: (\u652F\u6301 3857 \u5750\u6807\u7CFB)",name:"upload",valuePropName:"fileList",getValueFromEvent:Ee,children:(0,P.jsx)(G.Z,{multiple:!1,maxCount:1,accept:"image/*",children:(0,P.jsx)(Ae.ZP,{type:"primary",icon:(0,P.jsx)(pe.Z,{}),children:"\u70B9\u51FB\u4E0A\u4F20"})})}),(0,P.jsx)(J.Z.Item,{name:"coordinate",label:"\u8F93\u5165\u5730\u7406\u5750\u6807",rules:[{required:!0,validator:Ze}],children:(0,P.jsx)(re.Z,{placeholder:"[120.09979248046875,30.256694798480346;120.11352539062499,30.26381184075493]",style:{width:300}})}),(0,P.jsx)(J.Z.Item,{children:(0,P.jsx)(Ae.ZP,{type:"primary",htmlType:"submit",children:"\u63D0\u4EA4"})})]}),(0,P.jsx)(me.Z,{spinning:d,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,P.jsxs)("div",{className:"normalMapContainer",style:{height:(se=f==null?void 0:f.height)!==null&&se!==void 0?se:500},children:[(0,P.jsxs)("div",{style:{width:"68%",position:"relative"},children:[(0,P.jsx)("img",{ref:D,src:F,onClick:oe,width:"100%",style:{position:"absolute",cursor:"pointer"}}),l.length?l.map(function(z,N){return(0,P.jsx)("img",{className:"normalMaskImg",src:z.maskImg},N)}):null]}),(0,P.jsx)(ge,{height:(R=f==null?void 0:f.height)!==null&&R!==void 0?R:400,satelliteData:l,setSatelliteData:m})]})})]})}},26843:function(Ce,Y,e){e.r(Y),e.d(Y,{default:function(){return I}});var H=e(19632),V=e.n(H),ue=e(15009),j=e.n(ue),fe=e(99289),K=e.n(fe),he=e(5574),k=e.n(he),J=e(78356),ee=e(75081),te=e(3679),G=e(26713),Ae=e(74809),re=e(66242),me=e(18722),A=e(67294),pe=e(44268),ve=e(98126),q=e(67383),de=e(90142),Z=e(18312),T=e(85893),I=function(){var p=(0,A.useRef)(),X=(0,A.useRef)(),$=(0,ve.Z)(X),C=(0,A.useState)(!1),P=k()(C,2),g=P[0],b=P[1],Se=(0,A.useState)(null),Le=k()(Se,2),ge=Le[0],Pe=Le[1],se=(0,A.useState)(null),R=k()(se,2),D=R[0],f=R[1],U=(0,A.useState)(""),h=k()(U,2),c=h[0],x=h[1],o=(0,A.useState)("#ad0404"),d=k()(o,2),y=d[0],S=d[1],O=(0,A.useState)([]),E=k()(O,2),B=E[0],ae=E[1];(0,A.useEffect)(function(){var w=new pe.e7({modelUrl:Z.XM});w.initModel().then(function(){return Pe(w)})},[]);var le=function(){var w=K()(j()().mark(function F(u,a){var t,n,r,s;return j()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return b(!0),t=new Image,t.src=a,t.onload=function(){ge.setImage(a),f(t)},l.prev=4,n=q.y,r=new FormData,r.append("image_path",u),l.next=10,fetch(n,{body:r,method:"post"});case 10:return l.next=12,l.sent.arrayBuffer();case 12:s=l.sent,ge.setEmbedding(s),b(!1),J.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),l.next=22;break;case 18:l.prev=18,l.t0=l.catch(4),b(!1),J.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 22:case"end":return l.stop()}},F,null,[[4,18]])}));return function(u,a){return w.apply(this,arguments)}}();(0,A.useEffect)(function(){if(q.y)try{var w=new Image;w.src="../../assets/2.png",w.onload=function(){var F=document.createElement("canvas");F.width=w.width,F.height=w.height;var u=F.getContext("2d");u.drawImage(w,0,0);var a=F.toDataURL("image/jpeg"),t=a.indexOf(","),n=a==null?void 0:a.substring(t+1);ge&&le(n,w.src)}}catch(F){b(!1),J.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25")}},[ge]);var ye=function(){var w=K()(j()().mark(function F(u){var a,t,n,r;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(a=u.file,a.status!=="done"){i.next=8;break}return i.next=4,(0,pe.y3)(a.originFileObj);case 4:t=i.sent,n=t.indexOf(","),r=t==null?void 0:t.substring(n+1),le(r,t);case 8:case"end":return i.stop()}},F)}));return function(u){return w.apply(this,arguments)}}(),xe=function(F){var u=(0,de.vd)(F,D),a=u.x,t=u.y,n={x:a,y:t,clickType:1};ae(function(r){return[].concat(V()(r),[n])})};(0,A.useEffect)(function(){var w=p.current;if(B.length!==0&&D){w.width=$==null?void 0:$.width,w.height=$==null?void 0:$.height;var F=w.getContext("2d"),u=($==null?void 0:$.width)/(D==null?void 0:D.width),a=($==null?void 0:$.height)/(D==null?void 0:D.height);B.forEach(function(t){var n=t.x,r=t.y;F.fillStyle="red",F.beginPath(),F.arc(n*u,r*a,6,0,2*Math.PI),F.fill()})}},[B,p.current,D]);var ce=function(){ge.predict(B).then(function(F){var u=ge.exportImageClip(F);x(u.src),u.onload=function(){var a=(0,de.SO)(ge.imageData,F.data,(0,de.$F)(y));x(a)}}),ae([])};return(0,T.jsx)("div",{className:"content",children:(0,T.jsx)(ee.Z,{spinning:g,tip:"embedding...",children:(0,T.jsxs)("div",{className:"configArea",children:[(0,T.jsxs)(te.Z,{style:{width:"50%",maxWidth:"500px"},title:"\u5904\u7406\u524D",hoverable:!0,extra:(0,T.jsxs)(G.Z,{children:[(0,T.jsx)(Ae.Z,{value:y,format:"hex",onChange:function(F,u){return S(u)}}),(0,T.jsx)(re.ZP,{type:"primary",style:{marginLeft:8},onClick:function(){return ce()},children:"\u66F4\u6539\u80CC\u666F\u8272"})]}),children:[(0,T.jsx)("canvas",{id:"maskCircle",ref:p,style:{zIndex:10,position:"absolute",pointerEvents:"none"}}),D?(0,T.jsx)("img",{src:D.src,width:"100%",style:{position:"relative"},ref:X,onClick:xe}):(0,T.jsxs)(me.Z,{showUploadList:!1,onChange:ye,maxCount:1,accept:"image/*",multiple:!1,style:{height:150},children:[(0,T.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,T.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u70B9\u51FB\u4E0A\u4F20"})]})]}),(0,T.jsx)(te.Z,{style:{width:"50%",maxWidth:"500px",marginLeft:"20px"},title:"\u5904\u7406\u540E",hoverable:!0,extra:(0,T.jsx)(re.ZP,{type:"primary",disabled:!c,onClick:function(){return(0,de.YH)(c)},children:"\u4E0B\u8F7D"}),children:c?(0,T.jsx)("img",{src:c,width:"100%",ref:X,onClick:xe}):(0,T.jsxs)("div",{children:[(0,T.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,T.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u6682\u65E0\u56FE\u7247\u751F\u6210"})]})})]})})})}},82949:function(Ce,Y,e){e.r(Y),e.d(Y,{default:function(){return $}});var H=e(19632),V=e.n(H),ue=e(15009),j=e.n(ue),fe=e(99289),K=e.n(fe),he=e(5574),k=e.n(he),J=e(82061),ee=e(96638),te=e(78356),G=e(75081),Ae=e(26713),re=e(18722),me=e(66242),A=e(33573),pe=e(96074),ve=e(32983),q=e(67294),de=e(44268),Z=e(67383),T=e(90142),I=e(18312),p=e(85893),X={imageUrl:"",samModel:null,loading:!1,clipImg:[],originImg:null,originMaskImg:[],isSelecting:!1,startPoint:{x:0,y:0},endPoint:{x:0,y:0},clipType:"click",eventPoint:[]},$=function(){var C=(0,ee.Z)(X),P=k()(C,2),g=P[0],b=P[1];(0,q.useEffect)(function(){var h=new de.e7({modelUrl:I.XM,WasmPaths:I.XT});h.initModel().then(function(){b({samModel:h})})},[]);var Se=function(){var h=K()(j()().mark(function c(x,o){var d,y,S,O;return j()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.prev=0,d=Z.y,y=new FormData,y.append("image_path",x),B.next=6,fetch(d,{body:y,method:"post"});case 6:return B.next=8,B.sent.arrayBuffer();case 8:S=B.sent,g.samModel.setEmbedding(S),O=new Image,O.src=o,O.onload=function(){g.samModel.setImage(o),b({originImg:O})},b({imageUrl:o,loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),B.next=21;break;case 17:B.prev=17,B.t0=B.catch(0),b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 21:case"end":return B.stop()}},c,null,[[0,17]])}));return function(x,o){return h.apply(this,arguments)}}(),Le=function(){var h=K()(j()().mark(function c(x){var o,d,y,S;return j()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(o=x.file,E.prev=1,b({clipImg:[],loading:!0}),o.status!=="done"){E.next=10;break}return E.next=6,(0,de.y3)(o.originFileObj);case 6:d=E.sent,y=d.indexOf(","),S=d==null?void 0:d.substring(y+1),Se(S,d);case 10:E.next=16;break;case 12:E.prev=12,E.t0=E.catch(1),b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 16:case"end":return E.stop()}},c,null,[[1,12]])}));return function(x){return h.apply(this,arguments)}}();function ge(h){var c=h.size/1024/1024<1.1;if(!c){te.ZP.error("\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC71.1MB!"),b({loading:!1});return}}(0,q.useEffect)(function(){if(Z.y)try{var h=new Image;h.src="../../assets/demo1.jpg",h.onload=function(){b({loading:!0});var c=document.createElement("canvas");c.width=h.width,c.height=h.height;var x=c.getContext("2d");x.drawImage(h,0,0);var o=c.toDataURL("image/jpeg"),d=o.indexOf(","),y=o==null?void 0:o.substring(d+1);g.samModel&&Se(y,h.src)}}catch(c){b({loading:!1}),te.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25")}},[g.samModel]);var Pe=function(c){if(g.clipType==="click"){var x=c.nativeEvent.target.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,y=Math.round(c.pageX-x.left-d),S=Math.round(c.pageY-x.top-o),O=g.originImg?g.originImg.width/c.nativeEvent.target.offsetWidth:1;y*=O,S*=O,b({eventPoint:[y,S]})}},se=function(c){if(c.preventDefault(),g.clipType!=="click"){var x=c.nativeEvent.target.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,y=Math.round(c.pageX-x.left-d),S=Math.round(c.pageY-x.top-o);b({isSelecting:!0,startPoint:{x:y,y:S}})}},R=function(c){if(c.preventDefault(),g.clipType!=="click"){var x=c.nativeEvent.target.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft,y=Math.round(c.pageX-x.left-d),S=Math.round(c.pageY-x.top-o);b({endPoint:{x:y,y:S}})}},D=function(c){if(g.clipType!=="click"){b({isSelecting:!1});var x=g.startPoint,o=g.endPoint,d={x:Math.min(x.x,o.x),y:Math.min(x.y,o.y),width:Math.abs(x.x-o.x),height:Math.abs(x.y-o.y)};b({endPoint:{x:0,y:0},startPoint:{x:0,y:0}});var y=g.originImg?g.originImg.width/c.nativeEvent.target.offsetWidth:1,S=g.originImg?g.originImg.height/c.nativeEvent.target.offsetHeight:1,O=[d.x*y,d.y*S],E=[d.x*y+d.width*y,d.y*S+d.height*S],B=[].concat(O,E);b({eventPoint:B})}},f=function(){g.clipType!=="click"&&b({endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},U=(0,q.useMemo)(function(){if(!g.isSelecting)return null;var h=g.startPoint,c=g.endPoint;return(0,p.jsx)("div",{style:{position:"absolute",left:h.x,top:h.y,width:c.x-h.x,height:c.y-h.y,backgroundColor:"rgba(255, 0, 255, 0.3)",border:"1px dashed red",pointerEvents:"none",zIndex:1}})},[g.isSelecting,g.startPoint,g.endPoint]);return(0,q.useEffect)(function(){if(g.samModel&&g.eventPoint.length!==0){var h=g.eventPoint,c;g.clipType==="click"&&(c=[{x:h[0],y:h[1],clickType:1}]),g.clipType==="selectend"&&(c=[{x:h[0],y:h[1],clickType:2},{x:h[2],y:h[3],clickType:3}]);var x=function(d){var y=g.samModel.exportImageClip(d),S=g.samModel.exportMaskImage(d),O=String(new Date().getTime());b(function(E){return{clipImg:[].concat(V()(E.clipImg),[{clipSrc:y.src,maskSrc:S.src,mark:O}])}})};setTimeout(function(){g.samModel.predict(c).then(x)})}},[g.eventPoint,g.samModel,g.clipType]),(0,p.jsxs)(G.Z,{spinning:g.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:[(0,p.jsxs)(Ae.Z,{style:{marginBottom:16},children:[(0,p.jsxs)(re.Z,{className:"samPic__upload",multiple:!1,maxCount:1,showUploadList:!1,onChange:Le,accept:"image/*",beforeUpload:ge,children:[(0,p.jsx)(me.ZP,{type:"primary",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u4E0A\u4F20"}),(0,p.jsx)(me.ZP,{type:"primary",children:"\u70B9\u51FB\u4E0A\u4F20\u3002"})]}),(0,p.jsx)(A.ZP.Group,{style:{margin:"10px 0"},onChange:function(c){b({clipType:c.target.value,endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},value:g.clipType,buttonStyle:"solid",children:I._$.map(function(h){return(0,p.jsx)(A.ZP.Button,{value:h.value,children:h.label},h.value)})}),(0,p.jsx)(me.ZP,{block:!0,type:"primary",disabled:g.clipImg.length<=0,onClick:function(){return(0,T.O6)(g.clipImg,"clipImages")},style:{margin:"10px 0"},children:"\u4E0B\u8F7D\u6570\u636E"})]}),(0,p.jsxs)("div",{className:"samPic",children:[(0,p.jsx)("div",{className:"samPic__tool",children:g.clipImg.length>0?(0,p.jsx)("div",{className:"clipImgContent",children:g.clipImg.map(function(h,c){var x=h.clipSrc,o=h.mark;return(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsx)("img",{src:x,style:{width:100}}),(0,p.jsx)("div",{className:"tools",children:(0,p.jsx)(J.Z,{style:{opacity:.8},onClick:function(){b(function(y){return{clipImg:y.clipImg.filter(function(S){return S.mark!==o})}})}})}),(0,p.jsx)(pe.Z,{style:{margin:"8px 0"}})]},c)})}):(0,p.jsx)(ve.Z,{description:"\u6682\u65E0\u56FE\u7247"})}),(0,p.jsx)("div",{className:"samPic__preview",children:g.imageUrl&&(0,p.jsxs)("div",{style:{position:"relative"},children:[g.clipImg.length?g.clipImg.map(function(h,c){return(0,p.jsx)("img",{className:"samPic__preview__maskImg",src:h.maskSrc},c)}):null,(0,p.jsx)("img",{className:"samPic__preview__img",onClick:Pe,onMouseDown:se,onMouseMove:R,onMouseUp:D,onMouseOut:f,src:g.imageUrl,style:{cursor:g.clipType==="click"?"pointer":"crosshair"}}),g.clipType!=="click"&&U]})}),(0,p.jsx)("div",{className:"samPic__tool",children:g.clipImg.length>0?(0,p.jsx)("div",{className:"clipImgContent",children:g.clipImg.map(function(h,c){var x=h.clipSrc,o=h.mark;return(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsx)("img",{src:x,style:{width:50}}),(0,p.jsx)("div",{className:"tools",children:(0,p.jsx)(J.Z,{style:{opacity:.8},onClick:function(){b(function(y){return{clipImg:y.clipImg.filter(function(S){return S.mark!==o})}})}})}),(0,p.jsx)(pe.Z,{style:{margin:"8px 0"}})]},c)})}):(0,p.jsx)(ve.Z,{description:"\u6682\u65E0\u56FE\u7247"})})]})]})}},97314:function(Ce,Y,e){e.r(Y),e.d(Y,{default:function(){return Pe}});var H=e(15009),V=e.n(H),ue=e(19632),j=e.n(ue),fe=e(99289),K=e.n(fe),he=e(5574),k=e.n(he),J=e(7539),ee=e(78356),te=e(66242),G=e(33573),Ae=e(75081),re=e(67294),me=e(44268),A=e(54539),pe=e(96638),ve=e(67383),q=e(18312),de=e(37653),Z=e(43929),T=e(99247),I=e(90142),p=e(78234),X=e(63428),$=e(2302),C=e(85893),P=function(R){var D=R.value;return X.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(U){return[{range:U.getFullModelRange(),text:(0,I.XG)({content:U.getValue()})}]}}),(0,p.Z)(function(){X.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,C.jsx)($.ZP,{width:400,height:"calc(70vh - 56px)",language:"json",value:(0,I.XG)({content:D}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},g=e(61781),b=e(69323),Se=function(R){var D=R.samInfo,f=R.setSamState,U=function(o){f(function(d){return{satelliteData:d.satelliteData.filter(function(y){return y.imageUrl!==o.image})}}),ee.ZP.success("\u5220\u9664\u6210\u529F")},h=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(o){return(0,C.jsx)(g.Z,{placement:"topLeft",title:o,children:o})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(o){return(0,C.jsx)(g.Z,{color:"#fff",placement:"topLeft",title:(0,C.jsx)("img",{src:o,style:{width:200,height:200}}),children:(0,C.jsx)("img",{src:o,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(o,d){return(0,C.jsx)(te.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return U(d)},children:"\u5220\u9664"})}}],c=D.satelliteData.map(function(x,o){var d,y=(d=x.features[0])===null||d===void 0?void 0:d.geometry;return{key:o,geometry:JSON.stringify(y),image:x.imageUrl}});return(0,C.jsx)(b.Z,{size:"small",columns:h,dataSource:j()(c).reverse()})},Le=function(R){var D=R.samInfo,f=R.setSamState,U=(0,re.useMemo)(function(){var c=D.satelliteData.map(function(x){return x.features});return{type:"FeatureCollection",features:c.flat()}},[D.satelliteData]),h=[{key:"text",label:"\u7F16\u8F91\u5668\u5C55\u793A",children:(0,C.jsx)(P,{value:JSON.stringify(U!=null?U:(0,I.rC)(),null,2)})},{key:"table",label:"\u8868\u683C\u5C55\u793A",children:(0,C.jsx)(Se,{samInfo:D,setSamState:f})}];return(0,C.jsxs)("div",{className:"rightContainer",style:{width:D.collapsed?400:0},children:[(0,C.jsx)("div",{className:"rightContainer__collapsed",onClick:function(){return f(function(x){return{collapsed:!x.collapsed}})},children:D.collapsed?(0,C.jsx)(de.Z,{className:"rightContainer__collapsed__icon"}):(0,C.jsx)(Z.Z,{className:"rightContainer__collapsed__icon"})}),D.collapsed&&(0,C.jsx)(T.Z,{style:{width:D.collapsed?400:0},items:h,tabBarExtraContent:(0,C.jsx)(te.ZP,{size:"small",type:"primary",disabled:D.satelliteData.length<=0,onClick:function(){return(0,I.O6)(D.satelliteData)},children:"\u4E0B\u8F7D\u6570\u636E"})})]})},ge={samModel:null,currentScene:null,currentSource:null,mapClick:null,loading:!1,borderLayer:null,eventType:"click",collapsed:!0,satelliteData:[]},Pe=function(){var se=17,R=(0,pe.Z)(ge),D=k()(R,2),f=D[0],U=D[1],h=function(d){var y,S,O=q.Kl.find(function(E){return E.name===d.target.value});O&&((y=f.currentScene)===null||y===void 0||y.setCenter(O.coord)),(S=f.currentScene)===null||S===void 0||S.setZoom(O.zoom||17)},c=function(d){var y=Array.isArray(d),S=y?d:[d.lngLat.lng,d.lngLat.lat];U({mapClick:S})},x=function(){var o=K()(V()().mark(function d(){var y,S,O,E,B,ae,le,ye,xe,ce,w,F,u,a,t,n,r,s,i;return V()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return U({loading:!0}),E=(y=f.currentSource)===null||y===void 0||(S=y.tileset)===null||S===void 0?void 0:S.currentTiles,B=1/0,ae=1/0,le=-1/0,ye=-1/0,E==null||E.forEach(function(v){B=Math.min(B,v.x),ae=Math.min(ae,v.y),le=Math.max(le,v.x),ye=Math.max(ye,v.y)}),xe=Math.ceil((O=f.currentScene)===null||O===void 0?void 0:O.getZoom()),ce=document.createElement("canvas"),ce.width=(le-B+1)*256,ce.height=(ye-ae+1)*256,w=ce.getContext("2d"),F=f.samModel.mapHelper,u=[].concat(j()(F.tileToLngLat(B,ye+1,xe)),j()(F.tileToLngLat(le+1,ae,xe))),E==null||E.forEach(function(v){v&&(w==null||w.drawImage(v.data,(v.x-B)*256,(v.y-ae)*256,256,256))}),f.samModel.setGeoImage(ce.toDataURL(),{extent:u,width:ce.width,height:ce.height}),a=ce.toDataURL("image/jpeg"),t=a.indexOf(","),n=a==null?void 0:a.substring(t+1),r=ve.y,s=new FormData,s.append("image_path",n),m.next=24,fetch(r,{body:s,method:"post"});case 24:return m.next=26,m.sent.arrayBuffer();case 26:i=m.sent,f.samModel.setEmbedding(i),U({loading:!1}),ee.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210");case 30:case"end":return m.stop()}},d)}));return function(){return o.apply(this,arguments)}}();return(0,re.useEffect)(function(){if(!(!f.mapClick||!f.samModel)){var o=[];try{var d=f.mapClick;if(f.eventType==="click"){var y=f.samModel.lngLat2ImagePixel(d);o.push({x:y[0],y:y[1],clickType:1})}else if(f.eventType==="selectend"){var S=f.samModel.lngLat2ImagePixel([d[0],d[3]]),O=f.samModel.lngLat2ImagePixel([d[2],d[1]]);o.push({x:S[0],y:S[1],clickType:2}),o.push({x:O[0],y:O[1],clickType:3})}else f.eventType==="all"&&console.log(f.samModel.image.width,f.samModel.image.height);if(o.length===0)return;f.samModel.predict(o).then(function(){var E=K()(V()().mark(function B(ae){var le,ye,xe;return V()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,f.samModel.exportGeoPolygon(ae,1);case 2:le=w.sent,ye=f.samModel.exportImageClip(ae),xe={features:le.features,imageUrl:ye.src},U(function(F){var u=F.satelliteData.find(function(a){return a.imageUrl===xe.imageUrl});return u?{satelliteData:j()(F.satelliteData)}:{satelliteData:[].concat(j()(F.satelliteData),[xe])}});case 6:case"end":return w.stop()}},B)}));return function(B){return E.apply(this,arguments)}}())}catch(E){ee.ZP.error("\u8BF7\u5148\u70B9\u51FB[\u751F\u6210 embedding] \u6309\u94AE")}}},[f.mapClick]),(0,re.useEffect)(function(){if(f.borderLayer){var o=f.satelliteData.map(function(y){return y.features}),d={type:"FeatureCollection",features:o.flat()};f.borderLayer.setData(d)}},[f.borderLayer,f.satelliteData]),(0,re.useEffect)(function(){var o=new J.xsS({id:"map",map:new A.Z({center:[120.10533489408249,30.261061158180482],zoom:se,minZoom:3,style:"blank"})}),d=new J.Hw6(q.Hj,{parser:{type:"rasterTile",tileSize:256}}),y=new J.YYg({zIndex:-2}).source(d),S=new J.dWg({zIndex:10}).source({type:"FeatureCollection",features:[]}).shape("line").size(2).color("#f00").style({opacity:1});o.on("loaded",function(){o.addLayer(y),o.addLayer(S),U({borderLayer:S,currentScene:o,currentSource:d}),o.on("click",c),o.on("selectend",c)})},[]),(0,re.useEffect)(function(){f.eventType==="selectend"&&f.currentScene?f.currentScene.enableBoxSelect(!1):f.currentScene&&f.currentScene.disableBoxSelect()},[f.eventType]),(0,re.useEffect)(function(){var o=new me.XU({modelUrl:q.XM});o.initModel().then(function(){U({samModel:o})})},[]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(te.ZP,{onClick:x,children:" \u751F\u6210 embedding "}),(0,C.jsx)(G.ZP.Group,{style:{margin:"15px"},onChange:h,defaultValue:"A \u7A7A\u95F4",buttonStyle:"solid",children:q.Kl.map(function(o){return(0,C.jsx)(G.ZP.Button,{value:o.name,children:o.name},o.name)})}),(0,C.jsx)(Ae.Z,{spinning:f.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,C.jsxs)("div",{className:"mapContainer",children:[(0,C.jsx)("div",{id:"map",className:"mapContainer__map",style:{width:"calc(100vw - ".concat(f.collapsed?400:0,"px)")},children:(0,C.jsx)(G.ZP.Group,{style:{position:"absolute",top:15,left:15,zIndex:100},onChange:function(d){U({eventType:d.target.value})},value:f.eventType,size:"small",buttonStyle:"solid",children:q.bw.map(function(o){return(0,C.jsx)(G.ZP.Button,{value:o.value,children:o.label},o.value)})})}),(0,C.jsx)(Le,{samInfo:f,setSamState:U})]})})]})}},44268:function(Ce,Y,e){e.d(Y,{e7:function(){return f},XU:function(){return F},y3:function(){return C},Ul:function(){return Z}});var H=e(91972),V=function(a){var t=a.clicks,n=a.tensor,r=a.modelScale,s=n,i,l,m,v;if(t){var M=t.length;i=new Float32Array(2*(M+1)),l=new Float32Array(M+1);for(var L=0;L<M;L++)i[2*L]=t[L].x*r.samScale,i[2*L+1]=t[L].y*r.samScale,l[L]=t[L].clickType;i[2*M]=0,i[2*M+1]=0,l[M]=-1,m=new H.Tensor("float32",i,[1,M+1,2]),v=new H.Tensor("float32",l,[1,M+1])}var W=new H.Tensor("float32",[r.height,r.width]);if(!(m===void 0||v===void 0)){var _=new H.Tensor("float32",new Float32Array(256*256),[1,1,256,256]),oe=new H.Tensor("float32",[0]);return{image_embeddings:s,point_coords:m,point_labels:v,orig_im_size:W,mask_input:_,has_mask_input:oe}}},ue=e(15009),j=e.n(ue),fe=e(99289),K=e.n(fe),he=e(12444),k=e.n(he),J=e(72004),ee=e.n(J),te=e(9783),G=e.n(te),Ae=e(781),re="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",me=e(5574),A=e.n(me),pe=e(69826),ve=e(16479),q=e.n(ve);function de(u){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=u.width,a.height=u.height,t==null||t.putImageData(u,0,0),a}function Z(u){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"image/png",t=document.createElement("canvas"),n=t.getContext("2d");return t.width=u.width,t.height=u.height,n.drawImage(u,0,0,u.width,u.height),t.toDataURL(a)}function T(u){var a=de(u),t=new Image;return t.src=a.toDataURL(),t}function I(u,a,t,n){for(var r=new Uint8ClampedArray(u.data),s=new Uint8ClampedArray(4*t*n),i=0;i<a.length;i++)if(a[i]>0){var l=4*i;s[l+0]=r[l+0],s[l+1]=r[l+1],s[l+2]=Math.max(r[l+2],200),s[l+3]=r[l+3]}return T(new ImageData(s,t,n))}function p(u,a,t){for(var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:15,r=a,s=0,i=t,l=0,m=0;m<u.length;m++)if(u[m]>0){var v=m%a,M=Math.floor(m/a);r=Math.min(r,v),s=Math.max(s,v),i=Math.min(i,M),l=Math.max(l,M)}return[r-n,s+n,i-n,l+n]}function X(u,a,t,n,r,s){for(var i=[],l=0,m=a;m<n;m++)for(var v=u;v<t;v++){var M=m*s+v;i[l++]=r[M]>0?1:-1}return i}function $(u,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=u.map(function(i){return{x:i[0]+a,y:i[1]+t}});if(n===0)return r;var s=q()(r,n,!0);return s}var C=function(a){return new Promise(function(t,n){var r=new FileReader;r.readAsDataURL(a),r.onload=function(){return t(r.result)},r.onerror=function(s){return n(s)}})};function P(u,a,t){var n=p(u,a,t),r=A()(n,4),s=r[0],i=r[1],l=r[2],m=r[3],v=X(s,l,i,m,u,a),M=I(v,i-s,m-l);return T(M)}function g(u,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=p(u,a,t),s=A()(r,4),i=s[0],l=s[1],m=s[2],v=s[3],M=X(i,m,l,v,u,a),L=l-i,W=v-m,_=pe.Z().size([L,W]).smooth(!1).thresholds(2),oe=_(M);return $(oe[1].coordinates[0][0],i,m,n)}function b(u,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=0;n<a.length;n++)(t?a[n]<=0:a[n]>0)&&(u.data[4*n+0]=0,u.data[4*n+1]=0,u.data[4*n+2]=0,u.data[4*n+3]=0);return T(u)}function Se(u,a,t,n){for(var r=p(a,t,n),s=A()(r,4),i=s[0],l=s[1],m=s[2],v=s[3],M=new Uint8ClampedArray(4*(l-i)*(v-m)).fill(0),L=0,W=m;W<v;W++)for(var _=i;_<l;_++){var oe=W*t+_;a[oe]>0&&(M[L*4]=u.data[oe*4],M[L*4+1]=u.data[oe*4+1],M[L*4+2]=u.data[oe*4+2],M[L*4+3]=u.data[oe*4+3]),L++}var Ee=new ImageData(M,l-i,v-m);return T(Ee)}function Le(u){var a=document.createElement("a");a.href=u.src,a.download="image",a.click()}function ge(u){var a=document.createElement("a");a.href=u.toDataURL("image/png"),a.download="image",a.click()}function Pe(u){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=u.width,a.height=u.height,t==null||t.drawImage(u,0,0),t==null?void 0:t.getImageData(0,0,u.width,u.height)}var se=function(a){var t=1024,n=a.naturalWidth,r=a.naturalHeight,s=t/Math.max(r,n);return{height:r,width:n,samScale:s}},R=function(a,t){var n=1024,r=n/Math.max(t,a);return{height:t,width:a,samScale:r}},D=e(91972),f=function(){function u(a){k()(this,u),G()(this,"modelUrl",re),G()(this,"model",void 0),G()(this,"image",void 0),G()(this,"imageData",void 0),G()(this,"modelScale",void 0),G()(this,"tensor",void 0),a!=null&&a.modelUrl&&(this.modelUrl=a.modelUrl),a!=null&&a.wasmPaths&&this.setWasmUrl(a.wasmPaths)}return ee()(u,[{key:"initModel",value:function(){var a=K()(j()().mark(function n(){var r;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,H.InferenceSession.create(this.modelUrl);case 3:r=i.sent,this.model=r,i.next=10;break;case 7:throw i.prev=7,i.t0=i.catch(0),new Error("\u6A21\u578B\u52A0\u8F7D\u5931\u8D25");case 10:case"end":return i.stop()}},n,this,[[0,7]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"setImage",value:function(){var a=K()(j()().mark(function n(r){var s=this;return j()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:typeof r=="string"?(this.image=new Image,this.image.src=r,this.image.onload=function(){s.getImageScale(s.image),s.imageData=Pe(s.image)}):(this.image=r,this.getImageScale(this.image),this.imageData=Pe(this.image));case 1:case"end":return l.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"setEmbedding",value:function(){var a=K()(j()().mark(function n(r){var s,i,l,m,v=arguments;return j()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(s=v.length>1&&v[1]!==void 0?v[1]:"float32",i=new Ae.Z,typeof r!="string"){L.next=6;break}L.t0=i.load(r),L.next=9;break;case 6:return L.next=8,i.parse(r);case 8:L.t0=L.sent;case 9:l=L.t0,m=new D.Tensor(s,l.data,l.shape),this.tensor=m;case 12:case"end":return L.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predict",value:function(){var a=K()(j()().mark(function n(r){var s,i,l;return j()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,!(this.model===null||r===null||this.tensor===null||this.modelScale===null)){v.next=6;break}return console.log("model not loaded"),v.abrupt("return");case 6:if(s=V({clicks:r,tensor:this.tensor,modelScale:this.modelScale}),s!==void 0){v.next=9;break}return v.abrupt("return");case 9:return v.next=11,this.model.run(s);case 11:return i=v.sent,l=i[this.model.outputNames[0]],v.abrupt("return",l);case 14:v.next=20;break;case 16:return v.prev=16,v.t0=v.catch(0),console.log(v.t0),v.abrupt("return");case 20:case"end":return v.stop()}},n,this,[[0,16]])}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predictByBox",value:function(){var a=K()(j()().mark(function n(r){return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",r);case 1:case"end":return i.stop()}},n)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"exportMaskImage",value:function(t){if(this.imageData!==void 0)return I(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportMaskClip",value:function(t){return P(t.data,t.dims[3],t.dims[2])}},{key:"exportImage",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.imageData!==void 0)return b(this.imageData,t.data,n)}},{key:"exportImageClip",value:function(t){if(this.imageData!==void 0)return Se(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportVector",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return g(t.data,t.dims[3],t.dims[2],n)}},{key:"setWasmUrl",value:function(t){H.env.wasm.wasmPaths=t}},{key:"getImageScale",value:function(t){var n=t.width,r=t.height;this.modelScale=R(n,r)}}]),u}(),U=e(19632),h=e.n(U),c=e(25098),x=e.n(c),o=e(28785),d=e.n(o),y=e(48374),S=e.n(y),O=e(31996),E=e.n(O),B=e(26037),ae=e.n(B),le=function(){function u(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:256,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"tms";k()(this,u),G()(this,"tileSize",void 0),G()(this,"type",void 0),G()(this,"initialResolution",void 0),G()(this,"originShift",void 0),this.tileSize=a,this.type=t,this.initialResolution=2*Math.PI*6378137/this.tileSize,this.originShift=2*Math.PI*6378137/2}return ee()(u,[{key:"lngLatToMeters",value:function(t,n){var r=t*this.originShift/180,s=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return s=s*this.originShift/180,[r,s]}},{key:"metersToLngLat",value:function(t,n){var r=t/this.originShift*180,s=n/this.originShift*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),[r,s]}},{key:"pixelsToMeters",value:function(t,n,r){var s=this.resolution(r),i=t*s-this.originShift,l=(this.type==="tms"?n:Math.pow(2,r)*256-n)*s-this.originShift;return[i,l]}},{key:"metersToPixels",value:function(t,n,r){var s=this.resolution(r),i=(t+this.originShift)/s,l=(n+this.originShift)/s;return l=this.type==="tms"?l:Math.pow(2,r)*256-l,[i,l]}},{key:"metersToTile",value:function(t,n,r){var s=this.metersToPixels(t,n,r),i=A()(s,2),l=i[0],m=i[1];return this.pixelsToTile(l,m)}},{key:"tileToMeters",value:function(t,n,r){return this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r)}},{key:"tileToLngLat",value:function(t,n,r){var s=this.tileToMeters(t,n,r),i=A()(s,2),l=i[0],m=i[1];return this.metersToLngLat(l,m)}},{key:"pixelsToTile",value:function(t,n){var r=Math.floor(Math.ceil(t/this.tileSize)-1),s=Math.floor(Math.ceil(n/this.tileSize)-1);return[r,s]}},{key:"pixelsToRaster",value:function(t,n,r){var s=this.tileSize<<r;return[t,s-n]}},{key:"tileBounds",value:function(t,n,r){var s=this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r),i=A()(s,2),l=i[0],m=i[1],v=this.pixelsToMeters((t+1)*this.tileSize,(n+1)*this.tileSize,r),M=A()(v,2),L=M[0],W=M[1];return[l,m,L,W]}},{key:"tileLatLonBounds",value:function(t,n,r){var s=this.tileBounds(t,n,r),i=this.metersToLngLat(s[0],s[1]),l=A()(i,2),m=l[0],v=l[1],M=this.metersToLngLat(s[2],s[3]),L=A()(M,2),W=L[0],_=L[1];return[m,v,W,_]}},{key:"resolution",value:function(t){return this.initialResolution/Math.pow(2,t)}},{key:"lngLatToPixels",value:function(t,n,r){var s=this.lngLatToMeters(t,n),i=A()(s,2),l=i[0],m=i[1];return this.metersToPixels(l,m,r)}},{key:"pixelsTolngLat",value:function(t,n,r){var s=this.pixelsToMeters(t,n,r);return this.metersToLngLat(s[0],s[1])}},{key:"lngLatToTile",value:function(t,n,r){var s=this.lngLatToPixels(t,n,r),i=A()(s,2),l=i[0],m=i[1];return this.pixelsToTile(l,m)}},{key:"googleTile",value:function(t,n,r){return[t,Math.pow(2,r)-1-n]}},{key:"boundsToTileExtent",value:function(t,n,r,s,i){var l=this.lngLatToTile(t,s,i),m=A()(l,2),v=m[0],M=m[1],L=this.lngLatToTile(r,n,i),W=A()(L,2),_=W[0],oe=W[1];return[[v,M],[_,oe]]}},{key:"metersboundsToTileExtent",value:function(t,n,r,s,i){var l=this.metersToTile(t,s,i),m=A()(l,2),v=m[0],M=m[1],L=this.metersToTile(r,n,i),W=A()(L,2),_=W[0],oe=W[1];return[[v,M],[_,oe]]}}]),u}(),ye=null,xe=function(a){var t=_slicedToArray(a,4),n=t[0],r=t[1],s=t[2],i=t[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[n,r],[n,i],[s,i],[s,r],[n,r]]]}}]}},ce=function(a){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[a]}}]}},w=function(){return{type:"FeatureCollection",features:[]}},F=function(u){E()(t,u);var a=ae()(t);function t(){var n;k()(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return n=a.call.apply(a,[this].concat(s)),G()(x()(n),"imageOption",void 0),G()(x()(n),"imageBounds",void 0),G()(x()(n),"metersPerpixelsX",0),G()(x()(n),"metersPerpixelsY",0),G()(x()(n),"mapHelper",new le(256,"google")),n}return ee()(t,[{key:"setGeoImage",value:function(){var n=K()(j()().mark(function s(i,l){var m,v,M;return j()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:d()(S()(t.prototype),"setImage",this).call(this,i),this.imageOption=l,m=l.extent,v=l.width,M=l.height,m&&(this.imageBounds=[].concat(h()(this.mapHelper.lngLatToMeters(m[0],m[1])),h()(this.mapHelper.lngLatToMeters(m[2],m[3]))),this.metersPerpixelsX=(this.imageBounds[2]-this.imageBounds[0])/v,this.metersPerpixelsY=(this.imageBounds[3]-this.imageBounds[1])/M);case 4:case"end":return W.stop()}},s,this)}));function r(s,i){return n.apply(this,arguments)}return r}()},{key:"exportGeoPolygon",value:function(){var n=K()(j()().mark(function s(i){var l=this,m,v,M,L,W,_=arguments;return j()().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return m=_.length>1&&_[1]!==void 0?_[1]:5,Ee.next=3,this.exportVector(i,m);case 3:return v=Ee.sent,M=this.imageBounds,L=v.map(function(Fe){var Be=[Fe.x*l.metersPerpixelsX+M[0],(l.imageOption.height-Fe.y)*l.metersPerpixelsY+M[1]],Ze=l.mapHelper.metersToLngLat(Be[0],Be[1]);return Ze}),W=ce(L),Ee.abrupt("return",W);case 8:case"end":return Ee.stop()}},s,this)}));function r(s){return n.apply(this,arguments)}return r}()},{key:"lngLat2ImagePixel",value:function(r){if(this.imageBounds){var s=this.mapHelper.lngLatToMeters(r[0],r[1]),i=A()(s,2),l=i[0],m=i[1],v=(l-this.imageBounds[0])/this.metersPerpixelsX,M=(m-this.imageBounds[1])/this.metersPerpixelsY;return M=this.imageOption.height-M,[v,M]}}}]),t}(f)}}]);
