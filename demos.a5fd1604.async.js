"use strict";(self.webpackChunk_antv_sam=self.webpackChunk_antv_sam||[]).push([[433],{18312:function(Ce,ee,e){e.d(ee,{Hj:function(){return G},Kl:function(){return $},XM:function(){return D},XT:function(){return ye},_$:function(){return X},bw:function(){return fe}});var J="https://www.google.com/maps/vt?lyrs=s@820&gl=cn&x={x}&y={y}&z={z}",G=J,Ae="https://t{0-7}.tianditu.gov.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk=b72aa81ac2b3cae941d1eb213499e15e",D="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",ye="https://npm.elemecdn.com/onnxruntime-web/dist/",$=[{name:"A \u7A7A\u95F4",coord:[120.10533489408249,30.261061158180482],zoom:18},{name:"\u6CB9\u7F50",coord:[-96.74674229210954,35.935326263559816],zoom:15.5},{name:"\u519C\u7530",coord:[5.000138834496795,52.83911856295691],zoom:13.5},{name:"\u519C\u75302",coord:[-111.91603037093357,32.91837220530866],zoom:13},{name:"\u704C\u6E89\u519C\u7530",coord:[38.274419546979345,30.107721922396593],zoom:12.5},{name:"\u5EFA\u7B51",coord:[-75.68709358840009,45.40821167856009],zoom:18},{name:"\u5EFA\u7B512",coord:[-117.9375255130447,33.809435077864805],zoom:18.2},{name:"\u673A\u573A",coord:[-117.377,34.596],zoom:15.5},{name:"\u8349\u573A",coord:[28.725760156128445,22.24767189005027],zoom:12}],fe=[{label:"\u70B9\u9009",value:"click"}],X=[{label:"\u70B9\u9009",value:"click"},{label:"\u6846\u9009",value:"selectend"}]},67383:function(Ce,ee,e){e.d(ee,{y:function(){return J}});var J="https://sam.lvisei.icu/api"},90142:function(Ce,ee,e){e.d(ee,{$F:function(){return N},O6:function(){return U},SO:function(){return R},XG:function(){return Te},YH:function(){return te},rC:function(){return se}});var J=e(5574),G=e.n(J),Ae=e(15009),D=e.n(Ae),ye=e(99289),$=e.n(ye),fe=e(73945),X=e.n(fe),Q=e(28182),ie=e.n(Q),xe=null,z=function(Z){var L=_slicedToArray(Z,4),T=L[0],H=L[1],ae=L[2],ue=L[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[T,H],[T,ue],[ae,ue],[ae,H],[T,H]]]}}]}},Y=function(Z){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[Z]}}]}},se=function(){return{type:"FeatureCollection",features:[]}};function Te(w){var Z=w.content,L=Z;typeof Z!="string"&&(L=JSON.stringify(Z,null,2));var T=X().format(L,{parser:"json",plugins:[ie()]});return T}var U=function(Z){var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"data-".concat(new Date().toLocaleString()),T=new Blob([Te({content:JSON.stringify(Z)})],{type:"application/json"}),H=document.createElement("a");H.download="".concat(L,".json"),H.href=URL.createObjectURL(T),H.click()};function N(w){var Z=parseInt(w.slice(1,3),16),L=parseInt(w.slice(3,5),16),T=parseInt(w.slice(5,7),16);return[Z,L,T,255]}function R(w,Z){for(var L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[255,0,0,255],T=G()(L,4),H=T[0],ae=T[1],ue=T[2],I=T[3],ne=0;ne<Z.length;ne++)Z[ne]<=0&&(w.data[4*ne+0]=H,w.data[4*ne+1]=ae,w.data[4*ne+2]=ue,w.data[4*ne+3]=I);var l=document.createElement("canvas");l.width=w.width,l.height=w.height;var F=l.getContext("2d");return F.putImageData(w,0,0),l.toDataURL("image/png")}var te=function(Z){var L=document.createElement("a"),T=new Image;T.src=Z,L.download="img.png",L.target="_blank",L.href=T.src,L.click()}},97827:function(Ce,ee,e){e.r(ee),e.d(ee,{default:function(){return he}});var J=e(19632),G=e.n(J),Ae=e(15009),D=e.n(Ae),ye=e(99289),$=e.n(ye),fe=e(5574),X=e.n(fe),Q=e(4288),ie=e(78356),xe=e(33573),z=e(18722),Y=e(66242),se=e(84385),Te=e(71338),U=e(75081),N=e(67294),R=e(88484),te=e(44268),w=e(67383),Z=e(18312),L=[{name:"A \u7A7A\u95F4",extent:[120.09979248046875,30.256694798480346,120.11352539062499,30.26381184075493],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*rOXuSb_Tv6MAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u6CB9\u7F50",extent:[-96.7620849609375,35.92464453144096,-96.734619140625,35.94243575255426],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4c-2T41ESekAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u519C\u7530",extent:[4.943847656250016,52.81604319154931,5.053710937499996,52.86912972768522],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*bKPgT4XGbFIAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u5706\u5F62\u519C\u7530",extent:[28.60839843749999,22.146707780012644,28.828125000000014,22.350075806124867],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*4KUZSanj_NsAAAAAAAAAAAAADmJ7AQ/original"},{name:"\u673A\u573A",extent:[-117.388916015625,34.58799745550485,-117.366943359375,34.6060845921693],url:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Y7OHSYNL1VkAAAAAAAAAAAAADmJ7AQ/original"}],T=e(98126),H=e(3679),ae=e(90142),ue=e(78234),I=e(63428),ne=e(2302),l=e(85893),F=function(E){var h=E.value,j=E.width;return I.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(f){return[{range:f.getFullModelRange(),text:(0,ae.XG)({content:f.getValue()})}]}}),(0,ue.Z)(function(){I.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,l.jsx)(ne.ZP,{width:j-20,height:"400",language:"json",value:(0,ae.XG)({content:h}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},ge=e(61781),Le=e(8446),De=function(E){var h=E.satelliteData,j=E.setSatelliteData,p=function(o){j(function(d){return G()(d.filter(function(x){return x.imageUrl!==o.image}))}),ie.ZP.success("\u5220\u9664\u6210\u529F")},f=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(o){return(0,l.jsx)(ge.Z,{placement:"topLeft",title:o,children:o})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(o){return(0,l.jsx)(ge.Z,{color:"#fff",placement:"topLeft",title:(0,l.jsx)("img",{src:o,style:{width:200,height:200}}),children:(0,l.jsx)("img",{src:o,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(o,d){return(0,l.jsx)(Y.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return p(d)},children:"\u5220\u9664"})}}],y=h.map(function(u,o){var d,x=(d=u.features[0])===null||d===void 0?void 0:d.geometry;return{key:o,geometry:JSON.stringify(x),image:u.imageUrl}});return(0,l.jsx)(Le.Z,{size:"small",columns:f,dataSource:G()(y).reverse(),scroll:{y:400},pagination:!1})},Ie=function(E){var h=(0,N.useRef)(),j=(0,T.Z)(h),p=E.satelliteData,f=E.setSatelliteData,y=(0,N.useState)("text"),u=X()(y,2),o=u[0],d=u[1],x=(0,N.useMemo)(function(){var M=p.map(function(W){return W.features});return{type:"FeatureCollection",features:M.flat()}},[p]),C=[{key:"text",tab:"\u7F16\u8F91\u5668\u5C55\u793A"},{key:"table",tab:"\u8868\u683C\u5C55\u793A"}],S={text:(0,l.jsx)(F,{width:j==null?void 0:j.width,value:JSON.stringify(x!=null?x:(0,ae.rC)(),null,2)}),table:(0,l.jsx)(De,{satelliteData:p,setSatelliteData:f})};return(0,l.jsx)(H.Z,{ref:h,hoverable:!0,style:{width:"32%"},tabList:C,activeTabKey:o,onTabChange:d,children:S[o]})},he=function(){var q=Q.Z.useForm(),E=X()(q,1),h=E[0],j=(0,N.useState)(!1),p=X()(j,2),f=p[0],y=p[1],u=(0,N.useState)(null),o=X()(u,2),d=o[0],x=o[1],C=(0,N.useState)(null),S=X()(C,2),M=S[0],W=S[1],_=(0,N.useState)(L[0].url),V=X()(_,2),O=V[0],me=V[1],pe=(0,N.useState)(L[0].extent),de=X()(pe,2),c=de[0],a=de[1],t=(0,N.useState)([]),n=X()(t,2),r=n[0],i=n[1],s=(0,N.useState)(L[0].name),m=X()(s,2),g=m[0],v=m[1],A=(0,N.useState)(1),P=X()(A,2),k=P[0],re=P[1],ce=function(){var B=$()(D()().mark(function b(K){var ve,Se,je;return D()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return y(!0),le.prev=1,ve=w.y,Se=new FormData,Se.append("image_path",K),le.next=7,fetch(ve,{body:Se,method:"post"});case 7:return le.next=9,le.sent.arrayBuffer();case 9:je=le.sent,d.setEmbedding(je),y(!1),ie.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),le.next=19;break;case 15:le.prev=15,le.t0=le.catch(1),y(!1),ie.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 19:case"end":return le.stop()}},b,null,[[1,15]])}));return function(K){return B.apply(this,arguments)}}();(0,N.useEffect)(function(){var B=new te.XU({modelUrl:Z.XM,wasmPaths:Z.XT});B.initModel().then(function(){x(B)})},[]),(0,N.useEffect)(function(){if(d&&O&&c){var B=new Image;B.crossOrigin="anonymous",B.onload=function(){var b=(0,te.Ul)(B,"image/jpeg"),K=b.indexOf(","),ve=b==null?void 0:b.substring(K+1);ce(ve),d.setGeoImage(B,{width:B.width,height:B.height,extent:c}),W(B)},B.src=O}},[d,O]);var Me=function(b){var K=b.nativeEvent.target.getBoundingClientRect(),ve=Math.round(b.pageX-K.left),Se=Math.round(b.pageY-K.top),je=M?M.width/b.nativeEvent.target.offsetWidth:1,Ee=M?M.height/b.nativeEvent.target.offsetHeight:1;ve*=je,Se*=Ee;var le=[{x:ve,y:Se,clickType:1}];d.predict(le).then(function(){var Ze=$()(D()().mark(function Pe(Ue){var oe,be,$e,Oe;return D()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return oe=d.exportImageClip(Ue),be=d.exportMaskImage(Ue),we.next=4,d.exportGeoPolygon(Ue,k);case 4:$e=we.sent,Oe={features:$e.features,imageUrl:oe.src,maskImg:be.src,key:String(new Date().getTime())},i(function(ze){var Ne=ze.find(function(Ge){return Ge.imageUrl===Oe.imageUrl});return Ne?G()(ze):[].concat(G()(ze),[Oe])});case 7:case"end":return we.stop()}},Pe)}));return function(Pe){return Ze.apply(this,arguments)}}())},Fe=function(b){return Array.isArray(b)?b:b==null?void 0:b.fileList},Be=function(){var B=$()(D()().mark(function b(K){var ve,Se,je,Ee,le,Ze,Pe;return D()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(oe.prev=0,re((ve=K==null?void 0:K.simplifyThreshold)!==null&&ve!==void 0?ve:1),!(K!=null&&K.upload)){oe.next=14;break}if(Se=K.upload,je=K.coordinate,Ee=Se[0],Ee.status!=="done"){oe.next=10;break}return oe.next=8,(0,te.y3)(Ee.originFileObj);case 8:le=oe.sent,me(le);case 10:Ze=je.split(";").map(function(be){return be.split(",")}).flat(),a(Ze),oe.next=17;break;case 14:Pe=L.find(function(be){return be.name===K.choose}),me(Pe==null?void 0:Pe.url),a(Pe==null?void 0:Pe.extent);case 17:oe.next=22;break;case 19:oe.prev=19,oe.t0=oe.catch(0),ie.ZP.error("\u9519\u8BEF:".concat(oe.t0));case 22:case"end":return oe.stop()}},b,null,[[0,19]])}));return function(K){return B.apply(this,arguments)}}();(0,N.useEffect)(function(){if(h){var B,b,K=(B=L.find(function(Se){return Se.name===g}))===null||B===void 0?void 0:B.name,ve=JSON.stringify((b=L.find(function(Se){return Se.name===g}))===null||b===void 0?void 0:b.extent);h.setFieldsValue({choose:K,coordinate:ve})}},[h,g]);var Re=function(b){b[0].name[0]==="choose"&&v(b[0].value),b[0].name[0]==="upload"&&h.setFieldsValue({coordinate:""})},ke=function(b,K){if(!K)return Promise.reject("\u8BF7\u8F93\u5165");var ve=K.split(";");if(ve.length===0)return Promise.reject("\u8BF7\u6B63\u786E\u8F93\u5165")};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(Q.Z,{form:h,onFinish:Be,labelCol:{span:3},labelAlign:"left",onFieldsChange:Re,children:[(0,l.jsx)(Q.Z.Item,{name:"choose",label:"\u793A\u4F8B",children:(0,l.jsx)(xe.ZP.Group,{buttonStyle:"solid",onChange:function(){h.setFieldsValue({upload:void 0})},children:L.map(function(B){return(0,l.jsx)(xe.ZP.Button,{value:B.name,children:B.name},B.name)})})}),(0,l.jsx)(Q.Z.Item,{label:"\u4E0A\u4F20",name:"upload",valuePropName:"fileList",getValueFromEvent:Fe,children:(0,l.jsx)(z.Z,{multiple:!1,maxCount:1,accept:"image/*",children:(0,l.jsx)(Y.ZP,{type:"primary",icon:(0,l.jsx)(R.Z,{}),children:"\u70B9\u51FB\u4E0A\u4F20"})})}),(0,l.jsx)(Q.Z.Item,{name:"coordinate",label:"\u5730\u7406\u5750\u6807",rules:[{required:!0,validator:ke}],children:(0,l.jsx)(se.Z,{placeholder:"[120.09979248046875,30.256694798480346;120.11352539062499,30.26381184075493]",style:{width:300}})}),(0,l.jsx)(Q.Z.Item,{label:"polygon\u62BD\u7A00\u7CFB\u6570:",name:"simplifyThreshold",children:(0,l.jsx)(Te.Z,{step:.1,min:0,max:100,style:{width:300}})}),(0,l.jsx)(Q.Z.Item,{children:(0,l.jsx)(Y.ZP,{type:"primary",htmlType:"submit",children:"\u63D0\u4EA4"})})]}),(0,l.jsx)(U.Z,{spinning:f,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,l.jsxs)("div",{className:"normalMapContainer",children:[(0,l.jsx)("img",{src:O,style:{width:"68%"},onClick:Me}),r.length?r.map(function(B,b){return(0,l.jsx)("img",{className:"normalMaskImg",src:B.maskImg},b)}):null,(0,l.jsx)(Ie,{satelliteData:r,setSatelliteData:i})]})})]})}},26843:function(Ce,ee,e){e.r(ee),e.d(ee,{default:function(){return te}});var J=e(15009),G=e.n(J),Ae=e(99289),D=e.n(Ae),ye=e(5574),$=e.n(ye),fe=e(78356),X=e(75081),Q=e(3679),ie=e(74809),xe=e(18722),z=e(66242),Y=e(67294),se=e(44268),Te=e(67383),U=e(90142),N=e(18312),R=e(85893),te=function(){var w=(0,Y.useRef)(),Z=(0,Y.useState)(!1),L=$()(Z,2),T=L[0],H=L[1],ae=(0,Y.useState)(null),ue=$()(ae,2),I=ue[0],ne=ue[1],l=(0,Y.useState)(null),F=$()(l,2),ge=F[0],Le=F[1],De=(0,Y.useState)(""),Ie=$()(De,2),he=Ie[0],q=Ie[1],E=(0,Y.useState)("#ad0404"),h=$()(E,2),j=h[0],p=h[1];(0,Y.useEffect)(function(){var o=new se.e7({modelUrl:N.XM,WasmPaths:N.XT});o.initModel().then(function(){return ne(o)})},[]);var f=function(){var o=D()(G()().mark(function d(x,C){var S,M,W,_;return G()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return H(!0),O.prev=1,S=Te.y,M=new FormData,M.append("image_path",x),O.next=7,fetch(S,{body:M,method:"post"});case 7:return O.next=9,O.sent.arrayBuffer();case 9:W=O.sent,I.setEmbedding(W),_=new Image,_.src=C,_.onload=D()(G()().mark(function me(){return G()().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:I.setImage(C),Le(_),q(C);case 3:case"end":return de.stop()}},me)})),H(!1),fe.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),O.next=22;break;case 18:O.prev=18,O.t0=O.catch(1),H(!1),fe.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 22:case"end":return O.stop()}},d,null,[[1,18]])}));return function(x,C){return o.apply(this,arguments)}}(),y=function(){var o=D()(G()().mark(function d(x){var C,S,M,W;return G()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(C=x.file,C.status!=="done"){V.next=8;break}return V.next=4,(0,se.y3)(C.originFileObj);case 4:S=V.sent,M=S.indexOf(","),W=S==null?void 0:S.substring(M+1),f(W,S);case 8:case"end":return V.stop()}},d)}));return function(x){return o.apply(this,arguments)}}(),u=function(d){if(I&&ge){var x=d.nativeEvent.target.getBoundingClientRect(),C=Math.round(d.pageX-x.left),S=Math.round(d.pageY-x.top),M=ge?ge.width/d.nativeEvent.target.offsetWidth:1;C*=M,S*=M;var W=[{x:C,y:S,clickType:1}];I.predict(W).then(function(_){var V=I.exportImageClip(_);V.onload=function(){var O=(0,U.SO)(I.imageData,_.data,(0,U.$F)(j));q(O)}})}};return(0,R.jsx)("div",{className:"content",children:(0,R.jsx)(X.Z,{spinning:T,tip:"embedding...",children:(0,R.jsxs)("div",{className:"configArea",children:[(0,R.jsx)(Q.Z,{style:{width:"50%",maxWidth:"500px"},title:"\u5904\u7406\u524D",hoverable:!0,extra:(0,R.jsx)(ie.Z,{value:j,format:"hex",onChange:function(d,x){return p(x)}}),children:ge?(0,R.jsx)("img",{src:ge.src,width:"100%",ref:w,onClick:u}):(0,R.jsxs)(xe.Z,{showUploadList:!1,onChange:y,maxCount:1,accept:"image/*",multiple:!1,style:{height:150},children:[(0,R.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,R.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u70B9\u51FB\u4E0A\u4F20"})]})}),(0,R.jsx)(Q.Z,{style:{width:"50%",maxWidth:"500px",marginLeft:"20px"},title:"\u5904\u7406\u540E",hoverable:!0,extra:(0,R.jsx)(z.ZP,{type:"primary",disabled:!he,onClick:function(){return(0,U.YH)(he)},children:"\u4E0B\u8F7D"}),children:he?(0,R.jsx)("img",{src:he,width:"100%",ref:w,onClick:u}):(0,R.jsxs)("div",{children:[(0,R.jsx)("img",{src:"https://mdn.alipayobjects.com/huamei_juqv6t/afts/img/A*2QADT69gLtwAAAAAAAAAAAAADiaPAQ/original",style:{width:400,height:210,filter:"opacity(0.25)"}}),(0,R.jsx)("p",{className:"ant-upload-text",style:{textAlign:"center"},children:"\u6682\u65E0\u56FE\u7247\u751F\u6210"})]})})]})})})}},82949:function(Ce,ee,e){e.r(ee),e.d(ee,{default:function(){return ue}});var J=e(19632),G=e.n(J),Ae=e(15009),D=e.n(Ae),ye=e(99289),$=e.n(ye),fe=e(5574),X=e.n(fe),Q=e(64082),ie=e(82061),xe=e(96638),z=e(18722),Y=e(78356),se=e(75081),Te=e(33573),U=e(66242),N=e(96074),R=e(67294),te=e(44268),w=e(67383),Z=e(90142),L=e(18312),T=e(85893),H=z.Z.Dragger,ae={imageUrl:"",samModel:null,loading:!1,clipImg:[],originImg:null,originMaskImg:[],isSelecting:!1,startPoint:{x:0,y:0},endPoint:{x:0,y:0},clipType:"click",eventPoint:[]},ue=function(){var I=(0,xe.Z)(ae),ne=X()(I,2),l=ne[0],F=ne[1];(0,R.useEffect)(function(){var p=new te.e7({modelUrl:L.XM,WasmPaths:L.XT});p.initModel().then(function(){F({samModel:p})})},[]);var ge=function(){var p=$()(D()().mark(function f(y,u){var o,d,x,C;return D()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.prev=0,o=w.y,d=new FormData,d.append("image_path",y),M.next=6,fetch(o,{body:d,method:"post"});case 6:return M.next=8,M.sent.arrayBuffer();case 8:x=M.sent,l.samModel.setEmbedding(x),C=new Image,C.src=u,C.onload=function(){l.samModel.setImage(u),F({originImg:C})},F({imageUrl:u,loading:!1}),Y.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210"),M.next=21;break;case 17:M.prev=17,M.t0=M.catch(0),F({loading:!1}),Y.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 21:case"end":return M.stop()}},f,null,[[0,17]])}));return function(y,u){return p.apply(this,arguments)}}(),Le=function(){var p=$()(D()().mark(function f(y){var u,o,d,x;return D()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(u=y.file,S.prev=1,F({clipImg:[],loading:!0}),u.status!=="done"){S.next=10;break}return S.next=6,(0,te.y3)(u.originFileObj);case 6:o=S.sent,d=o.indexOf(","),x=o==null?void 0:o.substring(d+1),ge(x,o);case 10:S.next=16;break;case 12:S.prev=12,S.t0=S.catch(1),F({loading:!1}),Y.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25");case 16:case"end":return S.stop()}},f,null,[[1,12]])}));return function(y){return p.apply(this,arguments)}}();function De(p){var f=p.size/1024/1024<1.1;if(!f){Y.ZP.error("\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC71.1MB!"),F({loading:!1});return}}(0,R.useEffect)(function(){if(w.y)try{var p=new Image;p.src="../../assets/demo1.jpg",p.onload=function(){F({loading:!0});var f=document.createElement("canvas");f.width=p.width,f.height=p.height;var y=f.getContext("2d");y.drawImage(p,0,0);var u=f.toDataURL("image/jpeg"),o=u.indexOf(","),d=u==null?void 0:u.substring(o+1);l.samModel&&ge(d,p.src)}}catch(f){F({loading:!1}),Y.ZP.success("embedding\u8BA1\u7B97\u5931\u8D25")}},[l.samModel]);var Ie=function(f){if(l.clipType==="click"){var y=f.nativeEvent.target.getBoundingClientRect(),u=Math.round(f.pageX-y.left),o=Math.round(f.pageY-y.top),d=l.originImg?l.originImg.width/f.nativeEvent.target.offsetWidth:1;u*=d,o*=d,F({eventPoint:[u,o]})}},he=function(f){if(f.preventDefault(),l.clipType!=="click"){var y=f.nativeEvent.target.getBoundingClientRect(),u=Math.round(f.pageX-y.left),o=Math.round(f.pageY-y.top);F({isSelecting:!0,startPoint:{x:u,y:o}})}},q=function(f){if(f.preventDefault(),l.clipType!=="click"){var y=f.nativeEvent.target.getBoundingClientRect(),u=Math.round(f.pageX-y.left),o=Math.round(f.pageY-y.top);F({endPoint:{x:u,y:o}})}},E=function(f){if(l.clipType!=="click"){F({isSelecting:!1});var y=l.startPoint,u=l.endPoint,o={x:Math.min(y.x,u.x),y:Math.min(y.y,u.y),width:Math.abs(y.x-u.x),height:Math.abs(y.y-u.y)};F({endPoint:{x:0,y:0},startPoint:{x:0,y:0}});var d=l.originImg?l.originImg.width/f.nativeEvent.target.offsetWidth:1,x=l.originImg?l.originImg.height/f.nativeEvent.target.offsetHeight:1,C=[o.x*d,o.y*x],S=[o.x*d+o.width*d,o.y*x+o.height*x],M=[].concat(C,S);F({eventPoint:M})}},h=function(){l.clipType!=="click"&&F({endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},j=(0,R.useMemo)(function(){if(!l.isSelecting)return null;var p=l.startPoint,f=l.endPoint;return(0,T.jsx)("div",{style:{position:"absolute",left:p.x,top:p.y,width:f.x-p.x,height:f.y-p.y,backgroundColor:"rgba(255, 0, 255, 0.3)",border:"1px dashed red",pointerEvents:"none",zIndex:1}})},[l.isSelecting,l.startPoint,l.endPoint]);return(0,R.useEffect)(function(){if(l.samModel&&l.eventPoint.length!==0){var p=l.eventPoint,f;l.clipType==="click"&&(f=[{x:p[0],y:p[1],clickType:1}]),l.clipType==="selectend"&&(f=[{x:p[0],y:p[1],clickType:2},{x:p[2],y:p[3],clickType:3}]);var y=function(o){var d=l.samModel.exportImageClip(o),x=l.samModel.exportMaskImage(o),C=String(new Date().getTime());F(function(S){return{clipImg:[].concat(G()(S.clipImg),[{clipSrc:d.src,maskSrc:x.src,mark:C}])}})};setTimeout(function(){l.samModel.predict(f).then(y)})}},[l.eventPoint,l.samModel,l.clipType]),(0,T.jsx)(se.Z,{spinning:l.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,T.jsxs)("div",{className:"samPic",children:[(0,T.jsxs)("div",{className:"samPic__tool",children:[(0,T.jsxs)(H,{className:"samPic__upload",multiple:!1,maxCount:1,showUploadList:!1,onChange:Le,accept:"image/*",beforeUpload:De,children:[(0,T.jsx)("p",{className:"ant-upload-drag-icon",children:(0,T.jsx)(Q.Z,{})}),(0,T.jsx)("p",{className:"ant-upload-hint",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u4E0A\u4F20\u3002"})]}),(0,T.jsx)(Te.ZP.Group,{style:{margin:"10px 0"},onChange:function(f){F({clipType:f.target.value,endPoint:{x:0,y:0},startPoint:{x:0,y:0},isSelecting:!1,eventPoint:[]})},value:l.clipType,size:"small",buttonStyle:"solid",children:L._$.map(function(p){return(0,T.jsx)(Te.ZP.Button,{value:p.value,children:p.label},p.value)})}),(0,T.jsx)(U.ZP,{block:!0,size:"small",type:"primary",disabled:l.clipImg.length<=0,onClick:function(){return(0,Z.O6)(l.clipImg,"clipImages")},style:{margin:"10px 0"},children:"\u4E0B\u8F7D\u6570\u636E"}),l.clipImg.length>0&&(0,T.jsx)("div",{className:"clipImgContent",children:l.clipImg.map(function(p,f){var y=p.clipSrc,u=p.mark;return(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)("img",{src:y,style:{width:50}}),(0,T.jsx)("div",{className:"tools",children:(0,T.jsx)(ie.Z,{style:{opacity:.8},onClick:function(){F(function(d){return{clipImg:d.clipImg.filter(function(x){return x.mark!==u})}})}})}),(0,T.jsx)(N.Z,{style:{margin:"8px 0"}})]},f)})})]}),(0,T.jsx)("div",{className:"samPic__preview",children:l.imageUrl&&(0,T.jsxs)("div",{style:{position:"relative"},children:[l.clipImg.length?l.clipImg.map(function(p,f){return(0,T.jsx)("img",{className:"samPic__preview__maskImg",src:p.maskSrc},f)}):null,(0,T.jsx)("img",{className:"samPic__preview__img",onClick:Ie,onMouseDown:he,onMouseMove:q,onMouseUp:E,onMouseOut:h,src:l.imageUrl,style:{cursor:l.clipType==="click"?"pointer":"crosshair"}}),l.clipType!=="click"&&j]})})]})})}},97314:function(Ce,ee,e){e.r(ee),e.d(ee,{default:function(){return Ie}});var J=e(15009),G=e.n(J),Ae=e(19632),D=e.n(Ae),ye=e(99289),$=e.n(ye),fe=e(5574),X=e.n(fe),Q=e(7539),ie=e(78356),xe=e(66242),z=e(33573),Y=e(75081),se=e(67294),Te=e(44268),U=e(54539),N=e(96638),R=e(67383),te=e(18312),w=e(37653),Z=e(43929),L=e(99247),T=e(90142),H=e(78234),ae=e(63428),ue=e(2302),I=e(85893),ne=function(q){var E=q.value;return ae.languages.registerDocumentFormattingEditProvider("json",{provideDocumentFormattingEdits:function(j){return[{range:j.getFullModelRange(),text:(0,T.XG)({content:j.getValue()})}]}}),(0,H.Z)(function(){ae.editor.defineTheme("custome-theme",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#fafafa","editorLineNumber.foreground":"#222222","editor.lineHighlightBackground":"#f4f4f4"}})}),(0,I.jsx)(ue.ZP,{width:400,height:"calc(70vh - 56px)",language:"json",value:(0,T.XG)({content:E}),theme:"custome-theme",options:{selectOnLineNumbers:!0,tabIndex:2,tabSize:2,folding:!0,fontSize:13,mouseStyle:"text",foldingStrategy:"indentation",scrollBeyondLastLine:!1,foldingMaximumRegions:Number.MAX_SAFE_INTEGER,suggest:{showKeywords:!0}}})},l=e(61781),F=e(8446),ge=function(q){var E=q.samInfo,h=q.setSamState,j=function(u){h(function(o){return{satelliteData:o.satelliteData.filter(function(d){return d.imageUrl!==u.image})}}),ie.ZP.success("\u5220\u9664\u6210\u529F")},p=[{title:"\u5E8F\u53F7",dataIndex:"key",width:60},{title:"\u5F62\u72B6",dataIndex:"geometry",ellipsis:!0,render:function(u){return(0,I.jsx)(l.Z,{placement:"topLeft",title:u,children:u})}},{title:"\u56FE\u7247",dataIndex:"image",width:80,render:function(u){return(0,I.jsx)(l.Z,{color:"#fff",placement:"topLeft",title:(0,I.jsx)("img",{src:u,style:{width:200,height:200}}),children:(0,I.jsx)("img",{src:u,style:{width:30,height:30}})})}},{title:"\u5220\u9664",width:80,render:function(u,o){return(0,I.jsx)(xe.ZP,{type:"primary",danger:!0,size:"small",onClick:function(){return j(o)},children:"\u5220\u9664"})}}],f=E.satelliteData.map(function(y,u){var o,d=(o=y.features[0])===null||o===void 0?void 0:o.geometry;return{key:u,geometry:JSON.stringify(d),image:y.imageUrl}});return(0,I.jsx)(F.Z,{size:"small",columns:p,dataSource:D()(f).reverse()})},Le=function(q){var E=q.samInfo,h=q.setSamState,j=(0,se.useMemo)(function(){var f=E.satelliteData.map(function(y){return y.features});return{type:"FeatureCollection",features:f.flat()}},[E.satelliteData]),p=[{key:"text",label:"\u7F16\u8F91\u5668\u5C55\u793A",children:(0,I.jsx)(ne,{value:JSON.stringify(j!=null?j:(0,T.rC)(),null,2)})},{key:"table",label:"\u8868\u683C\u5C55\u793A",children:(0,I.jsx)(ge,{samInfo:E,setSamState:h})}];return(0,I.jsxs)("div",{className:"rightContainer",style:{width:E.collapsed?400:0},children:[(0,I.jsx)("div",{className:"rightContainer__collapsed",onClick:function(){return h(function(y){return{collapsed:!y.collapsed}})},children:E.collapsed?(0,I.jsx)(w.Z,{className:"rightContainer__collapsed__icon"}):(0,I.jsx)(Z.Z,{className:"rightContainer__collapsed__icon"})}),E.collapsed&&(0,I.jsx)(L.Z,{style:{width:E.collapsed?400:0},items:p,tabBarExtraContent:(0,I.jsx)(xe.ZP,{size:"small",type:"primary",disabled:E.satelliteData.length<=0,onClick:function(){return(0,T.O6)(E.satelliteData)},children:"\u4E0B\u8F7D\u6570\u636E"})})]})},De={samModel:null,currentScene:null,currentSource:null,mapClick:null,loading:!1,borderLayer:null,eventType:"click",collapsed:!0,satelliteData:[]},Ie=function(){var he=17,q=(0,N.Z)(De),E=X()(q,2),h=E[0],j=E[1],p=function(o){var d,x,C=te.Kl.find(function(S){return S.name===o.target.value});C&&((d=h.currentScene)===null||d===void 0||d.setCenter(C.coord)),(x=h.currentScene)===null||x===void 0||x.setZoom(C.zoom||17)},f=function(o){console.log(o);var d=Array.isArray(o),x=d?o:[o.lngLat.lng,o.lngLat.lat];j({mapClick:x})},y=function(){var u=$()(G()().mark(function o(){var d,x,C,S,M,W,_,V,O,me,pe,de,c,a,t,n,r,i,s;return G()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return j({loading:!0}),S=(d=h.currentSource)===null||d===void 0||(x=d.tileset)===null||x===void 0?void 0:x.currentTiles,M=1/0,W=1/0,_=-1/0,V=-1/0,S==null||S.forEach(function(v){M=Math.min(M,v.x),W=Math.min(W,v.y),_=Math.max(_,v.x),V=Math.max(V,v.y)}),O=Math.ceil((C=h.currentScene)===null||C===void 0?void 0:C.getZoom()),me=document.createElement("canvas"),me.width=(_-M+1)*256,me.height=(V-W+1)*256,pe=me.getContext("2d"),de=h.samModel.mapHelper,c=[].concat(D()(de.tileToLngLat(M,V+1,O)),D()(de.tileToLngLat(_+1,W,O))),S==null||S.forEach(function(v){v&&(pe==null||pe.drawImage(v.data,(v.x-M)*256,(v.y-W)*256,256,256))}),h.samModel.setGeoImage(me.toDataURL(),{extent:c,width:me.width,height:me.height}),a=me.toDataURL("image/jpeg"),t=a.indexOf(","),n=a==null?void 0:a.substring(t+1),r=R.y,i=new FormData,i.append("image_path",n),g.next=24,fetch(r,{body:i,method:"post"});case 24:return g.next=26,g.sent.arrayBuffer();case 26:s=g.sent,h.samModel.setEmbedding(s),j({loading:!1}),ie.ZP.success("embedding\u8BA1\u7B97\u5B8C\u6210");case 30:case"end":return g.stop()}},o)}));return function(){return u.apply(this,arguments)}}();return(0,se.useEffect)(function(){if(!(!h.mapClick||!h.samModel)){var u=[];try{var o=h.mapClick;if(h.eventType==="click"){var d=h.samModel.lngLat2ImagePixel(o);u.push({x:d[0],y:d[1],clickType:1})}else if(h.eventType==="selectend"){var x=h.samModel.lngLat2ImagePixel([o[0],o[3]]),C=h.samModel.lngLat2ImagePixel([o[2],o[1]]);u.push({x:x[0],y:x[1],clickType:2}),u.push({x:C[0],y:C[1],clickType:3})}else h.eventType==="all"&&console.log(h.samModel.image.width,h.samModel.image.height);if(u.length===0)return;console.time("predict"),h.samModel.predict(u).then(function(){var S=$()(G()().mark(function M(W){var _,V,O;return G()().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return console.timeEnd("predict"),pe.next=3,h.samModel.exportGeoPolygon(W,1);case 3:_=pe.sent,V=h.samModel.exportImageClip(W),O={features:_.features,imageUrl:V.src},j(function(de){var c=de.satelliteData.find(function(a){return a.imageUrl===O.imageUrl});return c?{satelliteData:D()(de.satelliteData)}:{satelliteData:[].concat(D()(de.satelliteData),[O])}});case 7:case"end":return pe.stop()}},M)}));return function(M){return S.apply(this,arguments)}}())}catch(S){ie.ZP.error("\u8BF7\u5148\u70B9\u51FB[\u751F\u6210 embedding] \u6309\u94AE")}}},[h.mapClick]),(0,se.useEffect)(function(){if(h.borderLayer){var u=h.satelliteData.map(function(d){return d.features}),o={type:"FeatureCollection",features:u.flat()};h.borderLayer.setData(o)}},[h.borderLayer,h.satelliteData]),(0,se.useEffect)(function(){var u=new Q.xsS({id:"map",map:new U.Z({center:[120.10533489408249,30.261061158180482],zoom:he,minZoom:3,style:"blank"})}),o=new Q.Hw6(te.Hj,{parser:{type:"rasterTile",tileSize:256}}),d=new Q.YYg({zIndex:-2}).source(o),x=new Q.dWg({zIndex:10}).source({type:"FeatureCollection",features:[]}).shape("line").size(2).color("#f00").style({opacity:1});u.on("loaded",function(){u.addLayer(d),u.addLayer(x),j({borderLayer:x,currentScene:u,currentSource:o}),u.on("click",f),u.on("selectend",f)})},[]),(0,se.useEffect)(function(){h.eventType==="selectend"&&h.currentScene?h.currentScene.enableBoxSelect(!1):h.currentScene&&h.currentScene.disableBoxSelect()},[h.eventType]),(0,se.useEffect)(function(){var u=new Te.XU({modelUrl:te.XM,wasmPaths:te.XT});u.initModel().then(function(){j({samModel:u})})},[]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(xe.ZP,{onClick:y,children:" \u751F\u6210 embedding "}),(0,I.jsx)(z.ZP.Group,{style:{margin:"15px"},onChange:p,defaultValue:"A \u7A7A\u95F4",buttonStyle:"solid",children:te.Kl.map(function(u){return(0,I.jsx)(z.ZP.Button,{value:u.name,children:u.name},u.name)})}),(0,I.jsx)(Y.Z,{spinning:h.loading,tip:"embedding \u751F\u6210\u4E2D\u2026\u2026",children:(0,I.jsxs)("div",{className:"mapContainer",children:[(0,I.jsx)("div",{id:"map",className:"mapContainer__map",style:{width:"calc(100vw - ".concat(h.collapsed?400:0,"px)")},children:(0,I.jsx)(z.ZP.Group,{style:{position:"absolute",top:15,left:15,zIndex:100},onChange:function(o){j({eventType:o.target.value})},value:h.eventType,size:"small",buttonStyle:"solid",children:te.bw.map(function(u){return(0,I.jsx)(z.ZP.Button,{value:u.value,children:u.label},u.value)})})}),(0,I.jsx)(Le,{samInfo:h,setSamState:j})]})})]})}},44268:function(Ce,ee,e){e.d(ee,{e7:function(){return h},XU:function(){return de},y3:function(){return I},Ul:function(){return Z}});var J=e(18736),G=function(a){var t=a.clicks,n=a.tensor,r=a.modelScale,i=n,s,m,g,v;if(t){var A=t.length;s=new Float32Array(2*(A+1)),m=new Float32Array(A+1);for(var P=0;P<A;P++)s[2*P]=t[P].x*r.samScale,s[2*P+1]=t[P].y*r.samScale,m[P]=t[P].clickType;s[2*A]=0,s[2*A+1]=0,m[A]=-1,g=new J.Tensor("float32",s,[1,A+1,2]),v=new J.Tensor("float32",m,[1,A+1])}var k=new J.Tensor("float32",[r.height,r.width]);if(!(g===void 0||v===void 0)){var re=new J.Tensor("float32",new Float32Array(256*256),[1,1,256,256]),ce=new J.Tensor("float32",[0]);return{image_embeddings:i,point_coords:g,point_labels:v,orig_im_size:k,mask_input:re,has_mask_input:ce}}},Ae=e(15009),D=e.n(Ae),ye=e(99289),$=e.n(ye),fe=e(12444),X=e.n(fe),Q=e(72004),ie=e.n(Q),xe=e(9783),z=e.n(xe),Y=e(781),se="https://mdn.alipayobjects.com/huamei_qa8qxu/afts/file/A*eRf_QauRmqoAAAAAAAAAAAAADmJ7AQ/sam_onnx_example.glb",Te=e(5574),U=e.n(Te),N=e(69826),R=e(16479),te=e.n(R);function w(c){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=c.width,a.height=c.height,t==null||t.putImageData(c,0,0),a}function Z(c){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"image/png",t=document.createElement("canvas"),n=t.getContext("2d");return t.width=c.width,t.height=c.height,n.drawImage(c,0,0,c.width,c.height),t.toDataURL(a)}function L(c){var a=w(c),t=new Image;return t.src=a.toDataURL(),t}function T(c,a,t,n){for(var r=new Uint8ClampedArray(c.data),i=new Uint8ClampedArray(4*t*n),s=0;s<a.length;s++)if(a[s]>0){var m=4*s;i[m+0]=r[m+0],i[m+1]=r[m+1],i[m+2]=Math.max(r[m+2],200),i[m+3]=r[m+3]}return L(new ImageData(i,t,n))}function H(c,a,t){for(var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:15,r=a,i=0,s=t,m=0,g=0;g<c.length;g++)if(c[g]>0){var v=g%a,A=Math.floor(g/a);r=Math.min(r,v),i=Math.max(i,v),s=Math.min(s,A),m=Math.max(m,A)}return[r-n,i+n,s-n,m+n]}function ae(c,a,t,n,r,i){for(var s=[],m=0,g=a;g<n;g++)for(var v=c;v<t;v++){var A=g*i+v;s[m++]=r[A]>0?1:-1}return s}function ue(c,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=c.map(function(s){return{x:s[0]+a,y:s[1]+t}});if(n===0)return r;var i=te()(r,n,!0);return i}var I=function(a){return new Promise(function(t,n){var r=new FileReader;r.readAsDataURL(a),r.onload=function(){return t(r.result)},r.onerror=function(i){return n(i)}})};function ne(c,a,t){var n=H(c,a,t),r=U()(n,4),i=r[0],s=r[1],m=r[2],g=r[3],v=ae(i,m,s,g,c,a),A=T(v,s-i,g-m);return L(A)}function l(c,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5,r=H(c,a,t),i=U()(r,4),s=i[0],m=i[1],g=i[2],v=i[3],A=ae(s,g,m,v,c,a),P=m-s,k=v-g,re=N.Z().size([P,k]).smooth(!1).thresholds(2),ce=re(A);return ue(ce[1].coordinates[0][0],s,g,n)}function F(c,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=0;n<a.length;n++)(t?a[n]<=0:a[n]>0)&&(c.data[4*n+0]=0,c.data[4*n+1]=0,c.data[4*n+2]=0,c.data[4*n+3]=0);return L(c)}function ge(c,a,t,n){for(var r=H(a,t,n),i=U()(r,4),s=i[0],m=i[1],g=i[2],v=i[3],A=new Uint8ClampedArray(4*(m-s)*(v-g)).fill(0),P=0,k=g;k<v;k++)for(var re=s;re<m;re++){var ce=k*t+re;a[ce]>0&&(A[P*4]=c.data[ce*4],A[P*4+1]=c.data[ce*4+1],A[P*4+2]=c.data[ce*4+2],A[P*4+3]=c.data[ce*4+3]),P++}var Me=new ImageData(A,m-s,v-g);return L(Me)}function Le(c){var a=document.createElement("a");a.href=c.src,a.download="image",a.click()}function De(c){var a=document.createElement("a");a.href=c.toDataURL("image/png"),a.download="image",a.click()}function Ie(c){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=c.width,a.height=c.height,t==null||t.drawImage(c,0,0),t==null?void 0:t.getImageData(0,0,c.width,c.height)}var he=function(a){var t=1024,n=a.naturalWidth,r=a.naturalHeight,i=t/Math.max(r,n);return{height:r,width:n,samScale:i}},q=function(a,t){var n=1024,r=n/Math.max(t,a);return{height:t,width:a,samScale:r}},E=e(18736),h=function(){function c(a){X()(this,c),z()(this,"modelUrl",se),z()(this,"model",void 0),z()(this,"image",void 0),z()(this,"imageData",void 0),z()(this,"modelScale",void 0),z()(this,"tensor",void 0),a!=null&&a.modelUrl&&(this.modelUrl=a.modelUrl),a!=null&&a.wasmPaths&&this.setWasmUrl(a.wasmPaths)}return ie()(c,[{key:"initModel",value:function(){var a=$()(D()().mark(function n(){var r;return D()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,J.InferenceSession.create(this.modelUrl);case 3:r=s.sent,this.model=r,s.next=10;break;case 7:throw s.prev=7,s.t0=s.catch(0),new Error("\u6A21\u578B\u52A0\u8F7D\u5931\u8D25");case 10:case"end":return s.stop()}},n,this,[[0,7]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"setImage",value:function(){var a=$()(D()().mark(function n(r){var i=this;return D()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:typeof r=="string"?(this.image=new Image,this.image.src=r,this.image.onload=function(){i.getImageScale(i.image),i.imageData=Ie(i.image)}):(this.image=r,this.getImageScale(this.image),this.imageData=Ie(this.image));case 1:case"end":return m.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"setEmbedding",value:function(){var a=$()(D()().mark(function n(r){var i,s,m,g,v=arguments;return D()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(i=v.length>1&&v[1]!==void 0?v[1]:"float32",s=new Y.Z,typeof r!="string"){P.next=6;break}P.t0=s.load(r),P.next=9;break;case 6:return P.next=8,s.parse(r);case 8:P.t0=P.sent;case 9:m=P.t0,g=new E.Tensor(i,m.data,m.shape),this.tensor=g;case 12:case"end":return P.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predict",value:function(){var a=$()(D()().mark(function n(r){var i,s,m;return D()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(v.prev=0,!(this.model===null||r===null||this.tensor===null||this.modelScale===null)){v.next=6;break}return console.log("model not loaded"),v.abrupt("return");case 6:if(i=G({clicks:r,tensor:this.tensor,modelScale:this.modelScale}),i!==void 0){v.next=9;break}return v.abrupt("return");case 9:return v.next=11,this.model.run(i);case 11:return s=v.sent,m=s[this.model.outputNames[0]],v.abrupt("return",m);case 14:v.next=20;break;case 16:return v.prev=16,v.t0=v.catch(0),console.log(v.t0),v.abrupt("return");case 20:case"end":return v.stop()}},n,this,[[0,16]])}));function t(n){return a.apply(this,arguments)}return t}()},{key:"predictByBox",value:function(){var a=$()(D()().mark(function n(r){return D()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",r);case 1:case"end":return s.stop()}},n)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"exportMaskImage",value:function(t){if(this.imageData!==void 0)return T(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportMaskClip",value:function(t){return ne(t.data,t.dims[3],t.dims[2])}},{key:"exportImage",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.imageData!==void 0)return F(this.imageData,t.data,n)}},{key:"exportImageClip",value:function(t){if(this.imageData!==void 0)return ge(this.imageData,t.data,t.dims[3],t.dims[2])}},{key:"exportVector",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return l(t.data,t.dims[3],t.dims[2],n)}},{key:"setWasmUrl",value:function(t){J.env.wasm.wasmPaths=t}},{key:"getImageScale",value:function(t){var n=t.width,r=t.height;this.modelScale=q(n,r)}}]),c}(),j=e(19632),p=e.n(j),f=e(25098),y=e.n(f),u=e(28785),o=e.n(u),d=e(48374),x=e.n(d),C=e(31996),S=e.n(C),M=e(26037),W=e.n(M),_=function(){function c(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:256,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"tms";X()(this,c),z()(this,"tileSize",void 0),z()(this,"type",void 0),z()(this,"initialResolution",void 0),z()(this,"originShift",void 0),this.tileSize=a,this.type=t,this.initialResolution=2*Math.PI*6378137/this.tileSize,this.originShift=2*Math.PI*6378137/2}return ie()(c,[{key:"lngLatToMeters",value:function(t,n){var r=t*this.originShift/180,i=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return i=i*this.originShift/180,[r,i]}},{key:"metersToLngLat",value:function(t,n){var r=t/this.originShift*180,i=n/this.originShift*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),[r,i]}},{key:"pixelsToMeters",value:function(t,n,r){var i=this.resolution(r),s=t*i-this.originShift,m=(this.type==="tms"?n:Math.pow(2,r)*256-n)*i-this.originShift;return[s,m]}},{key:"metersToPixels",value:function(t,n,r){var i=this.resolution(r),s=(t+this.originShift)/i,m=(n+this.originShift)/i;return m=this.type==="tms"?m:Math.pow(2,r)*256-m,[s,m]}},{key:"metersToTile",value:function(t,n,r){var i=this.metersToPixels(t,n,r),s=U()(i,2),m=s[0],g=s[1];return this.pixelsToTile(m,g)}},{key:"tileToMeters",value:function(t,n,r){return this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r)}},{key:"tileToLngLat",value:function(t,n,r){var i=this.tileToMeters(t,n,r),s=U()(i,2),m=s[0],g=s[1];return this.metersToLngLat(m,g)}},{key:"pixelsToTile",value:function(t,n){var r=Math.floor(Math.ceil(t/this.tileSize)-1),i=Math.floor(Math.ceil(n/this.tileSize)-1);return[r,i]}},{key:"pixelsToRaster",value:function(t,n,r){var i=this.tileSize<<r;return[t,i-n]}},{key:"tileBounds",value:function(t,n,r){var i=this.pixelsToMeters(t*this.tileSize,n*this.tileSize,r),s=U()(i,2),m=s[0],g=s[1],v=this.pixelsToMeters((t+1)*this.tileSize,(n+1)*this.tileSize,r),A=U()(v,2),P=A[0],k=A[1];return[m,g,P,k]}},{key:"tileLatLonBounds",value:function(t,n,r){var i=this.tileBounds(t,n,r),s=this.metersToLngLat(i[0],i[1]),m=U()(s,2),g=m[0],v=m[1],A=this.metersToLngLat(i[2],i[3]),P=U()(A,2),k=P[0],re=P[1];return[g,v,k,re]}},{key:"resolution",value:function(t){return this.initialResolution/Math.pow(2,t)}},{key:"lngLatToPixels",value:function(t,n,r){var i=this.lngLatToMeters(t,n),s=U()(i,2),m=s[0],g=s[1];return this.metersToPixels(m,g,r)}},{key:"pixelsTolngLat",value:function(t,n,r){var i=this.pixelsToMeters(t,n,r);return this.metersToLngLat(i[0],i[1])}},{key:"lngLatToTile",value:function(t,n,r){var i=this.lngLatToPixels(t,n,r),s=U()(i,2),m=s[0],g=s[1];return this.pixelsToTile(m,g)}},{key:"googleTile",value:function(t,n,r){return[t,Math.pow(2,r)-1-n]}},{key:"boundsToTileExtent",value:function(t,n,r,i,s){var m=this.lngLatToTile(t,i,s),g=U()(m,2),v=g[0],A=g[1],P=this.lngLatToTile(r,n,s),k=U()(P,2),re=k[0],ce=k[1];return[[v,A],[re,ce]]}},{key:"metersboundsToTileExtent",value:function(t,n,r,i,s){var m=this.metersToTile(t,i,s),g=U()(m,2),v=g[0],A=g[1],P=this.metersToTile(r,n,s),k=U()(P,2),re=k[0],ce=k[1];return[[v,A],[re,ce]]}}]),c}(),V=null,O=function(a){var t=_slicedToArray(a,4),n=t[0],r=t[1],i=t[2],s=t[3];return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[n,r],[n,s],[i,s],[i,r],[n,r]]]}}]}},me=function(a){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[a]}}]}},pe=function(){return{type:"FeatureCollection",features:[]}},de=function(c){S()(t,c);var a=W()(t);function t(){var n;X()(this,t);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=a.call.apply(a,[this].concat(i)),z()(y()(n),"imageOption",void 0),z()(y()(n),"imageBounds",void 0),z()(y()(n),"metersPerpixelsX",0),z()(y()(n),"metersPerpixelsY",0),z()(y()(n),"mapHelper",new _(256,"google")),n}return ie()(t,[{key:"setGeoImage",value:function(){var n=$()(D()().mark(function i(s,m){var g,v,A;return D()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:o()(x()(t.prototype),"setImage",this).call(this,s),this.imageOption=m,g=m.extent,v=m.width,A=m.height,g&&(this.imageBounds=[].concat(p()(this.mapHelper.lngLatToMeters(g[0],g[1])),p()(this.mapHelper.lngLatToMeters(g[2],g[3]))),this.metersPerpixelsX=(this.imageBounds[2]-this.imageBounds[0])/v,this.metersPerpixelsY=(this.imageBounds[3]-this.imageBounds[1])/A);case 4:case"end":return k.stop()}},i,this)}));function r(i,s){return n.apply(this,arguments)}return r}()},{key:"exportGeoPolygon",value:function(){var n=$()(D()().mark(function i(s){var m=this,g,v,A,P,k,re=arguments;return D()().wrap(function(Me){for(;;)switch(Me.prev=Me.next){case 0:return g=re.length>1&&re[1]!==void 0?re[1]:5,Me.next=3,this.exportVector(s,g);case 3:return v=Me.sent,A=this.imageBounds,P=v.map(function(Fe){var Be=[Fe.x*m.metersPerpixelsX+A[0],(m.imageOption.height-Fe.y)*m.metersPerpixelsY+A[1]],Re=m.mapHelper.metersToLngLat(Be[0],Be[1]);return Re}),k=me(P),Me.abrupt("return",k);case 8:case"end":return Me.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"lngLat2ImagePixel",value:function(r){if(this.imageBounds){var i=this.mapHelper.lngLatToMeters(r[0],r[1]),s=U()(i,2),m=s[0],g=s[1],v=(m-this.imageBounds[0])/this.metersPerpixelsX,A=(g-this.imageBounds[1])/this.metersPerpixelsY;return A=this.imageOption.height-A,[v,A]}}}]),t}(h)}}]);
